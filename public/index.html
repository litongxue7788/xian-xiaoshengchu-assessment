<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¥¿å®‰å°å‡åˆæ™ºèƒ½è¯„ä¼°ç³»ç»Ÿ 2025å¢å¼ºç‰ˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft YaHei", sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; font-size: 15px; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 24px; padding: 40px; box-shadow: 0 20px 80px rgba(0,0,0,0.3); position: relative; }
        .api-status { position: fixed; top: 20px; right: 20px; padding: 10px 15px; border-radius: 8px; font-size: 14px; font-weight: 600; z-index: 1001; box-shadow: 0 4px 12px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.3s ease; }
        .api-status.local { background: #ed8936; color: white; }
        .api-status.connected { background: #48bb78; color: white; }
        .config-panel { position: fixed; top: 80px; right: 20px; background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); z-index: 1000; max-width: 400px; border: 2px solid #667eea; display: none; }
        .config-panel.show { display: block; }
        .config-title { font-size: 16px; font-weight: 600; color: #2d3748; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
        .config-input { width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; margin-bottom: 10px; font-size: 14px; }
        .config-input:focus { border-color: #667eea; outline: none; }
        .config-btn { width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; margin-bottom: 10px; transition: all 0.3s; }
        .config-btn:hover { transform: translateY(-2px); }
        .config-btn.secondary { background: #6c757d; }
        .config-help { font-size: 12px; color: #718096; margin-top: 10px; line-height: 1.5; }
        .config-status { padding: 10px; border-radius: 8px; margin-bottom: 10px; font-size: 13px; }
        .config-status.success { background: #c6f6d5; color: #276749; }
        .config-status.error { background: #fed7d7; color: #c53030; }
        .config-status.info { background: #bee3f8; color: #2b6cb0; }
        .progress-bar { position: absolute; top: 0; left: 0; height: 6px; background: linear-gradient(90deg, #667eea, #764ba2); border-radius: 24px 24px 0 0; transition: width 0.5s ease; width: 16.6%; }
        
        /* AIåŠ©æ‰‹æ ·å¼ */
        .ai-assistant { position: fixed; bottom: 30px; right: 30px; z-index: 1000; }
        .ai-assistant-btn { width: 60px; height: 60px; background: linear-gradient(135deg, #ff6a00, #ff3d00); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; cursor: pointer; box-shadow: 0 8px 25px rgba(255, 106, 0, 0.4); transition: all 0.3s ease; border: none; }
        .ai-assistant-btn:hover { transform: scale(1.1); }
        .ai-chat-window { 
            position: fixed; 
            bottom: 100px; 
            right: 30px; 
            width: 380px; 
            height: 520px; 
            background: white; 
            border-radius: 20px; 
            box-shadow: 0 15px 50px rgba(0,0,0,0.2); 
            display: none; 
            flex-direction: column; 
            overflow: hidden; 
            border: 2px solid #e2e8f0; 
            z-index: 1002;
        }
        .ai-chat-window.active { 
            display: flex !important; 
        }
        .ai-chat-header { background: linear-gradient(135deg, #ff6a00 0%, #ff3d00 100%); color: white; padding: 20px; display: flex; align-items: center; gap: 12px; cursor: move; }
        .ai-chat-body { flex: 1; padding: 20px; overflow-y: auto; background: #fff9f5; }
        .ai-message { margin-bottom: 15px; display: flex; gap: 10px; }
        .ai-message.assistant { flex-direction: row; }
        .ai-message.user { flex-direction: row-reverse; }
        .message-avatar { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0; }
        .ai-message.assistant .message-avatar { background: linear-gradient(135deg, #ff6a00, #ff3d00); color: white; }
        .ai-message.user .message-avatar { background: #e2e8f0; color: #4a5568; }
        .message-content { max-width: 70%; padding: 12px 16px; border-radius: 18px; font-size: 14px; line-height: 1.5; }
        .ai-message.assistant .message-content { background: white; border: 1px solid #e2e8f0; border-bottom-left-radius: 4px; }
        .ai-message.user .message-content { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-bottom-right-radius: 4px; }
        .ai-chat-input { padding: 15px; border-top: 1px solid #e2e8f0; background: white; }
        .chat-input-group { display: flex; gap: 10px; }
        .chat-input { flex: 1; padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 25px; outline: none; font-size: 14px; }
        .chat-input:focus { border-color: #667eea; }
        .send-btn { width: 40px; height: 40px; border: none; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .send-btn:disabled { background: #ccc; }
        .quick-actions { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .quick-action-btn { padding: 6px 12px; background: #f7fafc; border: 1px solid #e2e8f0; border-radius: 15px; font-size: 12px; cursor: pointer; transition: all 0.2s; }
        .quick-action-btn:hover { background: #667eea; color: white; border-color: #667eea; }
        .typing-indicator { display: flex; gap: 4px; padding: 8px 0; }
        .typing-indicator span { width: 8px; height: 8px; background: #667eea; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out; }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        
        h1 { text-align: center; font-size: 32px; margin-bottom: 12px; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 700; }
        .subtitle { text-align: center; color: #718096; margin-bottom: 40px; font-size: 16px; }
        .ai-badge { display: inline-block; background: linear-gradient(135deg, #ff6a00, #ff3d00); color: white; padding: 6px 16px; border-radius: 20px; font-size: 14px; font-weight: 600; margin-left: 10px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .important-notice { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 25px; border-radius: 15px; margin-bottom: 30px; }
        .important-notice h3 { color: white; margin-bottom: 15px; font-size: 18px; }
        .important-notice ul { list-style: none; padding-left: 0; line-height: 1.8; font-size: 14px; }
        .important-notice li { margin-bottom: 8px; padding-left: 24px; position: relative; }
        .important-notice li::before { content: "âœ“"; position: absolute; left: 0; color: #48bb78; }
        .step-indicator { display: flex; justify-content: space-between; margin-bottom: 40px; position: relative; max-width: 900px; margin-left: auto; margin-right: auto; }
        .step-indicator::before { content: ''; position: absolute; top: 25px; left: 50px; right: 50px; height: 4px; background: #e2e8f0; z-index: 0; }
        .step { display: flex; flex-direction: column; align-items: center; position: relative; z-index: 1; flex: 1; cursor: pointer; }
        .step-number { width: 50px; height: 50px; border-radius: 50%; background: #e2e8f0; color: #a0aec0; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 20px; margin-bottom: 12px; transition: all 0.3s; }
        .step.active .step-number { background: linear-gradient(135deg, #667eea, #764ba2); color: white; transform: scale(1.15); }
        .step.completed .step-number { background: #48bb78; color: white; }
        .step-label { font-size: 12px; color: #718096; text-align: center; line-height: 1.3; }
        .step.active .step-label { color: #667eea; font-weight: 600; }
        .section { display: none; animation: fadeInUp 0.6s ease; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .section.active { display: block; }
        .dimension-card { background: #f7fafc; border-radius: 16px; padding: 25px; margin-bottom: 20px; border: 2px solid #e2e8f0; transition: all 0.3s; }
        .dimension-card:hover { border-color: #667eea; }
        .dimension-title { font-size: 20px; color: #2d3748; margin-bottom: 12px; font-weight: 600; }
        .dimension-desc { color: #718096; margin-bottom: 20px; font-size: 14px; }
        .score-options { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        .score-option input[type="radio"] { display: none; }
        .score-label { display: flex; flex-direction: column; justify-content: center; padding: 15px 10px; text-align: center; border: 2px solid #e2e8f0; border-radius: 12px; cursor: pointer; transition: all 0.3s; background: white; min-height: 100px; }
        .score-label:hover { border-color: #667eea; transform: translateY(-2px); }
        .score-option input[type="radio"]:checked + .score-label { border-color: #667eea; background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .score-number { font-size: 28px; font-weight: 700; display: block; margin-bottom: 6px; }
        .score-desc { font-size: 12px; display: block; line-height: 1.4; }
        .info-section { background: #f7fafc; border-radius: 16px; padding: 25px; margin-bottom: 20px; border: 2px solid #e2e8f0; }
        .info-section h3 { font-size: 20px; font-weight: 600; margin-bottom: 20px; color: #2d3748; }
        .info-group { margin-bottom: 18px; }
        .info-label { display: block; font-weight: 600; color: #2d3748; margin-bottom: 8px; font-size: 14px; }
        .info-select { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 14px; background: white; }
        .info-select:focus { outline: none; border-color: #667eea; }
        .info-input { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 14px; }
        .info-input:focus { outline: none; border-color: #667eea; }
        .checkbox-group { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; }
        .checkbox-label { display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 10px; border-radius: 8px; font-size: 14px; }
        .checkbox-label:hover { background: #edf2f7; }
        .checkbox-label input[type="checkbox"] { width: 18px; height: 18px; }
        .button-group { display: flex; gap: 16px; justify-content: center; margin-top: 30px; }
        .btn { padding: 14px 36px; border: none; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 8px; }
        .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4); }
        .btn-secondary { background: #e2e8f0; color: #4a5568; }
        .btn-secondary:hover { background: #cbd5e0; }
        .result-card { background: white; border-radius: 16px; padding: 25px; margin-bottom: 20px; border: 2px solid #e2e8f0; }
        .result-title { font-size: 20px; color: #2d3748; margin-bottom: 20px; padding-left: 15px; border-left: 4px solid #667eea; font-weight: 600; }
        .chart-container { position: relative; height: 350px; margin: 20px auto; max-width: 500px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .stat-card { background: linear-gradient(135deg, #f7fafc, #edf2f7); padding: 20px; border-radius: 12px; border-left: 4px solid #667eea; }
        .stat-label { font-size: 13px; color: #718096; margin-bottom: 8px; }
        .stat-value { font-size: 28px; font-weight: 700; color: #667eea; margin-bottom: 5px; }
        .stat-trend { font-size: 12px; color: #48bb78; }
        .ai-loading { text-align: center; padding: 30px; background: #f7fafc; border-radius: 12px; margin: 15px 0; border: 2px dashed #667eea; }
        .ai-loading-spinner { display: inline-block; width: 40px; height: 40px; border: 3px solid #f3f3f3; border-top: 3px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .school-card { background: white; border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px; margin-bottom: 15px; transition: all 0.3s; }
        .school-card:hover { border-color: #667eea; box-shadow: 0 4px 15px rgba(102,126,234,0.15); }
        .school-card.tier-1 { border-left: 4px solid #e53e3e; }
        .school-card.tier-2 { border-left: 4px solid #ed8936; }
        .school-card.tier-3 { border-left: 4px solid #48bb78; }
        .school-name { font-size: 18px; font-weight: 600; color: #2d3748; margin-bottom: 8px; }
        .school-info { font-size: 13px; color: #718096; line-height: 1.6; }
        .school-tag { display: inline-block; padding: 3px 10px; border-radius: 12px; font-size: 12px; margin-right: 8px; margin-top: 8px; }
        .tag-hot { background: #fed7d7; color: #c53030; }
        .tag-stable { background: #c6f6d5; color: #276749; }
        .tag-new { background: #bee3f8; color: #2b6cb0; }
        .tag-match-high { background: #c6f6d5; color: #276749; }
        .tag-match-medium { background: #fefcbf; color: #744210; }
        .tag-match-low { background: #fed7d7; color: #c53030; }
        .tag-risk-high { background: #fed7d7; color: #c53030; }
        .tag-risk-medium { background: #fefcbf; color: #744210; }
        .tag-risk-low { background: #c6f6d5; color: #276749; }
        .timeline-item { position: relative; padding-left: 30px; padding-bottom: 20px; border-left: 2px solid #667eea; }
        .timeline-item:last-child { border-left: 2px solid transparent; }
        .timeline-item::before { content: ''; position: absolute; left: -8px; top: 0; width: 14px; height: 14px; background: #667eea; border-radius: 50%; }
        .timeline-date { font-weight: 600; color: #667eea; margin-bottom: 5px; }
        .timeline-content { color: #4a5568; font-size: 14px; }
        .policy-box { background: #fffaf0; border: 1px solid #ed8936; border-radius: 12px; padding: 15px; margin: 15px 0; }
        .policy-box h4 { color: #c05621; margin-bottom: 10px; font-size: 15px; }
        .policy-box p { color: #744210; font-size: 13px; line-height: 1.6; }
        .match-indicator { display: inline-block; padding: 3px 8px; border-radius: 8px; font-size: 11px; margin-left: 8px; }
        .match-high { background: #c6f6d5; color: #276749; }
        .match-medium { background: #fefcbf; color: #744210; }
        .match-low { background: #fed7d7; color: #c53030; }
        .risk-indicator { display: inline-block; padding: 3px 8px; border-radius: 8px; font-size: 11px; margin-left: 8px; }
        .risk-high { background: #fed7d7; color: #c53030; }
        .risk-medium { background: #fefcbf; color: #744210; }
        .risk-low { background: #c6f6d5; color: #276749; }
        .public-match-card { background: #f0fff4; border: 2px solid #48bb78; border-radius: 12px; padding: 20px; margin-bottom: 15px; }
        .public-match-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .public-match-title { font-size: 18px; font-weight: 600; color: #2d3748; }
        .public-match-desc { color: #718096; font-size: 14px; line-height: 1.6; }
        .feedback-section { background: #f7fafc; border-radius: 16px; padding: 25px; margin-bottom: 20px; border: 2px solid #e2e8f0; }
        .feedback-section h3 { font-size: 20px; font-weight: 600; margin-bottom: 20px; color: #2d3748; }
        .feedback-group { margin-bottom: 18px; }
        .feedback-label { display: block; font-weight: 600; color: #2d3748; margin-bottom: 8px; font-size: 14px; }
        .feedback-select { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 14px; background: white; }
        .feedback-select:focus { outline: none; border-color: #667eea; }
        .location-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .location-section { background: #f8fafc; padding: 20px; border-radius: 12px; border: 2px solid #e2e8f0; }
        .location-section h4 { color: #2d3748; margin-bottom: 15px; font-size: 16px; }
        .transport-info { background: #f0f9ff; border: 1px solid #bee3f8; border-radius: 8px; padding: 15px; margin-top: 10px; }
        .transport-info h5 { color: #2b6cb0; margin-bottom: 8px; font-size: 14px; }
        @media (max-width: 768px) {
            .container { padding: 20px; } h1 { font-size: 24px; }
            .score-options { grid-template-columns: repeat(3, 1fr); }
            .stats-grid { grid-template-columns: 1fr; }
            .button-group { flex-direction: column; }
            .btn { width: 100%; justify-content: center; }
            .ai-chat-window { width: 300px; height: 400px; right: -20px; }
            .config-panel { max-width: 90%; right: 5%; left: 5%; }
            .location-grid { grid-template-columns: 1fr; }
            .step-label { font-size: 11px; }
        }
    </style>
</head>
<body>
    <div class="api-status local" id="apiStatus" onclick="toggleConfigPanel()"><i class="fas fa-laptop"></i> <span id="statusText">æœ¬åœ°æ¨¡å¼</span></div>
    <div class="config-panel" id="configPanel">
        <div class="config-title"><i class="fas fa-key"></i> é˜¿é‡Œäº‘ç™¾ç‚¼APIé…ç½®</div>
        <div class="config-status info" id="configStatus">é…ç½®APIå¯è·å¾—æ›´æ™ºèƒ½çš„ä¸ªæ€§åŒ–æ¨è</div>
        <input type="password" class="config-input" id="apiKeyInput" placeholder="API Key (sk-å¼€å¤´)">
        <input type="text" class="config-input" id="appIdInput" placeholder="APP ID">
        <button class="config-btn" onclick="saveAndTestConfig()"><i class="fas fa-plug"></i> ä¿å­˜å¹¶æµ‹è¯•</button>
        <button class="config-btn secondary" onclick="useLocalMode()"><i class="fas fa-laptop"></i> ä½¿ç”¨æœ¬åœ°æ¨¡å¼</button>
        <div class="config-help">
            <strong>è·å–æ–¹å¼ï¼š</strong><br>
            1. ç™»å½•<a href="https://bailian.console.aliyun.com" target="_blank">é˜¿é‡Œäº‘ç™¾ç‚¼æ§åˆ¶å°</a><br>
            2. åº”ç”¨ç®¡ç† â†’ å¤åˆ¶APP ID<br>
            3. å¯†é’¥ç®¡ç† â†’ åˆ›å»ºAPI Key
        </div>
    </div>

    <div class="container">
        <div class="progress-bar" id="progressBar"></div>
        <h1>ğŸ“ è¥¿å®‰å°å‡åˆæ™ºèƒ½è¯„ä¼°ç³»ç»Ÿ <span class="ai-badge">2025å¢å¼ºç‰ˆ</span></h1>
        <p class="subtitle">åŸºäºè¯¦ç»†åœ°ç†ä½ç½®ä¿¡æ¯çš„ç²¾å‡†å­¦åŒºåŒ¹é… Â· ä¸ªæ€§åŒ–AIæ‹©æ ¡æ–¹æ¡ˆ</p>

        <div class="ai-assistant">
            <button class="ai-assistant-btn" onclick="toggleChat()">ğŸ±</button>
            <div class="ai-chat-window" id="chatWindow">
                <div class="ai-chat-header" id="chatHeader">
                    <div style="font-size: 32px;">ğŸ±</div>
                    <div><div style="font-weight: 600;">å°å–µå‡å­¦åŠ©æ‰‹</div><div style="font-size: 12px; opacity: 0.8;" id="chatApiStatus">æœ¬åœ°æ¨¡å¼</div></div>
                </div>
                <div class="ai-chat-body" id="chatBody">
                    <div class="ai-message assistant">
                        <div class="message-avatar">ğŸ±</div>
                        <div class="message-content">å–µ~æ‚¨å¥½ï¼æˆ‘æ˜¯åŸºäº2025å¹´è¥¿å®‰ä¹‰åŠ¡æ•™è‚²æ”¿ç­–çš„å‡å­¦åŠ©æ‰‹ï¼<br>ğŸ“‹ æ”¿ç­–ï¼šå…¬æ°‘åŒæ‹›ã€å…è¯•å…¥å­¦<br>ğŸ« æ°‘åŠï¼š28æ‰€å­¦æ ¡ï¼Œè®¡åˆ’æ‹›ç”Ÿ12361äºº<br>ğŸ“… æŠ¥åï¼š7æœˆ11æ—¥-24æ—¥<br>ğŸ² æ‘‡å·ï¼š7æœˆ30æ—¥<br>æœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨çš„ï¼Ÿ</div>
                    </div>
                </div>
                <div class="ai-chat-input">
                    <div class="chat-input-group">
                        <input type="text" class="chat-input" id="chatInput" placeholder="è¾“å…¥é—®é¢˜..." onkeypress="handleKeyPress(event)">
                        <button class="send-btn" id="sendBtn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
                    </div>
                    <div class="quick-actions">
                        <button class="quick-action-btn" onclick="quickAction('2026å¹´å°å‡åˆæ—¶é—´å®‰æ’')">æ—¶é—´å®‰æ’</button>
                        <button class="quick-action-btn" onclick="quickAction('æ°‘åŠå­¦æ ¡æœ‰å“ªäº›')">æ°‘åŠå­¦æ ¡</button>
                        <button class="quick-action-btn" onclick="quickAction('æ‘‡å·æ”¿ç­–')">æ‘‡å·æ”¿ç­–</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="important-notice">
            <h3>ğŸ“‹ 2025å¹´è¥¿å®‰ä¹‰åŠ¡æ•™è‚²æ‹›ç”Ÿæ”¿ç­–è¦ç‚¹</h3>
            <ul>
                <li><strong>å…è¯•å°±è¿‘å…¥å­¦ï¼š</strong>å…¬åŠå­¦æ ¡æŒ‰å­¦åŒºåˆ’ç‰‡æ‹›ç”Ÿï¼Œä¸¥ç¦è€ƒè¯•é€‰æ‹”</li>
                <li><strong>å…¬æ°‘åŒæ‹›ï¼š</strong>æ°‘åŠä¸å…¬åŠåŒæ­¥æŠ¥å(7æœˆ11-24æ—¥)ã€åŒæ­¥æ‹›ç”Ÿ</li>
                <li><strong>ç”µè„‘éšæœºå½•å–ï¼š</strong>æ°‘åŠæŠ¥åè¶…è®¡åˆ’çš„å®è¡Œæ‘‡å·ï¼Œ7æœˆ30æ—¥ç»Ÿä¸€è¿›è¡Œ</li>
                <li><strong>æ‹›ç”Ÿå¹³å°ï¼š</strong>ç»Ÿä¸€ä½¿ç”¨é™•è¥¿"æ•™è‚²å…¥å­¦ä¸€ä»¶äº‹"æ‹›ç”Ÿå¹³å°</li>
                <li><strong>æ°‘åŠè§„æ¨¡ï¼š</strong>å…¨å¸‚28æ‰€æ°‘åŠåˆä¸­ï¼Œè®¡åˆ’æ‹›ç”Ÿ12361äºº</li>
                <li><strong>è¥¿å’¸æ–°åŒºçº³å…¥åŸå…­åŒºæ‹›ç”Ÿï¼š</strong>è¥¿å’¸æ–°åŒºä¸åŸå…­åŒºæ‹›ç”Ÿæ”¿ç­–ç»Ÿä¸€</li>
            </ul>
        </div>

        <div class="step-indicator">
            <div class="step active" id="step1-indicator" onclick="showStep(1)"><div class="step-number">1</div><div class="step-label">èƒ½åŠ›è¯„ä¼°</div></div>
            <div class="step" id="step2-indicator" onclick="showStep(2)"><div class="step-number">2</div><div class="step-label">æˆ·ç±ä¸å±…ä½</div></div>
            <div class="step" id="step3-indicator" onclick="showStep(3)"><div class="step-number">3</div><div class="step-label">å­¦åŒºæˆ¿äº§</div></div>
            <div class="step" id="step4-indicator" onclick="showStep(4)"><div class="step-number">4</div><div class="step-label">æ°‘åŠæ„å‘</div></div>
            <div class="step" id="step5-indicator" onclick="showStep(5)"><div class="step-number">5</div><div class="step-label">æ·±åº¦éœ€æ±‚</div></div>
            <div class="step" id="step6-indicator" onclick="showStep(6)"><div class="step-number">6</div><div class="step-label">AIæ¨è</div></div>
        </div>

        <!-- æ­¥éª¤1ï¼šèƒ½åŠ›è¯„ä¼° -->
        <div id="step1" class="section active">
            <div class="dimension-card">
                <div class="dimension-title">ğŸ“š ç»´åº¦ä¸€ï¼šå­¦ä¸šæˆç»©</div>
                <div class="dimension-desc">è¯„ä¼°å­©å­åœ¨ç­çº§/å¹´çº§çš„å­¦ä¸šæˆç»©æ’åæƒ…å†µ</div>
                <div class="score-options">
                    <div class="score-option"><input type="radio" name="score1" id="s1-5" value="5"><label for="s1-5" class="score-label"><span class="score-number">5</span><span class="score-desc">å¹´çº§å‰5%</span></label></div>
                    <div class="score-option"><input type="radio" name="score1" id="s1-4" value="4"><label for="s1-4" class="score-label"><span class="score-number">4</span><span class="score-desc">å¹´çº§å‰15%</span></label></div>
                    <div class="score-option"><input type="radio" name="score1" id="s1-3" value="3"><label for="s1-3" class="score-label"><span class="score-number">3</span><span class="score-desc">å¹´çº§å‰30%</span></label></div>
                    <div class="score-option"><input type="radio" name="score1" id="s1-2" value="2"><label for="s1-2" class="score-label"><span class="score-number">2</span><span class="score-desc">å¹´çº§å‰50%</span></label></div>
                    <div class="score-option"><input type="radio" name="score1" id="s1-1" value="1"><label for="s1-1" class="score-label"><span class="score-number">1</span><span class="score-desc">å¹´çº§50%å</span></label></div>
                </div>
            </div>
            
            <div class="dimension-card">
                <div class="dimension-title">ğŸ¨ ç»´åº¦äºŒï¼šç»¼åˆç´ å…»</div>
                <div class="dimension-desc">ç‰¹é•¿ã€è·å¥–æƒ…å†µå’Œç»¼åˆå‘å±•æ°´å¹³</div>
                <div class="score-options">
                    <div class="score-option"><input type="radio" name="score2" id="s2-5" value="5"><label for="s2-5" class="score-label"><span class="score-number">5</span><span class="score-desc">çœçº§è·å¥–</span></label></div>
                    <div class="score-option"><input type="radio" name="score2" id="s2-4" value="4"><label for="s2-4" class="score-label"><span class="score-number">4</span><span class="score-desc">å¸‚çº§è¯ä¹¦</span></label></div>
                    <div class="score-option"><input type="radio" name="score2" id="s2-3" value="3"><label for="s2-3" class="score-label"><span class="score-number">3</span><span class="score-desc">æ ¡çº§è·å¥–</span></label></div>
                    <div class="score-option"><input type="radio" name="score2" id="s2-2" value="2"><label for="s2-2" class="score-label"><span class="score-number">2</span><span class="score-desc">å‚ä¸æ´»åŠ¨</span></label></div>
                    <div class="score-option"><input type="radio" name="score2" id="s2-1" value="1"><label for="s2-1" class="score-label"><span class="score-number">1</span><span class="score-desc">è¾ƒå°‘å‚ä¸</span></label></div>
                </div>
            </div>

            <div class="dimension-card">
                <div class="dimension-title">ğŸ“– ç»´åº¦ä¸‰ï¼šå­¦ä¹ ä¹ æƒ¯</div>
                <div class="dimension-desc">è‡ªå¾‹æ€§å’Œå­¦ä¹ ä¸»åŠ¨æ€§</div>
                <div class="score-options">
                    <div class="score-option"><input type="radio" name="score3" id="s3-5" value="5"><label for="s3-5" class="score-label"><span class="score-number">5</span><span class="score-desc">éå¸¸è‡ªå¾‹</span></label></div>
                    <div class="score-option"><input type="radio" name="score3" id="s3-4" value="4"><label for="s3-4" class="score-label"><span class="score-number">4</span><span class="score-desc">è¾ƒä¸ºè‡ªå¾‹</span></label></div>
                    <div class="score-option"><input type="radio" name="score3" id="s3-3" value="3"><label for="s3-3" class="score-label"><span class="score-number">3</span><span class="score-desc">éœ€è¦ç›‘ç£</span></label></div>
                    <div class="score-option"><input type="radio" name="score3" id="s3-2" value="2"><label for="s3-2" class="score-label"><span class="score-number">2</span><span class="score-desc">éœ€å¤šç£ä¿ƒ</span></label></div>
                    <div class="score-option"><input type="radio" name="score3" id="s3-1" value="1"><label for="s3-1" class="score-label"><span class="score-number">1</span><span class="score-desc">ä¹ æƒ¯è¾ƒå·®</span></label></div>
                </div>
            </div>

            <div class="dimension-card">
                <div class="dimension-title">ğŸ’ª ç»´åº¦å››ï¼šå¿ƒç†ç´ è´¨</div>
                <div class="dimension-desc">æŠ—å‹èƒ½åŠ›å’Œå¿ƒç†æ‰¿å—èƒ½åŠ›</div>
                <div class="score-options">
                    <div class="score-option"><input type="radio" name="score4" id="s4-5" value="5"><label for="s4-5" class="score-label"><span class="score-number">5</span><span class="score-desc">æŠ—å‹å¾ˆå¼º</span></label></div>
                    <div class="score-option"><input type="radio" name="score4" id="s4-4" value="4"><label for="s4-4" class="score-label"><span class="score-number">4</span><span class="score-desc">å¿ƒæ€ç¨³å®š</span></label></div>
                    <div class="score-option"><input type="radio" name="score4" id="s4-3" value="3"><label for="s4-3" class="score-label"><span class="score-number">3</span><span class="score-desc">ä¸€èˆ¬æ°´å¹³</span></label></div>
                    <div class="score-option"><input type="radio" name="score4" id="s4-2" value="2"><label for="s4-2" class="score-label"><span class="score-number">2</span><span class="score-desc">å®¹æ˜“ç„¦è™‘</span></label></div>
                    <div class="score-option"><input type="radio" name="score4" id="s4-1" value="1"><label for="s4-1" class="score-label"><span class="score-number">1</span><span class="score-desc">éœ€è¦å…³æ³¨</span></label></div>
                </div>
            </div>

            <div class="dimension-card">
                <div class="dimension-title">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ç»´åº¦äº”ï¼šå®¶åº­æ”¯æŒ</div>
                <div class="dimension-desc">å®¶åº­åœ¨æ—¶é—´ã€ç»æµã€ç²¾åŠ›æ–¹é¢çš„æ”¯æŒ</div>
                <div class="score-options">
                    <div class="score-option"><input type="radio" name="score5" id="s5-5" value="5"><label for="s5-5" class="score-label"><span class="score-number">5</span><span class="score-desc">å…¨åŠ›æ”¯æŒ</span></label></div>
                    <div class="score-option"><input type="radio" name="score5" id="s5-4" value="4"><label for="s5-4" class="score-label"><span class="score-number">4</span><span class="score-desc">ç§¯ææ”¯æŒ</span></label></div>
                    <div class="score-option"><input type="radio" name="score5" id="s5-3" value="3"><label for="s5-3" class="score-label"><span class="score-number">3</span><span class="score-desc">ä¸€èˆ¬æ”¯æŒ</span></label></div>
                    <div class="score-option"><input type="radio" name="score5" id="s5-2" value="2"><label for="s5-2" class="score-label"><span class="score-number">2</span><span class="score-desc">æœ‰é™æ”¯æŒ</span></label></div>
                    <div class="score-option"><input type="radio" name="score5" id="s5-1" value="1"><label for="s5-1" class="score-label"><span class="score-number">1</span><span class="score-desc">æ”¯æŒä¸è¶³</span></label></div>
                </div>
            </div>

            <div class="dimension-card">
                <div class="dimension-title">ğŸ”¬ ç»´åº¦å…­ï¼šå­¦ç§‘å€¾å‘</div>
                <div class="dimension-desc">å­©å­çš„å­¦ç§‘ä¼˜åŠ¿å’Œå…´è¶£æ–¹å‘</div>
                <div class="score-options">
                    <div class="score-option"><input type="radio" name="score6" id="s6-5" value="5"><label for="s6-5" class="score-label"><span class="score-number">5</span><span class="score-desc">ç†ç§‘ä¼˜åŠ¿</span></label></div>
                    <div class="score-option"><input type="radio" name="score6" id="s6-4" value="4"><label for="s6-4" class="score-label"><span class="score-number">4</span><span class="score-desc">æ–‡ç§‘ä¼˜åŠ¿</span></label></div>
                    <div class="score-option"><input type="radio" name="score6" id="s6-3" value="3"><label for="s6-3" class="score-label"><span class="score-number">3</span><span class="score-desc">å‡è¡¡å‘å±•</span></label></div>
                    <div class="score-option"><input type="radio" name="score6" id="s6-2" value="2"><label for="s6-2" class="score-label"><span class="score-number">2</span><span class="score-desc">æœ‰åç§‘</span></label></div>
                    <div class="score-option"><input type="radio" name="score6" id="s6-1" value="1"><label for="s6-1" class="score-label"><span class="score-number">1</span><span class="score-desc">å­¦ä¹ å›°éš¾</span></label></div>
                </div>
            </div>
            <div class="button-group"><button class="btn btn-primary" onclick="goToStep2()">ä¸‹ä¸€æ­¥ï¼šæˆ·ç±ä¸å±…ä½ä¿¡æ¯ â†’</button></div>
        </div>

        <!-- æ­¥éª¤2ï¼šæˆ·ç±ä¸å±…ä½ä¿¡æ¯ -->
        <div id="step2" class="section">
            <div class="info-section">
                <h3>ğŸ  æˆ·ç±ä¸å±…ä½ä¿¡æ¯</h3>
                <p style="color: #718096; margin-bottom: 20px; font-size: 14px;">è¯·å‡†ç¡®å¡«å†™æˆ·ç±å’Œå®é™…å±…ä½ä¿¡æ¯ï¼Œè¿™å°†ç›´æ¥å½±å“å…¬åŠå­¦æ ¡åŒ¹é…å’Œå…¥å­¦é¡ºä½è¯„ä¼°</p>
                
                <div class="location-grid">
                    <!-- æˆ·ç±ä¿¡æ¯ -->
                    <div class="location-section">
                        <h4>ğŸ“ æˆ·ç±ä¿¡æ¯</h4>
                        <div class="info-group">
                            <label class="info-label">æˆ·ç±æ‰€åœ¨åŒº</label>
                            <select class="info-select" id="householdDistrict">
                                <option value="">è¯·é€‰æ‹©åŒº</option>
                                <option value="é›å¡”åŒº">é›å¡”åŒº</option>
                                <option value="ç¢‘æ—åŒº">ç¢‘æ—åŒº</option>
                                <option value="æ–°åŸåŒº">æ–°åŸåŒº</option>
                                <option value="è²æ¹–åŒº">è²æ¹–åŒº</option>
                                <option value="æœªå¤®åŒº">æœªå¤®åŒº</option>
                                <option value="çæ¡¥åŒº">çæ¡¥åŒº</option>
                                <option value="é•¿å®‰åŒº">é•¿å®‰åŒº</option>
                                <option value="é«˜æ–°åŒº">é«˜æ–°åŒº</option>
                                <option value="æ›²æ±Ÿæ–°åŒº">æ›²æ±Ÿæ–°åŒº</option>
                                <option value="ç»å¼€åŒº">ç»å¼€åŒº</option>
                                <option value="æµçç”Ÿæ€åŒº">æµçç”Ÿæ€åŒº</option>
                                <option value="èˆªå¤©åŸºåœ°">èˆªå¤©åŸºåœ°</option>
                                <option value="è¥¿å’¸æ–°åŒº">è¥¿å’¸æ–°åŒº</option>
                                <option value="å¤–åœ°æˆ·ç±">å¤–åœ°æˆ·ç±</option>
                            </select>
                        </div>
                        <div class="info-group">
                            <label class="info-label">æˆ·ç±æ‰€åœ¨è¡—é“</label>
                            <select class="info-select" id="householdStreet">
                                <option value="">è¯·å…ˆé€‰æ‹©åŒº</option>
                            </select>
                        </div>
                        <div class="info-group">
                            <label class="info-label">æˆ·ç±è¯¦ç»†åœ°å€ï¼ˆå¯é€‰ï¼‰</label>
                            <input type="text" class="info-input" id="householdAddress" placeholder="ä¾‹å¦‚ï¼šXXå°åŒºXXå·æ¥¼XXå•å…ƒ">
                        </div>
                    </div>

                    <!-- å±…ä½ä¿¡æ¯ -->
                    <div class="location-section">
                        <h4>ğŸ¡ å®é™…å±…ä½ä¿¡æ¯</h4>
                        <div class="info-group">
                            <label class="info-label">å®é™…å±…ä½åŒº</label>
                            <select class="info-select" id="residenceDistrict">
                                <option value="">è¯·é€‰æ‹©åŒº</option>
                                <option value="é›å¡”åŒº">é›å¡”åŒº</option>
                                <option value="ç¢‘æ—åŒº">ç¢‘æ—åŒº</option>
                                <option value="æ–°åŸåŒº">æ–°åŸåŒº</option>
                                <option value="è²æ¹–åŒº">è²æ¹–åŒº</option>
                                <option value="æœªå¤®åŒº">æœªå¤®åŒº</option>
                                <option value="çæ¡¥åŒº">çæ¡¥åŒº</option>
                                <option value="é•¿å®‰åŒº">é•¿å®‰åŒº</option>
                                <option value="é«˜æ–°åŒº">é«˜æ–°åŒº</option>
                                <option value="æ›²æ±Ÿæ–°åŒº">æ›²æ±Ÿæ–°åŒº</option>
                                <option value="ç»å¼€åŒº">ç»å¼€åŒº</option>
                                <option value="æµçç”Ÿæ€åŒº">æµçç”Ÿæ€åŒº</option>
                                <option value="èˆªå¤©åŸºåœ°">èˆªå¤©åŸºåœ°</option>
                                <option value="è¥¿å’¸æ–°åŒº">è¥¿å’¸æ–°åŒº</option>
                            </select>
                        </div>
                        <div class="info-group">
                            <label class="info-label">å®é™…å±…ä½è¡—é“</label>
                            <select class="info-select" id="residenceStreet">
                                <option value="">è¯·å…ˆé€‰æ‹©åŒº</option>
                            </select>
                        </div>
                        <div class="info-group">
                            <label class="info-label">å±…ä½è¯¦ç»†åœ°å€</label>
                            <input type="text" class="info-input" id="residenceAddress" placeholder="ä¾‹å¦‚ï¼šXXå°åŒºXXå·æ¥¼XXå•å…ƒ">
                        </div>
                        <div class="info-group">
                            <label class="info-label">å±…ä½æ€§è´¨</label>
                            <select class="info-select" id="residenceType">
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="è‡ªæœ‰æˆ¿äº§">è‡ªæœ‰æˆ¿äº§</option>
                                <option value="ç§Ÿæˆ¿">ç§Ÿæˆ¿</option>
                                <option value="å•ä½å®¿èˆ">å•ä½å®¿èˆ</option>
                                <option value="å…¶ä»–">å…¶ä»–</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- å±…ä½åŒ¹é…æƒ…å†µ -->
                <div class="info-group">
                    <label class="info-label">æˆ·ç±ä¸å±…ä½åœ°åŒ¹é…æƒ…å†µ</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label"><input type="checkbox" id="sameDistrict"> æˆ·ç±åŒºä¸å±…ä½åŒºç›¸åŒ</label>
                        <label class="checkbox-label"><input type="checkbox" id="sameStreet"> æˆ·ç±è¡—é“ä¸å±…ä½è¡—é“ç›¸åŒ</label>
                        <label class="checkbox-label"><input type="checkbox" id="inSchoolDistrict"> åœ¨å­¦åŒºå†…å±…ä½</label>
                    </div>
                </div>

                <div class="transport-info">
                    <h5>ğŸš— äº¤é€šä¾¿åˆ©æ€§è¯„ä¼°</h5>
                    <p style="font-size: 13px; color: #4a5568;">ç³»ç»Ÿå°†æ ¹æ®æ‚¨çš„å±…ä½ä½ç½®è¯„ä¼°åˆ°æ¨èå­¦æ ¡çš„é€šå‹¤æ—¶é—´ï¼Œä¼˜å…ˆæ¨èäº¤é€šä¾¿åˆ©çš„å­¦æ ¡</p>
                </div>
            </div>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="goToStep1()">â† ä¸Šä¸€æ­¥</button>
                <button class="btn btn-primary" onclick="goToStep3()">ä¸‹ä¸€æ­¥ï¼šå­¦åŒºæˆ¿äº§ä¿¡æ¯ â†’</button>
            </div>
        </div>

        <!-- æ­¥éª¤3ï¼šå­¦åŒºæˆ¿äº§ä¿¡æ¯ -->
        <div id="step3" class="section">
            <div class="info-section">
                <h3>ğŸ“‹ å­¦åŒºæˆ¿äº§ä¿¡æ¯</h3>
                <p style="color: #718096; margin-bottom: 20px; font-size: 14px;">å…¬åŠå­¦æ ¡å…¥å­¦èµ„æ ¼ç›¸å…³ä¿¡æ¯ï¼Œè¯·å¦‚å®å¡«å†™</p>
                
                <div class="info-group">
                    <label class="info-label">å­¦åŒºæˆ¿æƒ…å†µ</label>
                    <select class="info-select" id="hasHouse">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="yes-good">æœ‰ï¼Œå¯¹å£ä¼˜è´¨å…¬åŠ</option>
                        <option value="yes-normal">æœ‰ï¼Œå¯¹å£ä¸€èˆ¬å…¬åŠ</option>
                        <option value="no">æš‚æ— å­¦åŒºæˆ¿</option>
                        <option value="rent">ç§Ÿæˆ¿å±…ä½</option>
                    </select>
                </div>

                <div class="info-group">
                    <label class="info-label">æˆ¿äº§è¯ç±»å‹</label>
                    <select class="info-select" id="propertyType">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="å•†å“æˆ¿">å•†å“æˆ¿</option>
                        <option value="æˆ¿æ”¹æˆ¿">æˆ¿æ”¹æˆ¿</option>
                        <option value="å®‰ç½®æˆ¿">å®‰ç½®æˆ¿</option>
                        <option value="ç»æµé€‚ç”¨æˆ¿">ç»æµé€‚ç”¨æˆ¿</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                </div>

                <div class="info-group">
                    <label class="info-label">æˆ¿äº§æŒæœ‰æ—¶é—´</label>
                    <select class="info-select" id="propertyYears">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="3å¹´ä»¥ä¸Š">3å¹´ä»¥ä¸Š</option>
                        <option value="1-3å¹´">1-3å¹´</option>
                        <option value="1å¹´ä»¥å†…">1å¹´ä»¥å†…</option>
                        <option value="æ–°è´­">æ–°è´­ï¼ˆæœªæ»¡1å¹´ï¼‰</option>
                    </select>
                </div>

                <div class="info-group">
                    <label class="info-label">é¢„ä¼°å…¥å­¦é¡ºä½</label>
                    <div style="background: #f0fff4; padding: 15px; border-radius: 8px; border: 1px solid #c6f6d5;">
                        <div id="admissionPriority" style="color: #276749; font-weight: 600;">è¯·å¡«å†™ä»¥ä¸Šä¿¡æ¯åè‡ªåŠ¨è¯„ä¼°</div>
                        <div id="priorityReason" style="color: #718096; font-size: 13px; margin-top: 5px;">åŸºäºè¥¿å®‰å¸‚å…¬åŠå…¥å­¦æ”¿ç­–è¯„ä¼°</div>
                    </div>
                </div>

                <div class="policy-box">
                    <h4>ğŸ“ è¥¿å®‰å¸‚å…¬åŠå…¥å­¦é¡ºä½è¯´æ˜</h4>
                    <p><strong>ç¬¬ä¸€é¡ºä½ï¼š</strong>æˆ¿æˆ·ä¸€è‡´ï¼Œä¸”åœ¨å­¦åŒºå†…å±…ä½</p>
                    <p><strong>ç¬¬äºŒé¡ºä½ï¼š</strong>æˆ¿æˆ·ä¸€è‡´ï¼Œä½†è·¨å­¦åŒºå±…ä½</p>
                    <p><strong>ç¬¬ä¸‰é¡ºä½ï¼š</strong>é›†ä½“æˆ·/æŒ‚é æˆ·ï¼Œæ— å­¦åŒºæˆ¿</p>
                    <p><strong>ç¬¬å››é¡ºä½ï¼š</strong>ç§Ÿæˆ¿å±…ä½ï¼Œç»Ÿç­¹å®‰æ’å…¥å­¦</p>
                </div>
            </div>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="goToStep2()">â† ä¸Šä¸€æ­¥</button>
                <button class="btn btn-primary" onclick="goToStep4()">ä¸‹ä¸€æ­¥ï¼šæ°‘åŠæ„å‘ä¸é¢„ç®— â†’</button>
            </div>
        </div>

        <!-- æ­¥éª¤4ï¼šæ°‘åŠæ„å‘ä¸é¢„ç®— -->
        <div id="step4" class="section">
            <div class="info-section">
                <h3>ğŸ’° æ°‘åŠæ„å‘ä¸é¢„ç®—</h3>
                
                <div class="info-group">
                    <label class="info-label">æ˜¯å¦è€ƒè™‘æ°‘åŠå­¦æ ¡</label>
                    <select class="info-select" id="considerPrivate">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="yes">æ˜¯ï¼Œæ„¿æ„å‚åŠ æ‘‡å·</option>
                        <option value="cautious">è§‚æœ›ä¸­ï¼Œçœ‹æƒ…å†µå†³å®š</option>
                        <option value="no">å¦ï¼Œåªè€ƒè™‘å…¬åŠ</option>
                    </select>
                </div>

                <div class="info-group">
                    <label class="info-label">å¯æ¥å—çš„è·¨åŒºèŒƒå›´</label>
                    <select class="info-select" id="crossDistrictPreference">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="æœ¬åŒº">ä»…é™æœ¬åŒºå­¦æ ¡</option>
                        <option value="ç›¸é‚»åŒº">æœ¬åŒºåŠç›¸é‚»åŒº</option>
                        <option value="å…¨å¸‚èŒƒå›´">å…¨å¸‚èŒƒå›´å‡å¯</option>
                    </select>
                </div>

                <div class="info-group">
                    <label class="info-label">æ°‘åŠå­¦æ ¡é¢„ç®—ï¼ˆåˆä¸­ä¸‰å¹´ï¼‰</label>
                    <select class="info-select" id="budget">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="low">3ä¸‡ä»¥å†…ï¼ˆå…¬åŠä¸ºä¸»ï¼‰</option>
                        <option value="medium">3-10ä¸‡ï¼ˆå¯è€ƒè™‘æ°‘åŠï¼‰</option>
                        <option value="high">10ä¸‡ä»¥ä¸Šï¼ˆæ°‘åŠæ— å‹åŠ›ï¼‰</option>
                    </select>
                </div>

                <div class="info-group">
                    <label class="info-label">å¯¹æ‘‡å·ä¸ç¡®å®šæ€§çš„æ€åº¦</label>
                    <select class="info-select" id="acceptLottery">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="yes">æ¥å—ï¼Œæ„¿æ„å†²åˆºçƒ­é—¨æ ¡</option>
                        <option value="cautious">è°¨æ…ï¼Œå¸Œæœ›ç¨³å¦¥ä¸ºä¸»</option>
                        <option value="no">ä¸æ¥å—ï¼Œå¿…é¡»ç¡®å®šæ€§</option>
                    </select>
                </div>

                <div class="info-group">
                    <label class="info-label">å­©å­ç‰¹é•¿ï¼ˆå¯å¤šé€‰ï¼‰</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label"><input type="checkbox" value="æ•°å­¦" class="strength-check"> æ•°å­¦</label>
                        <label class="checkbox-label"><input type="checkbox" value="è¯­æ–‡" class="strength-check"> è¯­æ–‡</label>
                        <label class="checkbox-label"><input type="checkbox" value="è‹±è¯­" class="strength-check"> è‹±è¯­</label>
                        <label class="checkbox-label"><input type="checkbox" value="è‰ºæœ¯" class="strength-check"> è‰ºæœ¯</label>
                        <label class="checkbox-label"><input type="checkbox" value="ä½“è‚²" class="strength-check"> ä½“è‚²</label>
                        <label class="checkbox-label"><input type="checkbox" value="ç§‘æŠ€" class="strength-check"> ç§‘æŠ€</label>
                    </div>
                </div>
            </div>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="goToStep3()">â† ä¸Šä¸€æ­¥</button>
                <button class="btn btn-primary" onclick="goToStep5()">ä¸‹ä¸€æ­¥ï¼šæ·±åº¦éœ€æ±‚åˆ†æ â†’</button>
            </div>
        </div>

        <!-- æ­¥éª¤5ï¼šæ·±åº¦éœ€æ±‚åˆ†æ -->
        <div id="step5" class="section">
            <div class="feedback-section">
                <h3>ğŸ¯ æ·±åº¦éœ€æ±‚åˆ†æ</h3>
                
                <div class="feedback-group">
                    <label class="feedback-label">åˆä¸­åçš„å­¦ä¸šè§„åˆ’</label>
                    <select class="feedback-select" id="academicGoals">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="å†²åˆºé‡ç‚¹é«˜ä¸­">å†²åˆºé‡ç‚¹é«˜ä¸­</option>
                        <option value="ç¨³å®šå‡å…¥æ™®é€šé«˜ä¸­" selected>ç¨³å®šå‡å…¥æ™®é€šé«˜ä¸­</option>
                        <option value="è€ƒè™‘å›½é™…æ•™è‚²è·¯å¾„">è€ƒè™‘å›½é™…æ•™è‚²è·¯å¾„</option>
                        <option value="å°šæœªæ˜ç¡®è§„åˆ’">å°šæœªæ˜ç¡®è§„åˆ’</option>
                        <option value="æ ¹æ®å­©å­å‘å±•å†å®š">æ ¹æ®å­©å­å‘å±•å†å®š</option>
                    </select>
                </div>

                <div class="feedback-group">
                    <label class="feedback-label">æ›´çœ‹é‡å­¦æ ¡çš„å“ªäº›æ–¹é¢ï¼ˆå¯å¤šé€‰ï¼‰</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label"><input type="checkbox" value="å­¦æœ¯æˆç»©å’Œå‡å­¦ç‡" class="philosophy-check" checked> å­¦æœ¯æˆç»©å’Œå‡å­¦ç‡</label>
                        <label class="checkbox-label"><input type="checkbox" value="ç»¼åˆç´ è´¨åŸ¹å…»" class="philosophy-check" checked> ç»¼åˆç´ è´¨åŸ¹å…»</label>
                        <label class="checkbox-label"><input type="checkbox" value="ç‰¹è‰²è¯¾ç¨‹å’Œç¤¾å›¢æ´»åŠ¨" class="philosophy-check" checked> ç‰¹è‰²è¯¾ç¨‹å’Œç¤¾å›¢æ´»åŠ¨</label>
                        <label class="checkbox-label"><input type="checkbox" value="å­¦æ ¡ç®¡ç†å’Œæ ¡é£" class="philosophy-check" checked> å­¦æ ¡ç®¡ç†å’Œæ ¡é£</label>
                        <label class="checkbox-label"><input type="checkbox" value="å¸ˆç”Ÿå…³ç³»å’Œæ ¡å›­æ°›å›´" class="philosophy-check" checked> å¸ˆç”Ÿå…³ç³»å’Œæ ¡å›­æ°›å›´</label>
                        <label class="checkbox-label"><input type="checkbox" value="åœ°ç†ä½ç½®å’Œäº¤é€šä¾¿åˆ©" class="philosophy-check" checked> åœ°ç†ä½ç½®å’Œäº¤é€šä¾¿åˆ©</label>
                    </div>
                </div>

                <div class="feedback-group">
                    <label class="feedback-label">å­©å­çš„ç‰¹æ®Šéœ€æ±‚</label>
                    <select class="feedback-select" id="specificNeeds">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="éœ€è¦é‡ç‚¹å…³æ³¨å’Œè¾…å¯¼">éœ€è¦é‡ç‚¹å…³æ³¨å’Œè¾…å¯¼</option>
                        <option value="æœ‰è‰ºæœ¯ä½“è‚²ç‰¹é•¿éœ€è¦å‘å±•">æœ‰è‰ºæœ¯ä½“è‚²ç‰¹é•¿éœ€è¦å‘å±•</option>
                        <option value="éœ€è¦å¤–è¯­ç‰¹è‰²ç¯å¢ƒ">éœ€è¦å¤–è¯­ç‰¹è‰²ç¯å¢ƒ</option>
                        <option value="éœ€è¦ä½æ ¡æˆ–æ™šæ‰˜æœåŠ¡" selected>éœ€è¦ä½æ ¡æˆ–æ™šæ‰˜æœåŠ¡</option>
                        <option value="å¯¹æ ¡å›­è®¾æ–½æœ‰ç‰¹æ®Šè¦æ±‚">å¯¹æ ¡å›­è®¾æ–½æœ‰ç‰¹æ®Šè¦æ±‚</option>
                        <option value="æ— ç‰¹æ®Šéœ€æ±‚">æ— ç‰¹æ®Šéœ€æ±‚</option>
                    </select>
                </div>

                <div class="feedback-group">
                    <label class="feedback-label">æ•™è‚²é€‰æ‹©çš„é£é™©åå¥½</label>
                    <select class="feedback-select" id="riskTolerance">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="æ„¿æ„å†’é™©è¿½æ±‚æœ€å¥½å­¦æ ¡">æ„¿æ„å†’é™©è¿½æ±‚æœ€å¥½å­¦æ ¡</option>
                        <option value="åå¥½ç¨³å¦¥å¯é çš„é€‰æ‹©" selected>åå¥½ç¨³å¦¥å¯é çš„é€‰æ‹©</option>
                        <option value="å¸Œæœ›åœ¨é£é™©å’Œæ”¶ç›Šé—´å¹³è¡¡">å¸Œæœ›åœ¨é£é™©å’Œæ”¶ç›Šé—´å¹³è¡¡</option>
                        <option value="å®Œå…¨è§„é¿ä¸ç¡®å®šæ€§">å®Œå…¨è§„é¿ä¸ç¡®å®šæ€§</option>
                    </select>
                </div>

                <div class="feedback-group">
                    <label class="feedback-label">å®¶åº­å¯æŠ•å…¥çš„æ•™è‚²æ—¶é—´</label>
                    <select class="feedback-select" id="timeCommitment">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="å…¨èŒé™ªä¼´å’Œè¾…å¯¼">å…¨èŒé™ªä¼´å’Œè¾…å¯¼</option>
                        <option value="å·¥ä½œæ—¥æ™šä¸Šå¯è¾…å¯¼">å·¥ä½œæ—¥æ™šä¸Šå¯è¾…å¯¼</option>
                        <option value="å‘¨æœ«å¯é›†ä¸­é™ªä¼´" selected>å‘¨æœ«å¯é›†ä¸­é™ªä¼´</option>
                        <option value="æ—¶é—´æœ‰é™ä¸»è¦é å­¦æ ¡">æ—¶é—´æœ‰é™ä¸»è¦é å­¦æ ¡</option>
                        <option value="éœ€è¦å­¦æ ¡å…¨æƒè´Ÿè´£">éœ€è¦å­¦æ ¡å…¨æƒè´Ÿè´£</option>
                    </select>
                </div>
            </div>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="goToStep4()">â† ä¸Šä¸€æ­¥</button>
                <button class="btn btn-primary" onclick="generateReport()">ç”Ÿæˆåˆ†ææŠ¥å‘Š â†’</button>
            </div>
        </div>

        <!-- æ­¥éª¤6ï¼šAIæ¨è -->
        <div id="step6" class="section">
            <div class="result-card">
                <div class="result-title">ğŸ« AIæ™ºèƒ½å­¦æ ¡æ¨è</div>
                <div id="schoolRecommendation"><div class="ai-loading"><div class="ai-loading-spinner"></div><p>AIæ­£åœ¨åˆ†æ...</p></div></div>
            </div>
            <div class="result-card">
                <div class="result-title">ğŸ“… ä¸ªæ€§åŒ–æ—¶é—´è§„åˆ’</div>
                <div id="timeline"></div>
            </div>
            <div class="result-card">
                <div class="result-title">ğŸ’¡ æ”¿ç­–æé†’ä¸å»ºè®®</div>
                <div id="policyAdvice"></div>
            </div>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="goToStep5()">â† è¿”å›ä¿®æ”¹</button>
                <button class="btn btn-primary" onclick="window.print()">ğŸ–¨ï¸ æ‰“å°æŠ¥å‘Š</button>
                <button class="btn btn-secondary" onclick="resetAll()">ğŸ”„ é‡æ–°è¯„ä¼°</button>
            </div>
        </div>
    </div>

<script>
// ========== å…¨å±€é…ç½®ä¸æ•°æ® ==========
const CONFIG = { apiKey: '', appId: '', isConnected: false };
let assessmentData = { scores: {}, familyInfo: {}, totalScore: 0 };
let radarChart = null;
let isDragging = false;
let dragOffsetX = 0;
let dragOffsetY = 0;

// æƒé‡é…ç½®
const DIMENSION_WEIGHTS = {
    score1: 0.30, score2: 0.15, score3: 0.25, 
    score4: 0.10, score5: 0.10, score6: 0.10
};

// è¥¿å®‰å¸‚è¡—é“æ•°æ® - å®Œå–„è¥¿å’¸æ–°åŒºè¡—é“
const DISTRICT_STREETS = {
    'é›å¡”åŒº': ['å°å¯¨è·¯è¡—é“', 'é•¿å»¶å ¡è¡—é“', 'å¤§é›å¡”è¡—é“', 'ç”µå­åŸè¡—é“', 'ç­‰é©¾å¡è¡—é“', 'æ›²æ±Ÿè¡—é“'],
    'ç¢‘æ—åŒº': ['é•¿å®‰è·¯è¡—é“', 'æ–‡è‰ºè·¯è¡—é“', 'æŸæ ‘æ—è¡—é“', 'ä¸œå…³å—è¡—è¡—é“', 'å¤ªä¹™è·¯è¡—é“', 'å—é™¢é—¨è¡—é“'],
    'æ–°åŸåŒº': ['è§£æ”¾é—¨è¡—é“', 'ä¸­å±±é—¨è¡—é“', 'éŸ©æ£®å¯¨è¡—é“', 'èƒ¡å®¶åº™è¡—é“', 'é•¿ä¹ä¸­è·¯è¡—é“', 'è‡ªå¼ºè·¯è¡—é“'],
    'è²æ¹–åŒº': ['åŒ—é™¢é—¨è¡—é“', 'é’å¹´è·¯è¡—é“', 'åº™åè¡—è¡—é“', 'è¥¿å…³è¡—é“', 'åœŸé—¨è¡—é“', 'çº¢åº™å¡è¡—é“'],
    'æœªå¤®åŒº': ['å¼ å®¶å ¡è¡—é“', 'ä¸‰æ¡¥è¡—é“', 'è¾›å®¶åº™è¡—é“', 'å¾å®¶æ¹¾è¡—é“', 'å¤§æ˜å®«è¡—é“', 'è°­å®¶è¡—é“'],
    'çæ¡¥åŒº': ['çººç»‡åŸè¡—é“', 'çº¢æ——è¡—é“', 'æ´ªåº†è¡—é“', 'ç‹„å¯¨è¡—é“', 'å¸­ç‹è¡—é“', 'æ–°ç­‘è¡—é“'],
    'é•¿å®‰åŒº': ['éŸ¦æ›²è¡—é“', 'éƒ­æœè¡—é“', 'æ»¦é•‡è¡—é“', 'å¼•é•‡è¡—é“', 'ç‹æ›²è¡—é“', 'å­åˆè¡—é“'],
    'é«˜æ–°åŒº': ['ä¸ˆå…«æ²Ÿè¡—é“', 'é±¼åŒ–å¯¨è¡—é“', 'ç»†æŸ³è¡—é“', 'å…´éš†è¡—é“', 'çµæ²¼è¡—é“', 'ä¸œå¤§è¡—é“'],
    'æ›²æ±Ÿæ–°åŒº': ['æ›²æ±Ÿè¡—é“', 'å¤§é›å¡”è¡—é“', 'ç­‰é©¾å¡è¡—é“'],
    'ç»å¼€åŒº': ['å‡¤åŸè·¯è¡—é“', 'å¼ å®¶å ¡è¡—é“', 'æœªå¤®å®«è¡—é“'],
    'æµçç”Ÿæ€åŒº': ['è¾›å®¶åº™è¡—é“', 'çæ¡¥è¡—é“', 'æœªå¤®æ¹–è¡—é“'],
    'èˆªå¤©åŸºåœ°': ['éŸ¦æ›²è¡—é“', 'æœé™µè¡—é“'],
    'è¥¿å’¸æ–°åŒº': [
        // ç§¦æ±‰æ–°åŸè¡—é“
        'æ­£é˜³è¡—é“', 'çª‘åº—è¡—é“', 'æ¸­åŸè¡—é“', 'å‘¨é™µè¡—é“', 'åŒç…§è¡—é“', 'å—ä½é•‡', 'é©¬åº„é•‡',
        // ç©ºæ¸¯æ–°åŸè¡—é“  
        'åº•å¼ è¡—é“', 'åŒ—æœè¡—é“', 'å¤ªå¹³é•‡', 'æ¸­åŸè¡—é“(éƒ¨åˆ†)',
        // æ³¾æ²³æ–°åŸè¡—é“
        'æ°¸ä¹é•‡', 'å´‡æ–‡é•‡', 'é«˜åº„é•‡', 'æ³¾å¹²è¡—é“',
        // æ²£ä¸œæ–°åŸè¡—é“
        'ä¸‰æ¡¥è¡—é“', 'ç‹å¯ºè¡—é“', 'æ–—é—¨è¡—é“', 'é«˜æ¡¥è¡—é“', 'å»ºç« è·¯è¡—é“', 'ä¸Šæ—è¡—é“', 'æ²£ä¸œè¡—é“',
        // æ²£è¥¿æ–°åŸè¡—é“
        'é’“å°è¡—é“', 'é©¬ç‹è¡—é“', 'å¤§ç‹è¡—é“', 'é«˜æ¡¥è¡—é“(éƒ¨åˆ†)', 'é™ˆæ¨å¯¨è¡—é“(éƒ¨åˆ†)'
    ],
    'å¤–åœ°æˆ·ç±': ['å…¶ä»–è¡—é“']
};

// è¥¿å’¸æ–°åŒºå„æ–°åŸå¯¹åº”çš„å­¦æ ¡æ•°æ®
const XIANYANG_SCHOOLS = {
    'ç§¦æ±‰æ–°åŸ': [
        { name: 'ç§¦æ±‰ä¸­å­¦', type: 'å…¬åŠ', feature: 'çœçº§ç¤ºèŒƒé«˜ä¸­ï¼Œæ•™å­¦è´¨é‡ä¼˜ç§€', match: 'é«˜' },
        { name: 'æ­£é˜³ç¬¬ä¸€å­¦æ ¡', type: 'å…¬åŠ', feature: 'ä¹å¹´ä¸€è´¯åˆ¶ï¼Œç¡¬ä»¶è®¾æ–½å®Œå–„', match: 'ä¸­' }
    ],
    'ç©ºæ¸¯æ–°åŸ': [
        { name: 'ç©ºæ¸¯å®éªŒå­¦æ ¡', type: 'å…¬åŠ', feature: 'æ–°å»ºå­¦æ ¡ï¼Œå›½é™…åŒ–åŠå­¦ç†å¿µ', match: 'é«˜' },
        { name: 'åº•å¼ è¡—é“ä¸­å¿ƒå°å­¦', type: 'å…¬åŠ', feature: 'ä¼ ç»Ÿä¼˜è´¨å°å­¦ï¼Œå¸ˆèµ„ç¨³å®š', match: 'ä¸­' }
    ],
    'æ³¾æ²³æ–°åŸ': [
        { name: 'æ³¾æ²³ç¬¬ä¸€ä¸­å­¦', type: 'å…¬åŠ', feature: 'é‡ç‚¹å»ºè®¾å­¦æ ¡ï¼Œç†ç§‘ç‰¹è‰²', match: 'é«˜' },
        { name: 'å´‡æ–‡ä¸­å­¦', type: 'å…¬åŠ', feature: 'æ–‡åŒ–æ°›å›´æµ“åšï¼Œæ–‡ç§‘ä¼˜åŠ¿', match: 'ä¸­' }
    ],
    'æ²£ä¸œæ–°åŸ': [
        { name: 'æ²£ä¸œç¬¬ä¸€å­¦æ ¡', type: 'å…¬åŠ', feature: 'ç°ä»£åŒ–æ ¡å›­ï¼Œç»¼åˆå‘å±•', match: 'é«˜' },
        { name: 'ä¸‰æ¡¥è¡—å°å­¦', type: 'å…¬åŠ', feature: 'å†å²æ‚ ä¹…çš„ä¼˜è´¨å­¦æ ¡', match: 'ä¸­' }
    ],
    'æ²£è¥¿æ–°åŸ': [
        { name: 'æ²£è¥¿å®éªŒå­¦æ ¡', type: 'å…¬åŠ', feature: 'ç§‘æŠ€åˆ›æ–°ç‰¹è‰²ï¼Œæ™ºæ…§æ ¡å›­', match: 'é«˜' },
        { name: 'é’“å°è¡—é“ä¸­å­¦', type: 'å…¬åŠ', feature: 'ç¤¾åŒºé…å¥—å­¦æ ¡ï¼Œå°±è¿‘ä¾¿åˆ©', match: 'ä¸­' }
    ]
};

// æ ¹æ®è¡—é“åˆ¤æ–­æ‰€å±æ–°åŸ
function getXianyangAreaByStreet(street) {
    const areaMapping = {
        // ç§¦æ±‰æ–°åŸ
        'æ­£é˜³è¡—é“': 'ç§¦æ±‰æ–°åŸ', 'çª‘åº—è¡—é“': 'ç§¦æ±‰æ–°åŸ', 'æ¸­åŸè¡—é“': 'ç§¦æ±‰æ–°åŸ', 
        'å‘¨é™µè¡—é“': 'ç§¦æ±‰æ–°åŸ', 'åŒç…§è¡—é“': 'ç§¦æ±‰æ–°åŸ', 'å—ä½é•‡': 'ç§¦æ±‰æ–°åŸ', 'é©¬åº„é•‡': 'ç§¦æ±‰æ–°åŸ',
        // ç©ºæ¸¯æ–°åŸ
        'åº•å¼ è¡—é“': 'ç©ºæ¸¯æ–°åŸ', 'åŒ—æœè¡—é“': 'ç©ºæ¸¯æ–°åŸ', 'å¤ªå¹³é•‡': 'ç©ºæ¸¯æ–°åŸ', 'æ¸­åŸè¡—é“(éƒ¨åˆ†)': 'ç©ºæ¸¯æ–°åŸ',
        // æ³¾æ²³æ–°åŸ
        'æ°¸ä¹é•‡': 'æ³¾æ²³æ–°åŸ', 'å´‡æ–‡é•‡': 'æ³¾æ²³æ–°åŸ', 'é«˜åº„é•‡': 'æ³¾æ²³æ–°åŸ', 'æ³¾å¹²è¡—é“': 'æ³¾æ²³æ–°åŸ',
        // æ²£ä¸œæ–°åŸ
        'ä¸‰æ¡¥è¡—é“': 'æ²£ä¸œæ–°åŸ', 'ç‹å¯ºè¡—é“': 'æ²£ä¸œæ–°åŸ', 'æ–—é—¨è¡—é“': 'æ²£ä¸œæ–°åŸ', 'é«˜æ¡¥è¡—é“': 'æ²£ä¸œæ–°åŸ',
        'å»ºç« è·¯è¡—é“': 'æ²£ä¸œæ–°åŸ', 'ä¸Šæ—è¡—é“': 'æ²£ä¸œæ–°åŸ', 'æ²£ä¸œè¡—é“': 'æ²£ä¸œæ–°åŸ',
        // æ²£è¥¿æ–°åŸ
        'é’“å°è¡—é“': 'æ²£è¥¿æ–°åŸ', 'é©¬ç‹è¡—é“': 'æ²£è¥¿æ–°åŸ', 'å¤§ç‹è¡—é“': 'æ²£è¥¿æ–°åŸ', 
        'é«˜æ¡¥è¡—é“(éƒ¨åˆ†)': 'æ²£è¥¿æ–°åŸ', 'é™ˆæ¨å¯¨è¡—é“(éƒ¨åˆ†)': 'æ²£è¥¿æ–°åŸ'
    };
    return areaMapping[street] || null;
}

// åˆå§‹åŒ–è¡—é“é€‰æ‹©
function initStreetSelects() {
    const districts = ['householdDistrict', 'residenceDistrict'];
    districts.forEach(districtId => {
        const select = document.getElementById(districtId);
        select.addEventListener('change', function() {
            const streetSelect = document.getElementById(districtId.replace('District', 'Street'));
            const district = this.value;
            
            streetSelect.innerHTML = '<option value="">è¯·é€‰æ‹©è¡—é“</option>';
            if (district && DISTRICT_STREETS[district]) {
                DISTRICT_STREETS[district].forEach(street => {
                    const option = document.createElement('option');
                    option.value = street;
                    option.textContent = street;
                    streetSelect.appendChild(option);
                });
            }
        });
    });
}

// ç›‘å¬å±…ä½ä¿¡æ¯å˜åŒ–ï¼Œè‡ªåŠ¨æ›´æ–°åŒ¹é…æƒ…å†µ
function initResidenceListeners() {
    const householdDistrict = document.getElementById('householdDistrict');
    const residenceDistrict = document.getElementById('residenceDistrict');
    const sameDistrictCheck = document.getElementById('sameDistrict');
    
    [householdDistrict, residenceDistrict].forEach(select => {
        select.addEventListener('change', function() {
            if (householdDistrict.value && residenceDistrict.value) {
                sameDistrictCheck.checked = householdDistrict.value === residenceDistrict.value;
                updateAdmissionPriority();
            }
        });
    });
}

// æ›´æ–°å…¥å­¦é¡ºä½è¯„ä¼°
function updateAdmissionPriority() {
    const hasHouse = document.getElementById('hasHouse').value;
    const residenceType = document.getElementById('residenceType').value;
    const sameDistrict = document.getElementById('sameDistrict').checked;
    
    let priority = 'å¾…è¯„ä¼°';
    let reason = 'è¯·å®Œå–„ä¿¡æ¯';
    
    if (hasHouse === 'yes-good' && sameDistrict) {
        priority = 'ç¬¬ä¸€é¡ºä½';
        reason = 'æˆ¿æˆ·ä¸€è‡´ä¸”åœ¨å­¦åŒºå†…';
    } else if (hasHouse === 'yes-good' && !sameDistrict) {
        priority = 'ç¬¬äºŒé¡ºä½';
        reason = 'æˆ¿æˆ·ä¸€è‡´ä½†è·¨å­¦åŒº';
    } else if (hasHouse === 'no') {
        priority = 'ç¬¬ä¸‰é¡ºä½';
        reason = 'é›†ä½“æˆ·/æŒ‚é æˆ·';
    } else if (residenceType === 'rent') {
        priority = 'ç¬¬å››é¡ºä½';
        reason = 'ç§Ÿæˆ¿å±…ä½ï¼Œç»Ÿç­¹å®‰æ’';
    }
    
    document.getElementById('admissionPriority').textContent = priority;
    document.getElementById('priorityReason').textContent = reason;
}

// ========== APIé…ç½®åŠŸèƒ½ ==========
function toggleConfigPanel() { 
    const panel = document.getElementById('configPanel');
    panel.classList.toggle('show');
}

async function saveAndTestConfig() {
    const apiKey = document.getElementById('apiKeyInput').value.trim();
    const appId = document.getElementById('appIdInput').value.trim();
    const statusEl = document.getElementById('configStatus');
    
    if (!apiKey || !appId) { 
        statusEl.className = 'config-status error'; 
        statusEl.textContent = 'è¯·å¡«å†™å®Œæ•´'; 
        return; 
    }
    if (!apiKey.startsWith('sk-')) { 
        statusEl.className = 'config-status error'; 
        statusEl.textContent = 'API Keyåº”ä»¥sk-å¼€å¤´'; 
        return; 
    }
    
    statusEl.className = 'config-status info'; 
    statusEl.textContent = 'æµ‹è¯•è¿æ¥ä¸­...';
    CONFIG.apiKey = apiKey; 
    CONFIG.appId = appId;
    
    try {
        // çœŸå®APIæµ‹è¯•
        const response = await callBailianAPI("æµ‹è¯•è¿æ¥", CONFIG.appId, CONFIG.apiKey);
        if (response && response.output && response.output.text) {
            CONFIG.isConnected = true;
            statusEl.className = 'config-status success'; 
            statusEl.textContent = 'âœ… è¿æ¥æˆåŠŸ';
            updateApiStatusUI(true);
            setTimeout(() => toggleConfigPanel(), 1000);
        } else {
            throw new Error('APIè¿”å›æ ¼å¼å¼‚å¸¸');
        }
    } catch (e) {
        statusEl.className = 'config-status error'; 
        statusEl.textContent = 'è¿æ¥å¤±è´¥: ' + e.message;
    }
}

function useLocalMode() {
    CONFIG.isConnected = false;
    updateApiStatusUI(false);
    toggleConfigPanel();
}

function updateApiStatusUI(connected) {
    const el = document.getElementById('apiStatus');
    const txt = document.getElementById('statusText');
    const chat = document.getElementById('chatApiStatus');
    if (connected) { 
        el.className = 'api-status connected'; 
        txt.textContent = 'AIå·²è¿æ¥'; 
        chat.textContent = 'ç™¾ç‚¼AI'; 
    } else { 
        el.className = 'api-status local'; 
        txt.textContent = 'æœ¬åœ°æ¨¡å¼'; 
        chat.textContent = 'æœ¬åœ°æ¨¡å¼'; 
    }
}

// ========== é˜¿é‡Œäº‘ç™¾ç‚¼APIè°ƒç”¨ ==========
async function callBailianAPI(prompt, appId, apiKey) {
    if (!CONFIG.isConnected) {
        return { output: { text: getLocalResponse(prompt) } };
    }
    
    try {
        const response = await fetch('https://dashscope.aliyuncs.com/api/v1/apps/' + appId + '/completion', {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer ' + apiKey,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                input: {
                    prompt: prompt
                },
                parameters: {}
            })
        });
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('APIè°ƒç”¨å¤±è´¥:', error);
        // å¤±è´¥æ—¶å›é€€åˆ°æœ¬åœ°å“åº”
        return { output: { text: getLocalResponse(prompt) } };
    }
}

// ========== AIèŠå¤©åŠŸèƒ½ ==========
function toggleChat() { 
    const chatWindow = document.getElementById('chatWindow');
    chatWindow.classList.toggle('active');
    
    if (chatWindow.classList.contains('active')) {
        initChatDrag();
    }
}

function initChatDrag() {
    const chatHeader = document.getElementById('chatHeader');
    const chatWindow = document.getElementById('chatWindow');
    
    chatHeader.addEventListener('mousedown', startDrag);
    document.addEventListener('mousemove', drag);
    document.addEventListener('mouseup', stopDrag);
    
    function startDrag(e) {
        isDragging = true;
        const rect = chatWindow.getBoundingClientRect();
        dragOffsetX = e.clientX - rect.left;
        dragOffsetY = e.clientY - rect.top;
        chatWindow.style.cursor = 'grabbing';
        e.preventDefault();
    }
    
    function drag(e) {
        if (!isDragging) return;
        
        const x = e.clientX - dragOffsetX;
        const y = e.clientY - dragOffsetY;
        
        // é™åˆ¶åœ¨è§†å£å†…
        const maxX = window.innerWidth - chatWindow.offsetWidth;
        const maxY = window.innerHeight - chatWindow.offsetHeight;
        
        chatWindow.style.left = Math.max(0, Math.min(x, maxX)) + 'px';
        chatWindow.style.top = Math.max(0, Math.min(y, maxY)) + 'px';
        chatWindow.style.right = 'auto';
        chatWindow.style.bottom = 'auto';
    }
    
    function stopDrag() {
        isDragging = false;
        chatWindow.style.cursor = 'default';
    }
}

function handleKeyPress(e) { 
    if (e.key === 'Enter') sendMessage(); 
}

async function sendMessage() {
    const input = document.getElementById('chatInput');
    const msg = input.value.trim();
    if (!msg) return;
    addMessage(msg, 'user'); 
    input.value = '';
    document.getElementById('sendBtn').disabled = true;
    showTyping();
    
    try {
        let resp;
        if (CONFIG.isConnected) {
            const response = await callBailianAPI(msg, CONFIG.appId, CONFIG.apiKey);
            resp = response.output.text;
        } else {
            resp = getLocalResponse(msg);
        }
        removeTyping(); 
        addMessage(resp, 'assistant');
    } catch (e) { 
        removeTyping(); 
        addMessage('å–µ~æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•', 'assistant'); 
    }
    document.getElementById('sendBtn').disabled = false;
}

function quickAction(q) { 
    document.getElementById('chatInput').value = q; 
    sendMessage(); 
}

function addMessage(content, role) {
    const body = document.getElementById('chatBody');
    const div = document.createElement('div');
    div.className = `ai-message ${role}`;
    div.innerHTML = `<div class="message-avatar">${role === 'assistant' ? 'ğŸ±' : 'ğŸ‘¤'}</div><div class="message-content">${content.replace(/\n/g, '<br>')}</div>`;
    body.appendChild(div); 
    body.scrollTop = body.scrollHeight;
}

function showTyping() {
    const body = document.getElementById('chatBody');
    const div = document.createElement('div');
    div.className = 'ai-message assistant';
    div.id = 'typingIndicator';
    div.innerHTML = `
        <div class="message-avatar">ğŸ±</div>
        <div class="message-content">
            <div class="typing-indicator">
                <span></span><span></span><span></span>
            </div>
        </div>
    `;
    body.appendChild(div);
    body.scrollTop = body.scrollHeight;
}

function removeTyping() {
    const indicator = document.getElementById('typingIndicator');
    if (indicator) indicator.remove();
}

function getLocalResponse(msg) {
    const lowerMsg = msg.toLowerCase();
    
    if (lowerMsg.includes('æ—¶é—´') || lowerMsg.includes('å®‰æ’')) {
        return `ğŸ“… 2026å¹´è¥¿å®‰å°å‡åˆæ—¶é—´å®‰æ’ï¼ˆé¢„è®¡ï¼‰ï¼š
        
1ï¸âƒ£ æ”¿ç­–å‘å¸ƒï¼š2026å¹´3æœˆ
2ï¸âƒ£ å­¦åŒºåˆ’åˆ†ï¼š2026å¹´4æœˆ
3ï¸âƒ£ ä¿¡æ¯å®¡æ ¸ï¼š2026å¹´5æœˆ
4ï¸âƒ£ æ°‘åŠæŠ¥åï¼š2026å¹´7æœˆ11-24æ—¥
5ï¸âƒ£ æ°‘åŠæ‘‡å·ï¼š2026å¹´7æœˆ30æ—¥
6ï¸âƒ£ å½•å–é€šçŸ¥ï¼š2026å¹´8æœˆ

å…·ä½“æ—¶é—´ä»¥æ•™è‚²å±€å®˜æ–¹é€šçŸ¥ä¸ºå‡†å“¦~`;
    } else if (lowerMsg.includes('æ°‘åŠ') || lowerMsg.includes('å­¦æ ¡')) {
        return `ğŸ« è¥¿å®‰æ°‘åŠåˆä¸­ï¼ˆ2025å¹´æ•°æ®ï¼‰ï¼š
        
â€¢ å…¨å¸‚28æ‰€æ°‘åŠåˆä¸­
â€¢ è®¡åˆ’æ‹›ç”Ÿ12361äºº
â€¢ çƒ­é—¨å­¦æ ¡ï¼šé“ä¸€ä¸­åˆ†æ ¡ã€è¥¿å·¥å¤§é™„ä¸­åˆ†æ ¡ã€é«˜æ–°ä¸€ä¸­åˆä¸­æ ¡åŒºç­‰
â€¢ æ‘‡å·å½•å–ï¼Œä¸­ç­¾ç‡å› å­¦æ ¡è€Œå¼‚

éœ€è¦äº†è§£å…·ä½“å­¦æ ¡çš„æ‹›ç”Ÿè®¡åˆ’å—ï¼Ÿ`;
    } else if (lowerMsg.includes('æ‘‡å·') || lowerMsg.includes('å½•å–')) {
        return `ğŸ² æ°‘åŠå­¦æ ¡æ‘‡å·æ”¿ç­–ï¼š
        
â€¢ æŠ¥åäººæ•° â‰¤ æ‹›ç”Ÿè®¡åˆ’ï¼šç›´æ¥å½•å–
â€¢ æŠ¥åäººæ•° > æ‹›ç”Ÿè®¡åˆ’ï¼šç”µè„‘éšæœºå½•å–ï¼ˆæ‘‡å·ï¼‰
â€¢ ç»Ÿä¸€åœ¨7æœˆ30æ—¥è¿›è¡Œ
â€¢ ç»“æœå½“å¤©å…¬å¸ƒ
â€¢ æ¯äººå¯å¡«æŠ¥1-2æ‰€æ°‘åŠå­¦æ ¡

æ‘‡å·å®Œå…¨éšæœºï¼Œç¡®ä¿å…¬å¹³å…¬æ­£ï¼`;
    } else if (lowerMsg.includes('è¥¿å’¸') || lowerMsg.includes('ç§¦æ±‰') || lowerMsg.includes('ç©ºæ¸¯') || 
               lowerMsg.includes('æ³¾æ²³') || lowerMsg.includes('æ²£ä¸œ') || lowerMsg.includes('æ²£è¥¿')) {
        return `ğŸ›ï¸ è¥¿å’¸æ–°åŒºå‡å­¦æ”¿ç­–ä¿¡æ¯ï¼š

â€¢ è¥¿å’¸æ–°åŒºå·²çº³å…¥è¥¿å®‰åŸå…­åŒºæ‹›ç”ŸèŒƒå›´
â€¢ ä¸è¥¿å®‰ä¸»åŸåŒºå®è¡Œç»Ÿä¸€çš„æ‹›ç”Ÿæ”¿ç­–
â€¢ å…¬æ°‘åŒæ‹›ï¼Œæ°‘åŠå­¦æ ¡æ‘‡å·å½•å–
â€¢ å…¬åŠå­¦æ ¡æŒ‰å­¦åŒºåˆ’ç‰‡å…¥å­¦

å„æ–°åŸç‰¹è‰²ï¼š
â€¢ ç§¦æ±‰æ–°åŸï¼šæ–‡åŒ–æ—…æ¸¸ã€å¤§å¥åº·äº§ä¸š
â€¢ ç©ºæ¸¯æ–°åŸï¼šä¸´ç©ºç»æµã€å›½é™…ç‰©æµ  
â€¢ æ³¾æ²³æ–°åŸï¼šç§‘æŠ€åˆ›æ–°ã€å…ˆè¿›åˆ¶é€ 
â€¢ æ²£ä¸œæ–°åŸï¼šå¤§è¥¿å®‰æ–°ä¸­å¿ƒæ ¸å¿ƒåŒº
â€¢ æ²£è¥¿æ–°åŸï¼šä¿¡æ¯æŠ€æœ¯ã€äººå·¥æ™ºèƒ½

éœ€è¦äº†è§£å…·ä½“æ–°åŸçš„å­¦æ ¡ä¿¡æ¯å—ï¼Ÿ`;
    } else {
        return `ğŸ± å…³äº"${msg}"ï¼Œæˆ‘ç†è§£æ‚¨çš„é—®é¢˜äº†ï¼åŸºäº2025å¹´è¥¿å®‰å°å‡åˆæ”¿ç­–ï¼š

â€¢ å…¬æ°‘åŒæ‹›ï¼Œå…è¯•å…¥å­¦
â€¢ å…¬åŠæŒ‰å­¦åŒºï¼Œæ°‘åŠæ‘‡å·
â€¢ è¥¿å’¸æ–°åŒºçº³å…¥åŸå…­åŒºæ‹›ç”Ÿ

æ‚¨å¯ä»¥ç»§ç»­æé—®å…³äºæ—¶é—´å®‰æ’ã€æ°‘åŠå­¦æ ¡ã€æ‘‡å·æ”¿ç­–ç­‰é—®é¢˜å“¦~`;
    }
}

// ========== æ­¥éª¤å¯¼èˆªåŠŸèƒ½ ==========
function showStep(n) {
    document.getElementById('progressBar').style.width = `${(n/6)*100}%`;
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    for (let i = 1; i <= 6; i++) {
        const ind = document.getElementById(`step${i}-indicator`);
        ind.classList.remove('active', 'completed');
        if (i < n) ind.classList.add('completed');
        else if (i === n) ind.classList.add('active');
    }
    document.getElementById(`step${n}`).classList.add('active');
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function goToStep1() { showStep(1); }
function goToStep2() { 
    for (let i = 1; i <= 6; i++) {
        if (!document.querySelector(`input[name="score${i}"]:checked`)) { 
            alert('è¯·å®Œæˆæ‰€æœ‰è¯„åˆ†'); return; 
        }
    }
    for (let i = 1; i <= 6; i++) {
        assessmentData.scores[`score${i}`] = parseInt(document.querySelector(`input[name="score${i}"]:checked`).value);
    }
    showStep(2); 
}
function goToStep3() { 
    const fields = ['householdDistrict', 'residenceDistrict', 'residenceType'];
    for (const f of fields) { 
        if (!document.getElementById(f).value) { alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯'); return; } 
    }
    showStep(3); 
}
function goToStep4() { 
    const fields = ['hasHouse', 'propertyType', 'propertyYears'];
    for (const f of fields) { 
        if (!document.getElementById(f).value) { alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯'); return; } 
    }
    showStep(4); 
}
function goToStep5() { 
    const fields = ['considerPrivate', 'crossDistrictPreference', 'budget', 'acceptLottery'];
    for (const f of fields) { 
        if (!document.getElementById(f).value) { alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯'); return; } 
    }
    showStep(5); 
}

// ========== ç”ŸæˆæŠ¥å‘ŠåŠŸèƒ½ ==========
function generateReport() {
    const fields = ['academicGoals', 'specificNeeds', 'riskTolerance', 'timeCommitment'];
    for (const f of fields) { 
        if (!document.getElementById(f).value) { alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯'); return; } 
    }
    
    // æ”¶é›†æ‰€æœ‰ä¿¡æ¯
    assessmentData.familyInfo = {
        // æˆ·ç±ä¿¡æ¯
        householdDistrict: document.getElementById('householdDistrict').value,
        householdStreet: document.getElementById('householdStreet').value,
        householdAddress: document.getElementById('householdAddress').value,
        
        // å±…ä½ä¿¡æ¯
        residenceDistrict: document.getElementById('residenceDistrict').value,
        residenceStreet: document.getElementById('residenceStreet').value,
        residenceAddress: document.getElementById('residenceAddress').value,
        residenceType: document.getElementById('residenceType').value,
        
        // åŒ¹é…æƒ…å†µ
        sameDistrict: document.getElementById('sameDistrict').checked,
        sameStreet: document.getElementById('sameStreet').checked,
        inSchoolDistrict: document.getElementById('inSchoolDistrict').checked,
        
        // æˆ¿äº§ä¿¡æ¯
        hasHouse: document.getElementById('hasHouse').value,
        propertyType: document.getElementById('propertyType').value,
        propertyYears: document.getElementById('propertyYears').value,
        
        // æ°‘åŠæ„å‘
        considerPrivate: document.getElementById('considerPrivate').value,
        crossDistrictPreference: document.getElementById('crossDistrictPreference').value,
        budget: document.getElementById('budget').value,
        acceptLottery: document.getElementById('acceptLottery').value,
        strengths: Array.from(document.querySelectorAll('.strength-check:checked')).map(c => c.value),
        
        // æ·±åº¦éœ€æ±‚
        academicGoals: document.getElementById('academicGoals').value,
        specificNeeds: document.getElementById('specificNeeds').value,
        riskTolerance: document.getElementById('riskTolerance').value,
        timeCommitment: document.getElementById('timeCommitment').value,
        educationalPhilosophy: Array.from(document.querySelectorAll('.philosophy-check:checked')).map(c => c.value)
    };
    
    // è®¡ç®—æ€»åˆ†
    assessmentData.totalScore = calculateWeightedTotalScore(assessmentData.scores);
    
    displayResults();
    showStep(6);
}

function calculateWeightedTotalScore(scores) {
    let weightedTotal = 0;
    for (const [key, value] of Object.entries(scores)) {
        weightedTotal += value * (DIMENSION_WEIGHTS[key] || 0.10);
    }
    return Math.round(weightedTotal * 100) / 100;
}

function displayResults() {
    // ç”Ÿæˆå­¦æ ¡æ¨è
    generateSchoolRecommendation();
    
    // ç”Ÿæˆæ—¶é—´è§„åˆ’
    generateTimeline();
    
    // ç”Ÿæˆæ”¿ç­–å»ºè®®
    generatePolicyAdvice();
}

async function generateSchoolRecommendation() {
    const { scores, familyInfo, totalScore } = assessmentData;
    const recommendationEl = document.getElementById('schoolRecommendation');
    
    let html = `<div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">ç»¼åˆå¾—åˆ†</div>
            <div class="stat-value">${totalScore.toFixed(1)}/5.0</div>
            <div class="stat-trend">${getScoreLevel(totalScore)}</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">å…¥å­¦é¡ºä½</div>
            <div class="stat-value">${document.getElementById('admissionPriority').textContent}</div>
            <div class="stat-trend">åŸºäºæˆ·ç±å±…ä½åŒ¹é…</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">æ¨èç±»å‹</div>
            <div class="stat-value">${getSchoolType(totalScore, familyInfo)}</div>
            <div class="stat-trend">${familyInfo.considerPrivate === 'yes' ? 'å…¬åŠ+æ°‘åŠ' : 'å…¬åŠä¸ºä¸»'}</div>
        </div>
    </div>`;
    
    // æ£€æŸ¥æ˜¯å¦ä¸ºè¥¿å’¸æ–°åŒºå±…æ°‘ï¼Œç”Ÿæˆå¯¹åº”çš„å­¦æ ¡æ¨è
    const residenceDistrict = familyInfo.residenceDistrict;
    const residenceStreet = familyInfo.residenceStreet;
    
    if (residenceDistrict === 'è¥¿å’¸æ–°åŒº' && residenceStreet) {
        const areaName = getXianyangAreaByStreet(residenceStreet);
        if (areaName && XIANYANG_SCHOOLS[areaName]) {
            html += `<div class="public-match-card">
                <div class="public-match-header">
                    <div class="public-match-title">ğŸ›ï¸ ${areaName}æ¨èå­¦æ ¡</div>
                    <span class="match-indicator match-high">åŒºåŸŸåŒ¹é…</span>
                </div>`;
            
            XIANYANG_SCHOOLS[areaName].forEach(school => {
                html += `
                <div class="school-card tier-2">
                    <div class="school-name">${school.name} 
                        <span class="school-tag ${school.type === 'å…¬åŠ' ? 'tag-stable' : 'tag-hot'}">${school.type}</span>
                        <span class="match-indicator ${school.match === 'é«˜' ? 'match-high' : 'match-medium'}">åŒ¹é…åº¦${school.match}</span>
                    </div>
                    <div class="school-info">
                        ${school.feature}
                    </div>
                </div>`;
            });
            
            html += `</div>`;
        }
    }
    
    // ä½¿ç”¨AIç”Ÿæˆæ›´è¯¦ç»†çš„æ¨è
    if (CONFIG.isConnected) {
        try {
            const prompt = `åŸºäºä»¥ä¸‹å­¦ç”Ÿä¿¡æ¯ï¼Œè¯·æä¾›è¯¦ç»†çš„è¥¿å®‰å°å‡åˆå­¦æ ¡æ¨èï¼š
            
å­¦ç”Ÿç»¼åˆå¾—åˆ†ï¼š${totalScore}/5.0
æˆ·ç±åŒºåŸŸï¼š${familyInfo.householdDistrict}
å±…ä½åŒºåŸŸï¼š${familyInfo.residenceDistrict}
å…¥å­¦é¡ºä½ï¼š${document.getElementById('admissionPriority').textContent}
æ˜¯å¦è€ƒè™‘æ°‘åŠï¼š${familyInfo.considerPrivate}
å­¦ç”Ÿç‰¹é•¿ï¼š${familyInfo.strengths.join(', ')}
å­¦ä¸šè§„åˆ’ï¼š${familyInfo.academicGoals}
ç‰¹æ®Šéœ€æ±‚ï¼š${familyInfo.specificNeeds}

è¯·æä¾›å†²åˆºæ¨èã€åŒ¹é…æ¨èå’Œä¿åº•æ¨èä¸‰ä¸ªå±‚æ¬¡çš„å­¦æ ¡å»ºè®®ï¼Œæ¯å±‚æ¬¡2-3æ‰€å­¦æ ¡ï¼Œå¹¶è¯´æ˜æ¨èç†ç”±ã€‚`;

            const response = await callBailianAPI(prompt, CONFIG.appId, CONFIG.apiKey);
            const aiRecommendation = response.output.text;
            
            html += `<div class="public-match-card">
                <div class="public-match-header">
                    <div class="public-match-title">ğŸ¤– AIæ™ºèƒ½æ¨è</div>
                    <span class="match-indicator match-high">ç™¾ç‚¼AIåˆ†æ</span>
                </div>
                <div class="public-match-desc">
                    ${aiRecommendation.replace(/\n/g, '<br>')}
                </div>
            </div>`;
        } catch (error) {
            console.error('AIæ¨èå¤±è´¥:', error);
            // å¦‚æœAIæ¨èå¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ¨è
            html += getLocalSchoolRecommendation(familyInfo, totalScore);
        }
    } else {
        // æœ¬åœ°æ¨¡å¼ä¸‹çš„æ¨è
        html += getLocalSchoolRecommendation(familyInfo, totalScore);
    }
    
    recommendationEl.innerHTML = html;
}

function getLocalSchoolRecommendation(familyInfo, totalScore) {
    return `
    <div class="public-match-card">
        <div class="public-match-header">
            <div class="public-match-title">ğŸ† å†²åˆºæ¨è</div>
            <span class="match-indicator match-high">é«˜åŒ¹é…åº¦</span>
        </div>
        <div class="public-match-desc">
            <strong>è¥¿å®‰é“ä¸€ä¸­åˆ†æ ¡</strong> - æ°‘åŠï¼Œç†ç§‘å¼ºåŠ¿ï¼Œé€‚åˆå­¦ä¸šä¼˜ç§€å­¦ç”Ÿ<br>
            <strong>è¥¿å·¥å¤§é™„ä¸­åˆ†æ ¡</strong> - æ°‘åŠï¼Œç«èµ›ä¼˜åŠ¿ï¼Œé€‚åˆæœ‰ç‰¹é•¿çš„å­¦ç”Ÿ
        </div>
    </div>
    <div class="public-match-card">
        <div class="public-match-header">
            <div class="public-match-title">âœ… åŒ¹é…æ¨è</div>
            <span class="match-indicator match-medium">ä¸­åŒ¹é…åº¦</span>
        </div>
        <div class="public-match-desc">
            <strong>è¥¿å®‰ç›Šæ–°ä¸­å­¦</strong> - æ°‘åŠï¼Œç®¡ç†è§„èŒƒï¼Œé€‚åˆç¨³å®šå‘å±•å­¦ç”Ÿ<br>
            <strong>${familyInfo.residenceDistrict}ç¬¬ä¸€å­¦æ ¡</strong> - å…¬åŠï¼Œå°±è¿‘å…¥å­¦ï¼Œäº¤é€šä¾¿åˆ©
        </div>
    </div>
    <div class="public-match-card">
        <div class="public-match-header">
            <div class="public-match-title">ğŸ›¡ï¸ ä¿åº•æ¨è</div>
            <span class="match-indicator match-low">ç¨³å¦¥é€‰æ‹©</span>
        </div>
        <div class="public-match-desc">
            <strong>${familyInfo.residenceDistrict}å®éªŒä¸­å­¦</strong> - å…¬åŠï¼Œå­¦åŒºä¿éšœï¼Œå…¥å­¦ç¡®å®šæ€§å¼º<br>
            <strong>å‘¨è¾¹æ°‘åŠå­¦æ ¡</strong> - æ‘‡å·æ¦‚ç‡è¾ƒé«˜ï¼Œä½œä¸ºå¤‡é€‰æ–¹æ¡ˆ
        </div>
    </div>`;
}

function generateTimeline() {
    const currentYear = new Date().getFullYear();
    const timelineEl = document.getElementById('timeline');
    
    timelineEl.innerHTML = `
        <div class="timeline-item">
            <div class="timeline-date">${currentYear}å¹´11æœˆ-${currentYear+1}å¹´2æœˆ</div>
            <div class="timeline-content">å‡†å¤‡ææ–™ï¼šæˆ·å£æœ¬ã€æˆ¿äº§è¯ã€å­¦ç±ä¿¡æ¯ç­‰</div>
        </div>
        <div class="timeline-item">
            <div class="timeline-date">${currentYear+1}å¹´3æœˆ-4æœˆ</div>
            <div class="timeline-content">å…³æ³¨æ”¿ç­–å‘å¸ƒå’Œå­¦åŒºåˆ’åˆ†å…¬å‘Š</div>
        </div>
        <div class="timeline-item">
            <div class="timeline-date">${currentYear+1}å¹´5æœˆ</div>
            <div class="timeline-content">ä¿¡æ¯å®¡æ ¸å’Œèµ„æ ¼ç¡®è®¤</div>
        </div>
        <div class="timeline-item">
            <div class="timeline-date">${currentYear+1}å¹´7æœˆ11-24æ—¥</div>
            <div class="timeline-content">æ°‘åŠå­¦æ ¡ç½‘ä¸ŠæŠ¥å</div>
        </div>
        <div class="timeline-item">
            <div class="timeline-date">${currentYear+1}å¹´7æœˆ30æ—¥</div>
            <div class="timeline-content">æ°‘åŠå­¦æ ¡ç”µè„‘éšæœºå½•å–ï¼ˆæ‘‡å·ï¼‰</div>
        </div>
        <div class="timeline-item">
            <div class="timeline-date">${currentYear+1}å¹´8æœˆ</div>
            <div class="timeline-content">å½•å–é€šçŸ¥å’Œå…¥å­¦å‡†å¤‡</div>
        </div>
    `;
}

function generatePolicyAdvice() {
    const { familyInfo } = assessmentData;
    const adviceEl = document.getElementById('policyAdvice');
    
    let advice = '';
    
    if (familyInfo.sameDistrict) {
        advice += `<div class="policy-box">
            <h4>âœ… æˆ·ç±å±…ä½ä¸€è‡´ä¼˜åŠ¿</h4>
            <p>æ‚¨çš„æˆ·ç±å’Œå±…ä½åœ°åœ¨åŒä¸€è¡Œæ”¿åŒºï¼Œç¬¦åˆ"æˆ¿æˆ·ä¸€è‡´"è¦æ±‚ï¼Œåœ¨å…¬åŠå­¦æ ¡å…¥å­¦ä¸­å…·æœ‰ä¼˜å…ˆæƒã€‚</p>
        </div>`;
    } else {
        advice += `<div class="policy-box">
            <h4>âš ï¸ æˆ·ç±å±…ä½åˆ†ç¦»æé†’</h4>
            <p>æ‚¨çš„æˆ·ç±å’Œå±…ä½åœ°ä¸åœ¨åŒä¸€åŒºï¼Œå»ºè®®ä»¥å®é™…å±…ä½åœ°ä¸ºä¸»ç”³è¯·å…¥å­¦ï¼Œå¯èƒ½éœ€è¦æä¾›ç§Ÿæˆ¿è¯æ˜ç­‰ææ–™ã€‚</p>
        </div>`;
    }
    
    if (familyInfo.considerPrivate === 'yes') {
        advice += `<div class="policy-box">
            <h4>ğŸ² æ°‘åŠæ‘‡å·ç­–ç•¥</h4>
            <p>å»ºè®®å¡«æŠ¥1æ‰€çƒ­é—¨å­¦æ ¡å’Œ1æ‰€ä¸­ç­¾ç‡è¾ƒé«˜çš„å­¦æ ¡ï¼Œå¹³è¡¡å†²åˆºå’Œä¿åº•éœ€æ±‚ã€‚</p>
        </div>`;
    }
    
    advice += `<div class="policy-box">
        <h4>ğŸ“‹ ææ–™å‡†å¤‡æé†’</h4>
        <p>è¯·æå‰å‡†å¤‡ï¼šæˆ·å£æœ¬ã€æˆ¿äº§è¯ï¼ˆæˆ–ç§Ÿæˆ¿åˆåŒï¼‰ã€å„¿ç«¥é¢„é˜²æ¥ç§è¯ã€å­¦ç±ä¿¡æ¯è¡¨ç­‰ææ–™ã€‚</p>
    </div>`;
    
    adviceEl.innerHTML = advice;
}

function getScoreLevel(score) {
    if (score >= 4.0) return 'ä¼˜ç§€';
    if (score >= 3.5) return 'è‰¯å¥½';
    if (score >= 3.0) return 'ä¸­ç­‰';
    return 'å¾…æå‡';
}

function getSchoolType(score, familyInfo) {
    if (score >= 4.0 && familyInfo.considerPrivate === 'yes') return 'ä¼˜è´¨æ°‘åŠ';
    if (score >= 3.5) return 'å…¬åŠ+æ°‘åŠ';
    return 'å…¬åŠä¸ºä¸»';
}

function resetAll() {
    if (!confirm('ç¡®å®šé‡æ–°è¯„ä¼°å—ï¼Ÿæ‰€æœ‰æ•°æ®å°†è¢«æ¸…ç©ºã€‚')) return;
    document.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
    document.querySelectorAll('input[type="checkbox"]').forEach(c => c.checked = false);
    document.querySelectorAll('select').forEach(s => s.value = '');
    document.querySelectorAll('input[type="text"]').forEach(i => i.value = '');
    if (radarChart) radarChart.destroy();
    assessmentData = { scores: {}, familyInfo: {}, totalScore: 0 };
    showStep(1);
}

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    showStep(1);
    initStreetSelects();
    initResidenceListeners();
    
    // è®¾ç½®é»˜è®¤å€¼
    document.getElementById('academicGoals').value = 'ç¨³å®šå‡å…¥æ™®é€šé«˜ä¸­';
    document.getElementById('specificNeeds').value = 'éœ€è¦ä½æ ¡æˆ–æ™šæ‰˜æœåŠ¡';
    document.getElementById('riskTolerance').value = 'åå¥½ç¨³å¦¥å¯é çš„é€‰æ‹©';
    document.getElementById('timeCommitment').value = 'å‘¨æœ«å¯é›†ä¸­é™ªä¼´';
    
    // è®¾ç½®é»˜è®¤å‹¾é€‰
    document.querySelectorAll('.philosophy-check').forEach(check => check.checked = true);
    
    // ç›‘å¬æˆ¿äº§ä¿¡æ¯å˜åŒ–
    document.getElementById('hasHouse').addEventListener('change', updateAdmissionPriority);
    document.getElementById('residenceType').addEventListener('change', updateAdmissionPriority);
});
</script>
</body>
</html>
