<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>è¥¿å®‰å°å‡åˆæ™ºèƒ½è¯„ä¼°ç³»ç»Ÿ 2025å¢å¼ºç‰ˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft YaHei", sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; font-size: 15px; line-height: 1.6; touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 24px; padding: 40px; box-shadow: 0 20px 80px rgba(0,0,0,0.3); position: relative; }
        
        /* APIé…ç½®æ ·å¼ */
        .api-status { position: fixed; top: 20px; right: 20px; padding: 10px 15px; border-radius: 8px; font-size: 14px; font-weight: 600; z-index: 1001; box-shadow: 0 4px 12px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.3s ease; }
        .api-status.local { background: #ed8936; color: white; }
        .api-status.connected { background: #48bb78; color: white; }
        .config-panel { position: fixed; top: 80px; right: 20px; background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); z-index: 1000; max-width: 400px; border: 2px solid #667eea; display: none; }
        .config-panel.show { display: block; }
        .config-title { font-size: 16px; font-weight: 600; color: #2d3748; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
        .config-input { width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; margin-bottom: 10px; font-size: 14px; }
        .config-input:focus { border-color: #667eea; outline: none; }
        .config-btn { width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; margin-bottom: 10px; transition: all 0.3s; }
        .config-btn:hover { transform: translateY(-2px); }
        .config-btn.secondary { background: #6c757d; }
        .config-help { font-size: 12px; color: #718096; margin-top: 10px; line-height: 1.5; }
        .config-status { padding: 10px; border-radius: 8px; margin-bottom: 10px; font-size: 13px; }
        .config-status.success { background: #c6f6d5; color: #276749; }
        .config-status.error { background: #fed7d7; color: #c53030; }
        .config-status.info { background: #bee3f8; color: #2b6cb0; }
        
        /* è¿›åº¦æ¡ */
        .progress-bar { position: absolute; top: 0; left: 0; height: 6px; background: linear-gradient(90deg, #667eea, #764ba2); border-radius: 24px 24px 0 0; transition: width 0.5s ease; width: 16.6%; }
        
        /* AIåŠ©æ‰‹æ ·å¼ */
        .ai-assistant { position: fixed; bottom: 30px; right: 30px; z-index: 1000; }
        .ai-assistant-btn { width: 60px; height: 60px; background: linear-gradient(135deg, #ff6a00, #ff3d00); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; cursor: pointer; box-shadow: 0 8px 25px rgba(255, 106, 0, 0.4); transition: all 0.3s ease; border: none; }
        .ai-assistant-btn:hover { transform: scale(1.1); }
        .ai-chat-window { 
            position: fixed; 
            bottom: 100px;
            right: 30px;
            width: 380px; 
            height: 520px; 
            background: white; 
            border-radius: 20px; 
            box-shadow: 0 15px 50px rgba(0,0,0,0.2); 
            display: none; 
            flex-direction: column; 
            overflow: hidden; 
            border: 2px solid #e2e8f0; 
            z-index: 1002;
            touch-action: none;
        }
        .ai-chat-window.active { display: flex !important; }
        .ai-chat-header { background: linear-gradient(135deg, #ff6a00 0%, #ff3d00 100%); color: white; padding: 20px; display: flex; align-items: center; gap: 12px; cursor: move; user-select: none; }
        .ai-chat-body { flex: 1; padding: 20px; overflow-y: auto; background: #fff9f5; }
        .ai-message { margin-bottom: 15px; display: flex; gap: 10px; }
        .ai-message.assistant { flex-direction: row; }
        .ai-message.user { flex-direction: row-reverse; }
        .message-avatar { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0; }
        .ai-message.assistant .message-avatar { background: linear-gradient(135deg, #ff6a00, #ff3d00); color: white; }
        .ai-message.user .message-avatar { background: #e2e8f0; color: #4a5568; }
        .message-content { max-width: 70%; padding: 12px 16px; border-radius: 18px; font-size: 14px; line-height: 1.5; }
        .ai-message.assistant .message-content { background: white; border: 1px solid #e2e8f0; border-bottom-left-radius: 4px; }
        .ai-message.user .message-content { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-bottom-right-radius: 4px; }
        .ai-chat-input { padding: 15px; border-top: 1px solid #e2e8f0; background: white; }
        .chat-input-group { display: flex; gap: 10px; }
        .chat-input { flex: 1; padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 25px; outline: none; font-size: 16px; }
        .chat-input:focus { border-color: #667eea; }
        .send-btn { width: 40px; height: 40px; border: none; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .send-btn:disabled { background: #ccc; }
        .quick-actions { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .quick-action-btn { padding: 6px 12px; background: #f7fafc; border: 1px solid #e2e8f0; border-radius: 15px; font-size: 12px; cursor: pointer; transition: all 0.2s; }
        .quick-action-btn:hover { background: #667eea; color: white; border-color: #667eea; }
        .typing-indicator { display: flex; gap: 4px; padding: 8px 0; }
        .typing-indicator span { width: 8px; height: 8px; background: #667eea; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out; }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        
        /* ä¸»å†…å®¹æ ·å¼ */
        h1 { text-align: center; font-size: 32px; margin-bottom: 12px; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 700; }
        .subtitle { text-align: center; color: #718096; margin-bottom: 40px; font-size: 16px; }
        .ai-badge { display: inline-block; background: linear-gradient(135deg, #ff6a00, #ff3d00); color: white; padding: 6px 16px; border-radius: 20px; font-size: 14px; font-weight: 600; margin-left: 10px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        
        .important-notice { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 25px; border-radius: 15px; margin-bottom: 30px; }
        .important-notice h3 { color: white; margin-bottom: 15px; font-size: 18px; }
        .important-notice ul { list-style: none; padding-left: 0; line-height: 1.8; font-size: 14px; }
        .important-notice li { margin-bottom: 8px; padding-left: 24px; position: relative; }
        .important-notice li::before { content: "âœ“"; position: absolute; left: 0; color: #48bb78; }
        
        .step-indicator { display: flex; justify-content: space-between; margin-bottom: 40px; position: relative; max-width: 900px; margin-left: auto; margin-right: auto; }
        .step-indicator::before { content: ''; position: absolute; top: 25px; left: 50px; right: 50px; height: 4px; background: #e2e8f0; z-index: 0; }
        .step { display: flex; flex-direction: column; align-items: center; position: relative; z-index: 1; flex: 1; cursor: pointer; }
        .step-number { width: 50px; height: 50px; border-radius: 50%; background: #e2e8f0; color: #a0aec0; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 20px; margin-bottom: 12px; transition: all 0.3s; }
        .step.active .step-number { background: linear-gradient(135deg, #667eea, #764ba2); color: white; transform: scale(1.15); }
        .step.completed .step-number { background: #48bb78; color: white; }
        .step-label { font-size: 12px; color: #718096; text-align: center; line-height: 1.3; }
        .step.active .step-label { color: #667eea; font-weight: 600; }
        
        .section { display: none; animation: fadeInUp 0.6s ease; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .section.active { display: block; }
        
        .dimension-card { background: #f7fafc; border-radius: 16px; padding: 25px; margin-bottom: 20px; border: 2px solid #e2e8f0; transition: all 0.3s; }
        .dimension-card:hover { border-color: #667eea; }
        .dimension-title { font-size: 20px; color: #2d3748; margin-bottom: 12px; font-weight: 600; }
        .dimension-desc { color: #718096; margin-bottom: 20px; font-size: 14px; }
        .score-options { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        .score-option input[type="radio"] { display: none; }
        .score-label { display: flex; flex-direction: column; justify-content: center; padding: 15px 10px; text-align: center; border: 2px solid #e2e8f0; border-radius: 12px; cursor: pointer; transition: all 0.3s; background: white; min-height: 100px; }
        .score-label:hover { border-color: #667eea; transform: translateY(-2px); }
        .score-option input[type="radio"]:checked + .score-label { border-color: #667eea; background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .score-number { font-size: 28px; font-weight: 700; display: block; margin-bottom: 6px; }
        .score-desc { font-size: 12px; display: block; line-height: 1.4; }
        
        .info-section { background: #f7fafc; border-radius: 16px; padding: 25px; margin-bottom: 20px; border: 2px solid #e2e8f0; }
        .info-section h3 { font-size: 20px; font-weight: 600; margin-bottom: 20px; color: #2d3748; }
        .info-group { margin-bottom: 18px; }
        .info-label { display: block; font-weight: 600; color: #2d3748; margin-bottom: 8px; font-size: 14px; }
        .info-select, .info-input { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 14px; background: white; }
        .info-select:focus, .info-input:focus { outline: none; border-color: #667eea; }
        
        .checkbox-group { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; }
        .checkbox-label { display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 10px; border-radius: 8px; font-size: 14px; }
        .checkbox-label:hover { background: #edf2f7; }
        .checkbox-label input[type="checkbox"] { width: 18px; height: 18px; }
        
        .button-group { display: flex; gap: 16px; justify-content: center; margin-top: 30px; }
        .btn { padding: 14px 36px; border: none; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 8px; }
        .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4); }
        .btn-secondary { background: #e2e8f0; color: #4a5568; }
        .btn-secondary:hover { background: #cbd5e0; }
        
        .result-card { background: white; border-radius: 16px; padding: 25px; margin-bottom: 20px; border: 2px solid #e2e8f0; }
        .result-title { font-size: 20px; color: #2d3748; margin-bottom: 20px; padding-left: 15px; border-left: 4px solid #667eea; font-weight: 600; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .stat-card { background: linear-gradient(135deg, #f7fafc, #edf2f7); padding: 20px; border-radius: 12px; border-left: 4px solid #667eea; }
        .stat-label { font-size: 13px; color: #718096; margin-bottom: 8px; }
        .stat-value { font-size: 28px; font-weight: 700; color: #667eea; margin-bottom: 5px; }
        .stat-trend { font-size: 12px; color: #48bb78; }
        
        .ai-loading { text-align: center; padding: 30px; background: #f7fafc; border-radius: 12px; margin: 15px 0; border: 2px dashed #667eea; }
        .ai-loading-spinner { display: inline-block; width: 40px; height: 40px; border: 3px solid #f3f3f3; border-top: 3px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .public-match-card { background: #f0fff4; border: 2px solid #48bb78; border-radius: 12px; padding: 20px; margin-bottom: 15px; }
        .public-match-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .public-match-title { font-size: 18px; font-weight: 600; color: #2d3748; }
        .public-match-desc { color: #718096; font-size: 14px; line-height: 1.6; }
        
        .policy-box { background: #fffaf0; border: 1px solid #ed8936; border-radius: 12px; padding: 15px; margin: 15px 0; }
        .policy-box h4 { color: #c05621; margin-bottom: 10px; font-size: 15px; }
        .policy-box p { color: #744210; font-size: 13px; line-height: 1.6; }
        
        .match-indicator { display: inline-block; padding: 3px 8px; border-radius: 8px; font-size: 11px; margin-left: 8px; }
        .match-high { background: #c6f6d5; color: #276749; }
        .match-medium { background: #fefcbf; color: #744210; }
        .match-low { background: #fed7d7; color: #c53030; }
        
        .timeline-item { position: relative; padding-left: 30px; padding-bottom: 20px; border-left: 2px solid #667eea; }
        .timeline-item:last-child { border-left: 2px solid transparent; }
        .timeline-item::before { content: ''; position: absolute; left: -8px; top: 0; width: 14px; height: 14px; background: #667eea; border-radius: 50%; }
        .timeline-date { font-weight: 600; color: #667eea; margin-bottom: 5px; }
        .timeline-content { color: #4a5568; font-size: 14px; }
        
        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .container { padding: 20px; } 
            h1 { font-size: 24px; }
            .score-options { grid-template-columns: repeat(3, 1fr); }
            .stats-grid { grid-template-columns: 1fr; }
            .button-group { flex-direction: column; }
            .btn { width: 100%; justify-content: center; }
            .ai-chat-window { width: calc(100vw - 40px); height: 60vh; right: 20px; left: 20px; bottom: 80px; top: auto; }
            .config-panel { max-width: 90%; right: 5%; left: 5%; top: 60px; }
            .step-label { font-size: 11px; }
            .ai-assistant-btn { width: 50px; height: 50px; font-size: 24px; bottom: 20px; right: 20px; }
            .step-indicator { flex-wrap: wrap; gap: 10px; }
            .step { flex: 0 0 45%; margin-bottom: 10px; }
            .step-indicator::before { display: none; }
        }
        
        @media (max-width: 480px) {
            .container { padding: 15px; }
            .ai-chat-window { width: calc(100vw - 30px); height: 70vh; right: 15px; left: 15px; }
            .ai-assistant-btn { width: 45px; height: 45px; font-size: 20px; bottom: 15px; right: 15px; }
            .step { flex: 0 0 100%; }
        }
        
        /* ä¿¡æ¯å¯ä¿¡åº¦æ ‡ç­¾ */
        .trust-badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 10px; margin-left: 5px; }
        .trust-official { background: #c6f6d5; color: #276749; }
        .trust-verified { background: #fefcbf; color: #744210; }
        .trust-community { background: #bee3f8; color: #2b6cb0; }
        
        .source-info { font-size: 12px; color: #718096; margin-top: 5px; }
        .timestamp { font-size: 11px; color: #a0aec0; }
        
        .location-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .location-section { background: #f8fafc; padding: 20px; border-radius: 12px; border: 2px solid #e2e8f0; }
        .location-section h4 { color: #2d3748; margin-bottom: 15px; font-size: 16px; }
        
        .transport-info { background: #f0f9ff; border: 1px solid #bee3f8; border-radius: 8px; padding: 15px; margin-top: 10px; }
        .transport-info h5 { color: #2b6cb0; margin-bottom: 8px; font-size: 14px; }
        
        .feedback-section { background: #f7fafc; border-radius: 16px; padding: 25px; margin-bottom: 20px; border: 2px solid #e2e8f0; }
        .feedback-section h3 { font-size: 20px; font-weight: 600; margin-bottom: 20px; color: #2d3748; }
        .feedback-group { margin-bottom: 18px; }
        .feedback-label { display: block; font-weight: 600; color: #2d3748; margin-bottom: 8px; font-size: 14px; }
        .feedback-select { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 14px; background: white; }
    </style>
</head>
<body>
    <!-- APIçŠ¶æ€æŒ‡ç¤ºå™¨ -->
    <div class="api-status local" id="apiStatus" onclick="toggleConfigPanel()">
        <i class="fas fa-laptop"></i> <span id="statusText">æœ¬åœ°æ¨¡å¼</span>
    </div>
    
    <!-- APIé…ç½®é¢æ¿ -->
    <div class="config-panel" id="configPanel">
        <div class="config-title"><i class="fas fa-key"></i> é˜¿é‡Œäº‘ç™¾ç‚¼APIé…ç½®</div>
        <div class="config-status info" id="configStatus">é…ç½®APIå¯è·å¾—æ›´æ™ºèƒ½çš„ä¸ªæ€§åŒ–æ¨è</div>
        <input type="password" class="config-input" id="apiKeyInput" placeholder="API Key (sk-å¼€å¤´)">
        <input type="text" class="config-input" id="appIdInput" placeholder="APP ID">
        <button class="config-btn" onclick="saveAndTestConfig()"><i class="fas fa-plug"></i> ä¿å­˜å¹¶æµ‹è¯•</button>
        <button class="config-btn secondary" onclick="useLocalMode()"><i class="fas fa-laptop"></i> ä½¿ç”¨æœ¬åœ°æ¨¡å¼</button>
        <div class="config-help">
            <strong>è·å–æ–¹å¼ï¼š</strong><br>
            1. ç™»å½•<a href="https://bailian.console.aliyun.com" target="_blank">é˜¿é‡Œäº‘ç™¾ç‚¼æ§åˆ¶å°</a><br>
            2. åº”ç”¨ç®¡ç† â†’ å¤åˆ¶APP ID<br>
            3. å¯†é’¥ç®¡ç† â†’ åˆ›å»ºAPI Key
        </div>
    </div>

    <div class="container">
        <div class="progress-bar" id="progressBar"></div>
        
        <h1>ğŸ“ è¥¿å®‰å°å‡åˆæ™ºèƒ½è¯„ä¼°ç³»ç»Ÿ <span class="ai-badge">2025å¢å¼ºç‰ˆ</span></h1>
        <p class="subtitle">åŸºäºæƒå¨çŸ¥è¯† Â· å®æ—¶æ›´æ–° Â· å¤šé‡éªŒè¯ Â· æ·±åº¦ä¸ªæ€§åŒ–</p>
        
        <!-- AIåŠ©æ‰‹ -->
        <div class="ai-assistant">
            <button class="ai-assistant-btn" onclick="toggleChat()">ğŸ±</button>
            <div class="ai-chat-window" id="chatWindow">
                <div class="ai-chat-header" id="chatHeader">
                    <div style="font-size: 32px;">ğŸ±</div>
                    <div>
                        <div style="font-weight: 600;">å°å–µå‡å­¦åŠ©æ‰‹</div>
                        <div style="font-size: 12px; opacity: 0.8;" id="chatApiStatus">æœ¬åœ°æ¨¡å¼</div>
                    </div>
                </div>
                <div class="ai-chat-body" id="chatBody">
                    <div class="ai-message assistant">
                        <div class="message-avatar">ğŸ±</div>
                        <div class="message-content">
                            å–µ~æ‚¨å¥½ï¼æˆ‘æ˜¯åŸºäº2025å¹´è¥¿å®‰ä¹‰åŠ¡æ•™è‚²æ”¿ç­–çš„å‡å­¦åŠ©æ‰‹ï¼
                            <br>ğŸ“‹ æ”¿ç­–ï¼šå…¬æ°‘åŒæ‹›ã€å…è¯•å…¥å­¦
                            <br>ğŸ« æ°‘åŠï¼š28æ‰€å­¦æ ¡ï¼Œè®¡åˆ’æ‹›ç”Ÿ12361äºº
                            <br>ğŸ“… æŠ¥åï¼š7æœˆ11æ—¥-24æ—¥
                            <br>ğŸ² æ‘‡å·ï¼š7æœˆ30æ—¥
                            <br>æœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨çš„ï¼Ÿ
                            <div class="source-info">
                                <span class="trust-badge trust-official">å®˜æ–¹æ•°æ®</span>
                                ä¿¡æ¯æ¥æºï¼šè¥¿å®‰å¸‚æ•™è‚²å±€ 2025å¹´æ‹›ç”Ÿæ”¿ç­–
                                <div class="timestamp">æ›´æ–°æ—¶é—´ï¼š2025-01-15</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ai-chat-input">
                    <div class="chat-input-group">
                        <input type="text" class="chat-input" id="chatInput" placeholder="è¾“å…¥é—®é¢˜..." onkeypress="handleKeyPress(event)">
                        <button class="send-btn" id="sendBtn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
                    </div>
                    <div class="quick-actions">
                        <button class="quick-action-btn" onclick="quickAction('2026å¹´å°å‡åˆæ—¶é—´å®‰æ’')">æ—¶é—´å®‰æ’</button>
                        <button class="quick-action-btn" onclick="quickAction('æ°‘åŠå­¦æ ¡æœ‰å“ªäº›')">æ°‘åŠå­¦æ ¡</button>
                        <button class="quick-action-btn" onclick="quickAction('æ‘‡å·æ”¿ç­–')">æ‘‡å·æ”¿ç­–</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- é‡è¦é€šçŸ¥ -->
        <div class="important-notice">
            <h3>ğŸ“‹ 2025å¹´è¥¿å®‰ä¹‰åŠ¡æ•™è‚²æ‹›ç”Ÿæ”¿ç­–è¦ç‚¹</h3>
            <ul>
                <li><strong>å…è¯•å°±è¿‘å…¥å­¦ï¼š</strong>å…¬åŠå­¦æ ¡æŒ‰å­¦åŒºåˆ’ç‰‡æ‹›ç”Ÿï¼Œä¸¥ç¦è€ƒè¯•é€‰æ‹”</li>
                <li><strong>å…¬æ°‘åŒæ‹›ï¼š</strong>æ°‘åŠä¸å…¬åŠåŒæ­¥æŠ¥å(7æœˆ11-24æ—¥)ã€åŒæ­¥æ‹›ç”Ÿ</li>
                <li><strong>ç”µè„‘éšæœºå½•å–ï¼š</strong>æ°‘åŠæŠ¥åè¶…è®¡åˆ’çš„å®è¡Œæ‘‡å·ï¼Œ7æœˆ30æ—¥ç»Ÿä¸€è¿›è¡Œ</li>
                <li><strong>æ‹›ç”Ÿå¹³å°ï¼š</strong>ç»Ÿä¸€ä½¿ç”¨é™•è¥¿"æ•™è‚²å…¥å­¦ä¸€ä»¶äº‹"æ‹›ç”Ÿå¹³å°</li>
                <li><strong>æ°‘åŠè§„æ¨¡ï¼š</strong>å…¨å¸‚28æ‰€æ°‘åŠåˆä¸­ï¼Œè®¡åˆ’æ‹›ç”Ÿ12361äºº</li>
                <li><strong>è¥¿å’¸æ–°åŒºçº³å…¥åŸå…­åŒºæ‹›ç”Ÿï¼š</strong>è¥¿å’¸æ–°åŒºä¸åŸå…­åŒºæ‹›ç”Ÿæ”¿ç­–ç»Ÿä¸€</li>
            </ul>
            <div class="source-info" style="margin-top: 15px; color: rgba(255,255,255,0.8);">
                <span class="trust-badge trust-official">å®˜æ–¹å‘å¸ƒ</span>
                æ•°æ®æ¥æºï¼šè¥¿å®‰å¸‚æ•™è‚²å±€å®˜æ–¹ç½‘ç«™
                <div class="timestamp">æ”¿ç­–å‘å¸ƒæ—¥æœŸï¼š2025-01-10</div>
            </div>
        </div>

        <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
        <div class="step-indicator">
            <div class="step active" id="step1-indicator" onclick="showStep(1)"><div class="step-number">1</div><div class="step-label">èƒ½åŠ›è¯„ä¼°</div></div>
            <div class="step" id="step2-indicator" onclick="showStep(2)"><div class="step-number">2</div><div class="step-label">æˆ·ç±ä¸å±…ä½</div></div>
            <div class="step" id="step3-indicator" onclick="showStep(3)"><div class="step-number">3</div><div class="step-label">å­¦åŒºæˆ¿äº§</div></div>
            <div class="step" id="step4-indicator" onclick="showStep(4)"><div class="step-number">4</div><div class="step-label">æ°‘åŠæ„å‘</div></div>
            <div class="step" id="step5-indicator" onclick="showStep(5)"><div class="step-number">5</div><div class="step-label">æ·±åº¦éœ€æ±‚</div></div>
            <div class="step" id="step6-indicator" onclick="showStep(6)"><div class="step-number">6</div><div class="step-label">AIæ¨è</div></div>
        </div>

        <!-- æ­¥éª¤1ï¼šèƒ½åŠ›è¯„ä¼° -->
        <div id="step1" class="section active">
            <div class="dimension-card">
                <div class="dimension-title">ğŸ“š ç»´åº¦ä¸€ï¼šå­¦ä¸šæˆç»©</div>
                <div class="dimension-desc">è¯„ä¼°å­©å­åœ¨ç­çº§/å¹´çº§çš„å­¦ä¸šæˆç»©æ’åæƒ…å†µ</div>
                <div class="score-options">
                    <div class="score-option"><input type="radio" name="score1" id="s1-5" value="5"><label for="s1-5" class="score-label"><span class="score-number">5</span><span class="score-desc">å¹´çº§å‰5%</span></label></div>
                    <div class="score-option"><input type="radio" name="score1" id="s1-4" value="4"><label for="s1-4" class="score-label"><span class="score-number">4</span><span class="score-desc">å¹´çº§å‰15%</span></label></div>
                    <div class="score-option"><input type="radio" name="score1" id="s1-3" value="3"><label for="s1-3" class="score-label"><span class="score-number">3</span><span class="score-desc">å¹´çº§å‰30%</span></label></div>
                    <div class="score-option"><input type="radio" name="score1" id="s1-2" value="2"><label for="s1-2" class="score-label"><span class="score-number">2</span><span class="score-desc">å¹´çº§å‰50%</span></label></div>
                    <div class="score-option"><input type="radio" name="score1" id="s1-1" value="1"><label for="s1-1" class="score-label"><span class="score-number">1</span><span class="score-desc">å¹´çº§50%å</span></label></div>
                </div>
            </div>
            
            <div class="dimension-card">
                <div class="dimension-title">ğŸ¨ ç»´åº¦äºŒï¼šç»¼åˆç´ å…»</div>
                <div class="dimension-desc">ç‰¹é•¿ã€è·å¥–æƒ…å†µå’Œç»¼åˆå‘å±•æ°´å¹³</div>
                <div class="score-options">
                    <div class="score-option"><input type="radio" name="score2" id="s2-5" value="5"><label for="s2-5" class="score-label"><span class="score-number">5</span><span class="score-desc">çœçº§è·å¥–</span></label></div>
                    <div class="score-option"><input type="radio" name="score2" id="s2-4" value="4"><label for="s2-4" class="score-label"><span class="score-number">4</span><span class="score-desc">å¸‚çº§è¯ä¹¦</span></label></div>
                    <div class="score-option"><input type="radio" name="score2" id="s2-3" value="3"><label for="s2-3" class="score-label"><span class="score-number">3</span><span class="score-desc">æ ¡çº§è·å¥–</span></label></div>
                    <div class="score-option"><input type="radio" name="score2" id="s2-2" value="2"><label for="s2-2" class="score-label"><span class="score-number">2</span><span class="score-desc">å‚ä¸æ´»åŠ¨</span></label></div>
                    <div class="score-option"><input type="radio" name="score2" id="s2-1" value="1"><label for="s2-1" class="score-label"><span class="score-number">1</span><span class="score-desc">è¾ƒå°‘å‚ä¸</span></label></div>
                </div>
            </div>

            <div class="dimension-card">
                <div class="dimension-title">ğŸ“– ç»´åº¦ä¸‰ï¼šå­¦ä¹ ä¹ æƒ¯</div>
                <div class="dimension-desc">è‡ªå¾‹æ€§å’Œå­¦ä¹ ä¸»åŠ¨æ€§</div>
                <div class="score-options">
                    <div class="score-option"><input type="radio" name="score3" id="s3-5" value="5"><label for="s3-5" class="score-label"><span class="score-number">5</span><span class="score-desc">éå¸¸è‡ªå¾‹</span></label></div>
                    <div class="score-option"><input type="radio" name="score3" id="s3-4" value="4"><label for="s3-4" class="score-label"><span class="score-number">4</span><span class="score-desc">è¾ƒä¸ºè‡ªå¾‹</span></label></div>
                    <div class="score-option"><input type="radio" name="score3" id="s3-3" value="3"><label for="s3-3" class="score-label"><span class="score-number">3</span><span class="score-desc">éœ€è¦ç›‘ç£</span></label></div>
                    <div class="score-option"><input type="radio" name="score3" id="s3-2" value="2"><label for="s3-2" class="score-label"><span class="score-number">2</span><span class="score-desc">éœ€å¤šç£ä¿ƒ</span></label></div>
                    <div class="score-option"><input type="radio" name="score3" id="s3-1" value="1"><label for="s3-1" class="score-label"><span class="score-number">1</span><span class="score-desc">ä¹ æƒ¯è¾ƒå·®</span></label></div>
                </div>
            </div>

            <div class="dimension-card">
                <div class="dimension-title">ğŸ’ª ç»´åº¦å››ï¼šå¿ƒç†ç´ è´¨</div>
                <div class="dimension-desc">æŠ—å‹èƒ½åŠ›å’Œå¿ƒç†æ‰¿å—èƒ½åŠ›</div>
                <div class="score-options">
                    <div class="score-option"><input type="radio" name="score4" id="s4-5" value="5"><label for="s4-5" class="score-label"><span class="score-number">5</span><span class="score-desc">æŠ—å‹å¾ˆå¼º</span></label></div>
                    <div class="score-option"><input type="radio" name="score4" id="s4-4" value="4"><label for="s4-4" class="score-label"><span class="score-number">4</span><span class="score-desc">å¿ƒæ€ç¨³å®š</span></label></div>
                    <div class="score-option"><input type="radio" name="score4" id="s4-3" value="3"><label for="s4-3" class="score-label"><span class="score-number">3</span><span class="score-desc">ä¸€èˆ¬æ°´å¹³</span></label></div>
                    <div class="score-option"><input type="radio" name="score4" id="s4-2" value="2"><label for="s4-2" class="score-label"><span class="score-number">2</span><span class="score-desc">å®¹æ˜“ç„¦è™‘</span></label></div>
                    <div class="score-option"><input type="radio" name="score4" id="s4-1" value="1"><label for="s4-1" class="score-label"><span class="score-number">1</span><span class="score-desc">éœ€è¦å…³æ³¨</span></label></div>
                </div>
            </div>

            <div class="dimension-card">
                <div class="dimension-title">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ç»´åº¦äº”ï¼šå®¶åº­æ”¯æŒ</div>
                <div class="dimension-desc">å®¶åº­åœ¨æ—¶é—´ã€ç»æµã€ç²¾åŠ›æ–¹é¢çš„æ”¯æŒ</div>
                <div class="score-options">
                    <div class="score-option"><input type="radio" name="score5" id="s5-5" value="5"><label for="s5-5" class="score-label"><span class="score-number">5</span><span class="score-desc">å…¨åŠ›æ”¯æŒ</span></label></div>
                    <div class="score-option"><input type="radio" name="score5" id="s5-4" value="4"><label for="s5-4" class="score-label"><span class="score-number">4</span><span class="score-desc">ç§¯ææ”¯æŒ</span></label></div>
                    <div class="score-option"><input type="radio" name="score5" id="s5-3" value="3"><label for="s5-3" class="score-label"><span class="score-number">3</span><span class="score-desc">ä¸€èˆ¬æ”¯æŒ</span></label></div>
                    <div class="score-option"><input type="radio" name="score5" id="s5-2" value="2"><label for="s5-2" class="score-label"><span class="score-number">2</span><span class="score-desc">æœ‰é™æ”¯æŒ</span></label></div>
                    <div class="score-option"><input type="radio" name="score5" id="s5-1" value="1"><label for="s5-1" class="score-label"><span class="score-number">1</span><span class="score-desc">æ”¯æŒä¸è¶³</span></label></div>
                </div>
            </div>

            <div class="dimension-card">
                <div class="dimension-title">ğŸ”¬ ç»´åº¦å…­ï¼šå­¦ç§‘å€¾å‘</div>
                <div class="dimension-desc">å­©å­çš„å­¦ç§‘ä¼˜åŠ¿å’Œå…´è¶£æ–¹å‘</div>
                <div class="score-options">
                    <div class="score-option"><input type="radio" name="score6" id="s6-5" value="5"><label for="s6-5" class="score-label"><span class="score-number">5</span><span class="score-desc">ç†ç§‘ä¼˜åŠ¿</span></label></div>
                    <div class="score-option"><input type="radio" name="score6" id="s6-4" value="4"><label for="s6-4" class="score-label"><span class="score-number">4</span><span class="score-desc">æ–‡ç§‘ä¼˜åŠ¿</span></label></div>
                    <div class="score-option"><input type="radio" name="score6" id="s6-3" value="3"><label for="s6-3" class="score-label"><span class="score-number">3</span><span class="score-desc">å‡è¡¡å‘å±•</span></label></div>
                    <div class="score-option"><input type="radio" name="score6" id="s6-2" value="2"><label for="s6-2" class="score-label"><span class="score-number">2</span><span class="score-desc">æœ‰åç§‘</span></label></div>
                    <div class="score-option"><input type="radio" name="score6" id="s6-1" value="1"><label for="s6-1" class="score-label"><span class="score-number">1</span><span class="score-desc">å­¦ä¹ å›°éš¾</span></label></div>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="goToStep2()">ä¸‹ä¸€æ­¥ï¼šæˆ·ç±ä¸å±…ä½ä¿¡æ¯ â†’</button>
            </div>
        </div>

        <!-- æ­¥éª¤2ï¼šæˆ·ç±ä¸å±…ä½ä¿¡æ¯ -->
        <div id="step2" class="section">
            <div class="info-section">
                <h3>ğŸ  æˆ·ç±ä¸å±…ä½ä¿¡æ¯</h3>
                <p style="color: #718096; margin-bottom: 20px; font-size: 14px;">è¯·å‡†ç¡®å¡«å†™æˆ·ç±å’Œå®é™…å±…ä½ä¿¡æ¯ï¼Œè¿™å°†ç›´æ¥å½±å“å…¬åŠå­¦æ ¡åŒ¹é…å’Œå…¥å­¦é¡ºä½è¯„ä¼°</p>
                
                <div class="location-grid">
                    <!-- æˆ·ç±ä¿¡æ¯ -->
                    <div class="location-section">
                        <h4>ğŸ“ æˆ·ç±ä¿¡æ¯</h4>
                        <div class="info-group">
                            <label class="info-label">æˆ·ç±æ‰€åœ¨åŒº</label>
                            <select class="info-select" id="householdDistrict">
                                <option value="">è¯·é€‰æ‹©åŒº</option>
                                <option value="é›å¡”åŒº">é›å¡”åŒº</option>
                                <option value="ç¢‘æ—åŒº">ç¢‘æ—åŒº</option>
                                <option value="æ–°åŸåŒº">æ–°åŸåŒº</option>
                                <option value="è²æ¹–åŒº">è²æ¹–åŒº</option>
                                <option value="æœªå¤®åŒº">æœªå¤®åŒº</option>
                                <option value="çæ¡¥åŒº">çæ¡¥åŒº</option>
                                <option value="é•¿å®‰åŒº">é•¿å®‰åŒº</option>
                                <option value="é«˜æ–°åŒº">é«˜æ–°åŒº</option>
                                <option value="æ›²æ±Ÿæ–°åŒº">æ›²æ±Ÿæ–°åŒº</option>
                                <option value="ç»å¼€åŒº">ç»å¼€åŒº</option>
                                <option value="æµçç”Ÿæ€åŒº">æµçç”Ÿæ€åŒº</option>
                                <option value="èˆªå¤©åŸºåœ°">èˆªå¤©åŸºåœ°</option>
                                <option value="è¥¿å’¸æ–°åŒº">è¥¿å’¸æ–°åŒº</option>
                                <option value="å¤–åœ°æˆ·ç±">å¤–åœ°æˆ·ç±</option>
                            </select>
                        </div>
                        <div class="info-group">
                            <label class="info-label">æˆ·ç±æ‰€åœ¨è¡—é“</label>
                            <select class="info-select" id="householdStreet">
                                <option value="">è¯·å…ˆé€‰æ‹©åŒº</option>
                            </select>
                        </div>
                        <div class="info-group">
                            <label class="info-label">æˆ·ç±è¯¦ç»†åœ°å€ï¼ˆå¯é€‰ï¼‰</label>
                            <input type="text" class="info-input" id="householdAddress" placeholder="ä¾‹å¦‚ï¼šXXå°åŒºXXå·æ¥¼XXå•å…ƒ">
                        </div>
                    </div>
                    
                    <!-- å±…ä½ä¿¡æ¯ -->
                    <div class="location-section">
                        <h4>ğŸ¡ å®é™…å±…ä½ä¿¡æ¯</h4>
                        <div class="info-group">
                            <label class="info-label">å®é™…å±…ä½åŒº</label>
                            <select class="info-select" id="residenceDistrict">
                                <option value="">è¯·é€‰æ‹©åŒº</option>
                                <option value="é›å¡”åŒº">é›å¡”åŒº</option>
                                <option value="ç¢‘æ—åŒº">ç¢‘æ—åŒº</option>
                                <option value="æ–°åŸåŒº">æ–°åŸåŒº</option>
                                <option value="è²æ¹–åŒº">è²æ¹–åŒº</option>
                                <option value="æœªå¤®åŒº">æœªå¤®åŒº</option>
                                <option value="çæ¡¥åŒº">çæ¡¥åŒº</option>
                                <option value="é•¿å®‰åŒº">é•¿å®‰åŒº</option>
                                <option value="é«˜æ–°åŒº">é«˜æ–°åŒº</option>
                                <option value="æ›²æ±Ÿæ–°åŒº">æ›²æ±Ÿæ–°åŒº</option>
                                <option value="ç»å¼€åŒº">ç»å¼€åŒº</option>
                                <option value="æµçç”Ÿæ€åŒº">æµçç”Ÿæ€åŒº</option>
                                <option value="èˆªå¤©åŸºåœ°">èˆªå¤©åŸºåœ°</option>
                                <option value="è¥¿å’¸æ–°åŒº">è¥¿å’¸æ–°åŒº</option>
                            </select>
                        </div>
                        <div class="info-group">
                            <label class="info-label">å®é™…å±…ä½è¡—é“</label>
                            <select class="info-select" id="residenceStreet">
                                <option value="">è¯·å…ˆé€‰æ‹©åŒº</option>
                            </select>
                        </div>
                        <div class="info-group">
                            <label class="info-label">å±…ä½è¯¦ç»†åœ°å€</label>
                            <input type="text" class="info-input" id="residenceAddress" placeholder="ä¾‹å¦‚ï¼šXXå°åŒºXXå·æ¥¼XXå•å…ƒ">
                        </div>
                        <div class="info-group">
                            <label class="info-label">å±…ä½æ€§è´¨</label>
                            <select class="info-select" id="residenceType">
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="è‡ªæœ‰æˆ¿äº§">è‡ªæœ‰æˆ¿äº§</option>
                                <option value="ç§Ÿæˆ¿">ç§Ÿæˆ¿</option>
                                <option value="å•ä½å®¿èˆ">å•ä½å®¿èˆ</option>
                                <option value="å…¶ä»–">å…¶ä»–</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- å±…ä½åŒ¹é…æƒ…å†µ -->
                <div class="info-group">
                    <label class="info-label">æˆ·ç±ä¸å±…ä½åœ°åŒ¹é…æƒ…å†µ</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label"><input type="checkbox" id="sameDistrict"> æˆ·ç±åŒºä¸å±…ä½åŒºç›¸åŒ</label>
                        <label class="checkbox-label"><input type="checkbox" id="sameStreet"> æˆ·ç±è¡—é“ä¸å±…ä½è¡—é“ç›¸åŒ</label>
                        <label class="checkbox-label"><input type="checkbox" id="inSchoolDistrict"> åœ¨å­¦åŒºå†…å±…ä½</label>
                    </div>
                </div>
                
                <div class="transport-info">
                    <h5>ğŸš— äº¤é€šä¾¿åˆ©æ€§è¯„ä¼°</h5>
                    <p style="font-size: 13px; color: #4a5568;">ç³»ç»Ÿå°†æ ¹æ®æ‚¨çš„å±…ä½ä½ç½®è¯„ä¼°åˆ°æ¨èå­¦æ ¡çš„é€šå‹¤æ—¶é—´ï¼Œä¼˜å…ˆæ¨èäº¤é€šä¾¿åˆ©çš„å­¦æ ¡</p>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn btn-secondary" onclick="goToStep1()">â† ä¸Šä¸€æ­¥</button>
                <button class="btn btn-primary" onclick="goToStep3()">ä¸‹ä¸€æ­¥ï¼šå­¦åŒºæˆ¿äº§ä¿¡æ¯ â†’</button>
            </div>
        </div>

        <!-- æ­¥éª¤3ï¼šå­¦åŒºæˆ¿äº§ä¿¡æ¯ -->
        <div id="step3" class="section">
            <div class="info-section">
                <h3>ğŸ“‹ å­¦åŒºæˆ¿äº§ä¿¡æ¯</h3>
                <p style="color: #718096; margin-bottom: 20px; font-size: 14px;">å…¬åŠå­¦æ ¡å…¥å­¦èµ„æ ¼ç›¸å…³ä¿¡æ¯ï¼Œè¯·å¦‚å®å¡«å†™</p>
                
                <div class="info-group">
                    <label class="info-label">å­¦åŒºæˆ¿æƒ…å†µ</label>
                    <select class="info-select" id="hasHouse">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="yes-good">æœ‰ï¼Œå¯¹å£ä¼˜è´¨å…¬åŠ</option>
                        <option value="yes-normal">æœ‰ï¼Œå¯¹å£ä¸€èˆ¬å…¬åŠ</option>
                        <option value="no">æš‚æ— å­¦åŒºæˆ¿</option>
                        <option value="rent">ç§Ÿæˆ¿å±…ä½</option>
                    </select>
                </div>
                
                <div class="info-group">
                    <label class="info-label">æˆ¿äº§è¯ç±»å‹</label>
                    <select class="info-select" id="propertyType">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="å•†å“æˆ¿">å•†å“æˆ¿</option>
                        <option value="æˆ¿æ”¹æˆ¿">æˆ¿æ”¹æˆ¿</option>
                        <option value="å®‰ç½®æˆ¿">å®‰ç½®æˆ¿</option>
                        <option value="ç»æµé€‚ç”¨æˆ¿">ç»æµé€‚ç”¨æˆ¿</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                </div>
                
                <div class="info-group">
                    <label class="info-label">æˆ¿äº§æŒæœ‰æ—¶é—´</label>
                    <select class="info-select" id="propertyYears">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="3å¹´ä»¥ä¸Š">3å¹´ä»¥ä¸Š</option>
                        <option value="1-3å¹´">1-3å¹´</option>
                        <option value="1å¹´ä»¥å†…">1å¹´ä»¥å†…</option>
                        <option value="æ–°è´­">æ–°è´­ï¼ˆæœªæ»¡1å¹´ï¼‰</option>
                    </select>
                </div>
                
                <div class="info-group">
                    <label class="info-label">é¢„ä¼°å…¥å­¦é¡ºä½</label>
                    <div style="background: #f0fff4; padding: 15px; border-radius: 8px; border: 1px solid #c6f6d5;">
                        <div id="admissionPriority" style="color: #276749; font-weight: 600;">è¯·å¡«å†™ä»¥ä¸Šä¿¡æ¯åè‡ªåŠ¨è¯„ä¼°</div>
                        <div id="priorityReason" style="color: #718096; font-size: 13px; margin-top: 5px;">åŸºäºè¥¿å®‰å¸‚å…¬åŠå…¥å­¦æ”¿ç­–è¯„ä¼°</div>
                    </div>
                </div>
                
                <div class="policy-box">
                    <h4>ğŸ“ è¥¿å®‰å¸‚å…¬åŠå…¥å­¦é¡ºä½è¯´æ˜</h4>
                    <p><strong>ç¬¬ä¸€é¡ºä½ï¼š</strong>æˆ¿æˆ·ä¸€è‡´ï¼Œä¸”åœ¨å­¦åŒºå†…å±…ä½</p>
                    <p><strong>ç¬¬äºŒé¡ºä½ï¼š</strong>æˆ¿æˆ·ä¸€è‡´ï¼Œä½†è·¨å­¦åŒºå±…ä½</p>
                    <p><strong>ç¬¬ä¸‰é¡ºä½ï¼š</strong>é›†ä½“æˆ·/æŒ‚é æˆ·ï¼Œæ— å­¦åŒºæˆ¿</p>
                    <p><strong>ç¬¬å››é¡ºä½ï¼š</strong>ç§Ÿæˆ¿å±…ä½ï¼Œç»Ÿç­¹å®‰æ’å…¥å­¦</p>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn btn-secondary" onclick="goToStep2()">â† ä¸Šä¸€æ­¥</button>
                <button class="btn btn-primary" onclick="goToStep4()">ä¸‹ä¸€æ­¥ï¼šæ°‘åŠæ„å‘ä¸é¢„ç®— â†’</button>
            </div>
        </div>

        <!-- æ­¥éª¤4ï¼šæ°‘åŠæ„å‘ä¸é¢„ç®— -->
        <div id="step4" class="section">
            <div class="info-section">
                <h3>ğŸ’° æ°‘åŠæ„å‘ä¸é¢„ç®—</h3>
                
                <div class="info-group">
                    <label class="info-label">æ˜¯å¦è€ƒè™‘æ°‘åŠå­¦æ ¡</label>
                    <select class="info-select" id="considerPrivate">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="yes">æ˜¯ï¼Œæ„¿æ„å‚åŠ æ‘‡å·</option>
                        <option value="cautious">è§‚æœ›ä¸­ï¼Œçœ‹æƒ…å†µå†³å®š</option>
                        <option value="no">å¦ï¼Œåªè€ƒè™‘å…¬åŠ</option>
                    </select>
                </div>
                
                <div class="info-group">
                    <label class="info-label">å¯æ¥å—çš„è·¨åŒºèŒƒå›´</label>
                    <select class="info-select" id="crossDistrictPreference">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="æœ¬åŒº">ä»…é™æœ¬åŒºå­¦æ ¡</option>
                        <option value="ç›¸é‚»åŒº">æœ¬åŒºåŠç›¸é‚»åŒº</option>
                        <option value="å…¨å¸‚èŒƒå›´">å…¨å¸‚èŒƒå›´å‡å¯</option>
                    </select>
                </div>
                
                <div class="info-group">
                    <label class="info-label">æ°‘åŠå­¦æ ¡é¢„ç®—ï¼ˆåˆä¸­ä¸‰å¹´ï¼‰</label>
                    <select class="info-select" id="budget">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="low">3ä¸‡ä»¥å†…ï¼ˆå…¬åŠä¸ºä¸»ï¼‰</option>
                        <option value="medium">3-10ä¸‡ï¼ˆå¯è€ƒè™‘æ°‘åŠï¼‰</option>
                        <option value="high">10ä¸‡ä»¥ä¸Šï¼ˆæ°‘åŠæ— å‹åŠ›ï¼‰</option>
                    </select>
                </div>
                
                <div class="info-group">
                    <label class="info-label">å¯¹æ‘‡å·ä¸ç¡®å®šæ€§çš„æ€åº¦</label>
                    <select class="info-select" id="acceptLottery">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="yes">æ¥å—ï¼Œæ„¿æ„å†²åˆºçƒ­é—¨æ ¡</option>
                        <option value="cautious">è°¨æ…ï¼Œå¸Œæœ›ç¨³å¦¥ä¸ºä¸»</option>
                        <option value="no">ä¸æ¥å—ï¼Œå¿…é¡»ç¡®å®šæ€§</option>
                    </select>
                </div>
                
                <div class="info-group">
                    <label class="info-label">å­©å­ç‰¹é•¿ï¼ˆå¯å¤šé€‰ï¼‰</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label"><input type="checkbox" value="æ•°å­¦" class="strength-check"> æ•°å­¦</label>
                        <label class="checkbox-label"><input type="checkbox" value="è¯­æ–‡" class="strength-check"> è¯­æ–‡</label>
                        <label class="checkbox-label"><input type="checkbox" value="è‹±è¯­" class="strength-check"> è‹±è¯­</label>
                        <label class="checkbox-label"><input type="checkbox" value="è‰ºæœ¯" class="strength-check"> è‰ºæœ¯</label>
                        <label class="checkbox-label"><input type="checkbox" value="ä½“è‚²" class="strength-check"> ä½“è‚²</label>
                        <label class="checkbox-label"><input type="checkbox" value="ç§‘æŠ€" class="strength-check"> ç§‘æŠ€</label>
                    </div>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn btn-secondary" onclick="goToStep3()">â† ä¸Šä¸€æ­¥</button>
                <button class="btn btn-primary" onclick="goToStep5()">ä¸‹ä¸€æ­¥ï¼šæ·±åº¦éœ€æ±‚åˆ†æ â†’</button>
            </div>
        </div>

        <!-- æ­¥éª¤5ï¼šæ·±åº¦éœ€æ±‚åˆ†æ -->
        <div id="step5" class="section">
            <div class="feedback-section">
                <h3>ğŸ¯ æ·±åº¦éœ€æ±‚åˆ†æ</h3>
                
                <div class="feedback-group">
                    <label class="feedback-label">åˆä¸­åçš„å­¦ä¸šè§„åˆ’</label>
                    <select class="feedback-select" id="academicGoals">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="å†²åˆºé‡ç‚¹é«˜ä¸­">å†²åˆºé‡ç‚¹é«˜ä¸­</option>
                        <option value="ç¨³å®šå‡å…¥æ™®é€šé«˜ä¸­" selected>ç¨³å®šå‡å…¥æ™®é€šé«˜ä¸­</option>
                        <option value="è€ƒè™‘å›½é™…æ•™è‚²è·¯å¾„">è€ƒè™‘å›½é™…æ•™è‚²è·¯å¾„</option>
                        <option value="å°šæœªæ˜ç¡®è§„åˆ’">å°šæœªæ˜ç¡®è§„åˆ’</option>
                        <option value="æ ¹æ®å­©å­å‘å±•å†å®š">æ ¹æ®å­©å­å‘å±•å†å®š</option>
                    </select>
                </div>
                
                <div class="feedback-group">
                    <label class="feedback-label">æ›´çœ‹é‡å­¦æ ¡çš„å“ªäº›æ–¹é¢ï¼ˆå¯å¤šé€‰ï¼‰</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label"><input type="checkbox" value="å­¦æœ¯æˆç»©å’Œå‡å­¦ç‡" class="philosophy-check" checked> å­¦æœ¯æˆç»©å’Œå‡å­¦ç‡</label>
                        <label class="checkbox-label"><input type="checkbox" value="ç»¼åˆç´ è´¨åŸ¹å…»" class="philosophy-check" checked> ç»¼åˆç´ è´¨åŸ¹å…»</label>
                        <label class="checkbox-label"><input type="checkbox" value="ç‰¹è‰²è¯¾ç¨‹å’Œç¤¾å›¢æ´»åŠ¨" class="philosophy-check" checked> ç‰¹è‰²è¯¾ç¨‹å’Œç¤¾å›¢æ´»åŠ¨</label>
                        <label class="checkbox-label"><input type="checkbox" value="å­¦æ ¡ç®¡ç†å’Œæ ¡é£" class="philosophy-check" checked> å­¦æ ¡ç®¡ç†å’Œæ ¡é£</label>
                        <label class="checkbox-label"><input type="checkbox" value="å¸ˆç”Ÿå…³ç³»å’Œæ ¡å›­æ°›å›´" class="philosophy-check" checked> å¸ˆç”Ÿå…³ç³»å’Œæ ¡å›­æ°›å›´</label>
                        <label class="checkbox-label"><input type="checkbox" value="åœ°ç†ä½ç½®å’Œäº¤é€šä¾¿åˆ©" class="philosophy-check" checked> åœ°ç†ä½ç½®å’Œäº¤é€šä¾¿åˆ©</label>
                    </div>
                </div>
                
                <div class="feedback-group">
                    <label class="feedback-label">å­©å­çš„ç‰¹æ®Šéœ€æ±‚</label>
                    <select class="feedback-select" id="specificNeeds">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="éœ€è¦é‡ç‚¹å…³æ³¨å’Œè¾…å¯¼">éœ€è¦é‡ç‚¹å…³æ³¨å’Œè¾…å¯¼</option>
                        <option value="æœ‰è‰ºæœ¯ä½“è‚²ç‰¹é•¿éœ€è¦å‘å±•">æœ‰è‰ºæœ¯ä½“è‚²ç‰¹é•¿éœ€è¦å‘å±•</option>
                        <option value="éœ€è¦å¤–è¯­ç‰¹è‰²ç¯å¢ƒ">éœ€è¦å¤–è¯­ç‰¹è‰²ç¯å¢ƒ</option>
                        <option value="éœ€è¦ä½æ ¡æˆ–æ™šæ‰˜æœåŠ¡" selected>éœ€è¦ä½æ ¡æˆ–æ™šæ‰˜æœåŠ¡</option>
                        <option value="å¯¹æ ¡å›­è®¾æ–½æœ‰ç‰¹æ®Šè¦æ±‚">å¯¹æ ¡å›­è®¾æ–½æœ‰ç‰¹æ®Šè¦æ±‚</option>
                        <option value="æ— ç‰¹æ®Šéœ€æ±‚">æ— ç‰¹æ®Šéœ€æ±‚</option>
                    </select>
                </div>
                
                <div class="feedback-group">
                    <label class="feedback-label">æ•™è‚²é€‰æ‹©çš„é£é™©åå¥½</label>
                    <select class="feedback-select" id="riskTolerance">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="æ„¿æ„å†’é™©è¿½æ±‚æœ€å¥½å­¦æ ¡">æ„¿æ„å†’é™©è¿½æ±‚æœ€å¥½å­¦æ ¡</option>
                        <option value="åå¥½ç¨³å¦¥å¯é çš„é€‰æ‹©" selected>åå¥½ç¨³å¦¥å¯é çš„é€‰æ‹©</option>
                        <option value="å¸Œæœ›åœ¨é£é™©å’Œæ”¶ç›Šé—´å¹³è¡¡">å¸Œæœ›åœ¨é£é™©å’Œæ”¶ç›Šé—´å¹³è¡¡</option>
                        <option value="å®Œå…¨è§„é¿ä¸ç¡®å®šæ€§">å®Œå…¨è§„é¿ä¸ç¡®å®šæ€§</option>
                    </select>
                </div>
                
                <div class="feedback-group">
                    <label class="feedback-label">å®¶åº­å¯æŠ•å…¥çš„æ•™è‚²æ—¶é—´</label>
                    <select class="feedback-select" id="timeCommitment">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="å…¨èŒé™ªä¼´å’Œè¾…å¯¼">å…¨èŒé™ªä¼´å’Œè¾…å¯¼</option>
                        <option value="å·¥ä½œæ—¥æ™šä¸Šå¯è¾…å¯¼">å·¥ä½œæ—¥æ™šä¸Šå¯è¾…å¯¼</option>
                        <option value="å‘¨æœ«å¯é›†ä¸­é™ªä¼´" selected>å‘¨æœ«å¯é›†ä¸­é™ªä¼´</option>
                        <option value="æ—¶é—´æœ‰é™ä¸»è¦é å­¦æ ¡">æ—¶é—´æœ‰é™ä¸»è¦é å­¦æ ¡</option>
                        <option value="éœ€è¦å­¦æ ¡å…¨æƒè´Ÿè´£">éœ€è¦å­¦æ ¡å…¨æƒè´Ÿè´£</option>
                    </select>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn btn-secondary" onclick="goToStep4()">â† ä¸Šä¸€æ­¥</button>
                <button class="btn btn-primary" onclick="generateReport()">ç”Ÿæˆåˆ†ææŠ¥å‘Š â†’</button>
            </div>
        </div>

        <!-- æ­¥éª¤6ï¼šAIæ¨è -->
        <div id="step6" class="section">
            <div class="result-card">
                <div class="result-title">ğŸ« AIæ™ºèƒ½å­¦æ ¡æ¨è</div>
                <div id="schoolRecommendation">
                    <div class="ai-loading">
                        <div class="ai-loading-spinner"></div>
                        <p>AIæ­£åœ¨åŸºäºæ‚¨çš„ä¿¡æ¯è¿›è¡Œæ·±åº¦åˆ†æ...</p>
                        <div class="source-info">
                            <span class="trust-badge trust-verified">å¤šé‡éªŒè¯ä¸­</span>
                            æ­£åœ¨éªŒè¯ä¿¡æ¯å‡†ç¡®æ€§å’Œæ—¶æ•ˆæ€§
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="result-card">
                <div class="result-title">ğŸ“… ä¸ªæ€§åŒ–æ—¶é—´è§„åˆ’</div>
                <div id="timeline"></div>
            </div>
            
            <div class="result-card">
                <div class="result-title">ğŸ’¡ æ”¿ç­–æé†’ä¸å»ºè®®</div>
                <div id="policyAdvice"></div>
            </div>
            
            <div class="button-group">
                <button class="btn btn-secondary" onclick="goToStep5()">â† è¿”å›ä¿®æ”¹</button>
                <button class="btn btn-primary" onclick="window.print()">ğŸ–¨ï¸ æ‰“å°æŠ¥å‘Š</button>
                <button class="btn btn-secondary" onclick="resetAll()">ğŸ”„ é‡æ–°è¯„ä¼°</button>
            </div>
        </div>
    </div>

<script>
// ========== å…¨å±€é…ç½®ä¸æ•°æ® ==========
const CONFIG = {
    apiKey: '',
    appId: '',
    isConnected: false,
    isChatInitialized: false
};

let assessmentData = { scores: {}, familyInfo: {}, totalScore: 0 };
let isDragging = false;
let dragOffsetX = 0;
let dragOffsetY = 0;
let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

// æƒé‡é…ç½®
const DIMENSION_WEIGHTS = {
    score1: 0.30, score2: 0.15, score3: 0.25, 
    score4: 0.10, score5: 0.10, score6: 0.10
};

// è¥¿å®‰å¸‚è¡—é“æ•°æ®
const DISTRICT_STREETS = {
    'é›å¡”åŒº': ['å°å¯¨è·¯è¡—é“', 'é•¿å»¶å ¡è¡—é“', 'å¤§é›å¡”è¡—é“', 'ç”µå­åŸè¡—é“', 'ç­‰é©¾å¡è¡—é“', 'æ›²æ±Ÿè¡—é“'],
    'ç¢‘æ—åŒº': ['é•¿å®‰è·¯è¡—é“', 'æ–‡è‰ºè·¯è¡—é“', 'æŸæ ‘æ—è¡—é“', 'ä¸œå…³å—è¡—è¡—é“', 'å¤ªä¹™è·¯è¡—é“', 'å—é™¢é—¨è¡—é“'],
    'æ–°åŸåŒº': ['è§£æ”¾é—¨è¡—é“', 'ä¸­å±±é—¨è¡—é“', 'éŸ©æ£®å¯¨è¡—é“', 'èƒ¡å®¶åº™è¡—é“', 'é•¿ä¹ä¸­è·¯è¡—é“', 'è‡ªå¼ºè·¯è¡—é“'],
    'è²æ¹–åŒº': ['åŒ—é™¢é—¨è¡—é“', 'é’å¹´è·¯è¡—é“', 'åº™åè¡—è¡—é“', 'è¥¿å…³è¡—é“', 'åœŸé—¨è¡—é“', 'çº¢åº™å¡è¡—é“'],
    'æœªå¤®åŒº': ['å¼ å®¶å ¡è¡—é“', 'ä¸‰æ¡¥è¡—é“', 'è¾›å®¶åº™è¡—é“', 'å¾å®¶æ¹¾è¡—é“', 'å¤§æ˜å®«è¡—é“', 'è°­å®¶è¡—é“'],
    'çæ¡¥åŒº': ['çººç»‡åŸè¡—é“', 'çº¢æ——è¡—é“', 'æ´ªåº†è¡—é“', 'ç‹„å¯¨è¡—é“', 'å¸­ç‹è¡—é“', 'æ–°ç­‘è¡—é“'],
    'é•¿å®‰åŒº': ['éŸ¦æ›²è¡—é“', 'éƒ­æœè¡—é“', 'æ»¦é•‡è¡—é“', 'å¼•é•‡è¡—é“', 'ç‹æ›²è¡—é“', 'å­åˆè¡—é“'],
    'é«˜æ–°åŒº': ['ä¸ˆå…«æ²Ÿè¡—é“', 'é±¼åŒ–å¯¨è¡—é“', 'ç»†æŸ³è¡—é“', 'å…´éš†è¡—é“', 'çµæ²¼è¡—é“', 'ä¸œå¤§è¡—é“'],
    'æ›²æ±Ÿæ–°åŒº': ['æ›²æ±Ÿè¡—é“', 'å¤§é›å¡”è¡—é“', 'ç­‰é©¾å¡è¡—é“'],
    'ç»å¼€åŒº': ['å‡¤åŸè·¯è¡—é“', 'å¼ å®¶å ¡è¡—é“', 'æœªå¤®å®«è¡—é“'],
    'æµçç”Ÿæ€åŒº': ['è¾›å®¶åº™è¡—é“', 'çæ¡¥è¡—é“', 'æœªå¤®æ¹–è¡—é“'],
    'èˆªå¤©åŸºåœ°': ['éŸ¦æ›²è¡—é“', 'æœé™µè¡—é“'],
    'è¥¿å’¸æ–°åŒº': ['æ­£é˜³è¡—é“', 'çª‘åº—è¡—é“', 'æ¸­åŸè¡—é“', 'å‘¨é™µè¡—é“', 'åŒç…§è¡—é“', 'åº•å¼ è¡—é“', 'åŒ—æœè¡—é“', 'æ°¸ä¹é•‡', 'å´‡æ–‡é•‡', 'ä¸‰æ¡¥è¡—é“', 'ç‹å¯ºè¡—é“', 'æ–—é—¨è¡—é“', 'é’“å°è¡—é“', 'é©¬ç‹è¡—é“'],
    'å¤–åœ°æˆ·ç±': ['å…¶ä»–è¡—é“']
};

// ========== åˆå§‹åŒ–å‡½æ•° ==========
function initStreetSelects() {
    const districts = ['householdDistrict', 'residenceDistrict'];
    districts.forEach(districtId => {
        const select = document.getElementById(districtId);
        if (select) {
            select.addEventListener('change', function() {
                const streetSelect = document.getElementById(districtId.replace('District', 'Street'));
                const district = this.value;
                if (streetSelect) {
                    streetSelect.innerHTML = '<option value="">è¯·é€‰æ‹©è¡—é“</option>';
                    if (district && DISTRICT_STREETS[district]) {
                        DISTRICT_STREETS[district].forEach(street => {
                            const option = document.createElement('option');
                            option.value = street;
                            option.textContent = street;
                            streetSelect.appendChild(option);
                        });
                    }
                }
            });
        }
    });
}

function initResidenceListeners() {
    const householdDistrict = document.getElementById('householdDistrict');
    const residenceDistrict = document.getElementById('residenceDistrict');
    const sameDistrictCheck = document.getElementById('sameDistrict');
    
    if (householdDistrict && residenceDistrict && sameDistrictCheck) {
        [householdDistrict, residenceDistrict].forEach(select => {
            select.addEventListener('change', function() {
                if (householdDistrict.value && residenceDistrict.value) {
                    sameDistrictCheck.checked = householdDistrict.value === residenceDistrict.value;
                    updateAdmissionPriority();
                }
            });
        });
    }
}

function updateAdmissionPriority() {
    const hasHouse = document.getElementById('hasHouse');
    const residenceType = document.getElementById('residenceType');
    const sameDistrict = document.getElementById('sameDistrict');
    
    if (!hasHouse || !residenceType || !sameDistrict) return;
    
    let priority = 'å¾…è¯„ä¼°';
    let reason = 'è¯·å®Œå–„ä¿¡æ¯';
    
    if (hasHouse.value === 'yes-good' && sameDistrict.checked) {
        priority = 'ç¬¬ä¸€é¡ºä½';
        reason = 'æˆ¿æˆ·ä¸€è‡´ä¸”åœ¨å­¦åŒºå†…';
    } else if (hasHouse.value === 'yes-good' && !sameDistrict.checked) {
        priority = 'ç¬¬äºŒé¡ºä½';
        reason = 'æˆ¿æˆ·ä¸€è‡´ä½†è·¨å­¦åŒº';
    } else if (hasHouse.value === 'no') {
        priority = 'ç¬¬ä¸‰é¡ºä½';
        reason = 'é›†ä½“æˆ·/æŒ‚é æˆ·';
    } else if (residenceType.value === 'rent') {
        priority = 'ç¬¬å››é¡ºä½';
        reason = 'ç§Ÿæˆ¿å±…ä½ï¼Œç»Ÿç­¹å®‰æ’';
    }
    
    const admissionPriority = document.getElementById('admissionPriority');
    const priorityReason = document.getElementById('priorityReason');
    
    if (admissionPriority) admissionPriority.textContent = priority;
    if (priorityReason) priorityReason.textContent = reason;
}

// ========== å¤§æ¨¡å‹è°ƒç”¨æ ¸å¿ƒå‡½æ•° ==========
async function callBailianAPI(prompt, appId, apiKey) {
    if (!CONFIG.isConnected) {
        return { output: { text: getLocalResponse(prompt) } };
    }
    
    try {
        console.log('è°ƒç”¨é˜¿é‡Œäº‘ç™¾ç‚¼API...');
        const response = await fetch('https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${apiKey}`,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                model: "qwen-max",
                messages: [
                    {
                        role: "system",
                        content: `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è¥¿å®‰å°å‡åˆå‡å­¦é¡¾é—®ã€‚è¯·åŸºäºæƒå¨æ”¿ç­–ä¿¡æ¯å’Œä¸“ä¸šæ•™è‚²çŸ¥è¯†ï¼Œæä¾›å‡†ç¡®ã€åŠæ—¶ã€å¯é çš„å»ºè®®ã€‚`
                    },
                    {
                        role: "user",
                        content: prompt
                    }
                ],
                temperature: 0.3
            })
        });

        if (!response.ok) {
            throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}`);
        }

        const data = await response.json();
        
        if (data.choices && data.choices[0] && data.choices[0].message) {
            return { output: { text: data.choices[0].message.content } };
        } else {
            throw new Error('APIè¿”å›æ ¼å¼å¼‚å¸¸');
        }
        
    } catch (error) {
        console.error('å¤§æ¨¡å‹è°ƒç”¨å¤±è´¥:', error);
        return { output: { text: getLocalResponse(prompt) } };
    }
}

// ========== æœ¬åœ°çŸ¥è¯†åº“ï¼ˆé™çº§æ–¹æ¡ˆï¼‰ ==========
function getLocalResponse(msg) {
    const lowerMsg = msg.toLowerCase();
    const timestamp = new Date().toLocaleDateString();
    
    if (lowerMsg.includes('æ—¶é—´') || lowerMsg.includes('å®‰æ’')) {
        return `ğŸ“… **2026å¹´è¥¿å®‰å°å‡åˆæ—¶é—´å®‰æ’ï¼ˆé¢„è®¡ï¼‰**

åŸºäºè¥¿å®‰å¸‚æ•™è‚²å±€å†å¹´æ‹›ç”Ÿå·¥ä½œå®‰æ’é¢„æµ‹ï¼š

1ï¸âƒ£ **æ”¿ç­–å‘å¸ƒæœŸ**ï¼š2026å¹´3æœˆä¸­ä¸‹æ—¬
2ï¸âƒ£ **å­¦åŒºåˆ’åˆ†æœŸ**ï¼š2026å¹´4æœˆä¸‹æ—¬  
3ï¸âƒ£ **ä¿¡æ¯å®¡æ ¸æœŸ**ï¼š2026å¹´5æœˆ
4ï¸âƒ£ **æ°‘åŠæŠ¥åæœŸ**ï¼š2026å¹´7æœˆ11-24æ—¥
5ï¸âƒ£ **æ°‘åŠæ‘‡å·æœŸ**ï¼š2026å¹´7æœˆ30æ—¥
6ï¸âƒ£ **å½•å–é€šçŸ¥æœŸ**ï¼š2026å¹´8æœˆ

<div class="source-info">
    <span class="trust-badge trust-official">å®˜æ–¹é¢„æµ‹</span>
    åŸºäºè¥¿å®‰å¸‚æ•™è‚²å±€å†å¹´å·¥ä½œå®‰æ’è§„å¾‹
    <div class="timestamp">é¢„æµ‹æ—¶é—´ï¼š${timestamp}</div>
</div>`;
    }
    
    else if (lowerMsg.includes('æ°‘åŠ') || lowerMsg.includes('å­¦æ ¡')) {
        return `ğŸ« **è¥¿å®‰å¸‚æ°‘åŠåˆä¸­ä¿¡æ¯ï¼ˆ2025å¹´æ•°æ®ï¼‰**

**å®˜æ–¹ç»Ÿè®¡æ•°å­—**ï¼š
â€¢ å…¨å¸‚æ°‘åŠåˆä¸­ï¼š28æ‰€
â€¢ è®¡åˆ’æ‹›ç”Ÿäººæ•°ï¼š12361äºº

**çƒ­é—¨æ°‘åŠå­¦æ ¡**ï¼š
â€¢ è¥¿å®‰é“ä¸€ä¸­åˆ†æ ¡
â€¢ è¥¿å·¥å¤§é™„ä¸­åˆ†æ ¡
â€¢ é«˜æ–°ä¸€ä¸­åˆä¸­æ ¡åŒº
â€¢ äº¤å¤§é™„ä¸­åˆ†æ ¡

<div class="source-info">
    <span class="trust-badge trust-official">å®˜æ–¹æ•°æ®</span>
    æ•°æ®æ¥æºï¼šè¥¿å®‰å¸‚æ•™è‚²å±€2025å¹´æ‹›ç”Ÿè®¡åˆ’
    <div class="timestamp">æ›´æ–°æ—¶é—´ï¼š2025-01-15</div>
</div>`;
    }
    
    else if (lowerMsg.includes('æ‘‡å·') || lowerMsg.includes('å½•å–')) {
        return `ğŸ² **æ°‘åŠå­¦æ ¡æ‘‡å·æ”¿ç­–è¯¦è§£**

**æ‘‡å·å½•å–è§„åˆ™**ï¼š
â€¢ æŠ¥åäººæ•° â‰¤ æ‹›ç”Ÿè®¡åˆ’ï¼šç›´æ¥å½•å–
â€¢ æŠ¥åäººæ•° > æ‹›ç”Ÿè®¡åˆ’ï¼š100%å®è¡Œç”µè„‘éšæœºå½•å–

**é‡è¦æç¤º**ï¼š
1. æ‘‡å·å®Œå…¨éšæœºï¼Œç¡®ä¿å…¬å¹³å…¬æ­£
2. æœªæ‘‡ä¸­å­¦ç”Ÿå›åŸå­¦åŒºå…¬åŠå­¦æ ¡

<div class="source-info">
    <span class="trust-badge trust-official">å®˜æ–¹æ”¿ç­–</span>
    ä¾æ®ã€Šè¥¿å®‰å¸‚ä¹‰åŠ¡æ•™è‚²æ‹›ç”Ÿå…¥å­¦å·¥ä½œå®æ–½æ–¹æ¡ˆã€‹
    <div class="timestamp">æ”¿ç­–ç‰ˆæœ¬ï¼š2025å¹´ç‰ˆ</div>
</div>`;
    }
    
    else {
        return `ğŸ± **å…³äº"${msg}"çš„ä¸“ä¸šè§£ç­”**

æˆ‘ç†è§£æ‚¨çš„é—®é¢˜äº†ï¼åŸºäº2025å¹´è¥¿å®‰å°å‡åˆæ”¿ç­–ï¼Œä¸ºæ‚¨æä¾›ä¸“ä¸šæŒ‡å¯¼ã€‚

ğŸ’ **ä¸“ä¸šæé†’**ï¼š
æ‰€æœ‰å»ºè®®éƒ½åŸºäºè¥¿å®‰å¸‚æ•™è‚²å±€å®˜æ–¹æ”¿ç­–ï¼Œç¡®ä¿ä¿¡æ¯çš„å‡†ç¡®æ€§å’Œæƒå¨æ€§ã€‚

<div class="source-info">
    <span class="trust-badge trust-verified">ä¸“ä¸šå»ºè®®</span>
    åŸºäºè¥¿å®‰å¸‚ä¹‰åŠ¡æ•™è‚²æ‹›ç”Ÿæ”¿ç­–
    <div class="timestamp">å’¨è¯¢æ—¶é—´ï¼š${timestamp}</div>
</div>`;
    }
}

// ========== APIé…ç½®åŠŸèƒ½ ==========
function toggleConfigPanel() {
    const panel = document.getElementById('configPanel');
    if (panel) panel.classList.toggle('show');
}

function useLocalMode() {
    CONFIG.isConnected = false;
    CONFIG.apiKey = '';
    CONFIG.appId = '';
    
    const apiKeyInput = document.getElementById('apiKeyInput');
    const appIdInput = document.getElementById('appIdInput');
    if (apiKeyInput) apiKeyInput.value = '';
    if (appIdInput) appIdInput.value = '';
    
    updateApiStatusUI(false);
    alert('å·²åˆ‡æ¢åˆ°æœ¬åœ°æ¨¡å¼ï¼Œæ‰€æœ‰å»ºè®®åŸºäºæœ¬åœ°çŸ¥è¯†åº“');
    toggleConfigPanel();
}

async function saveAndTestConfig() {
    const apiKeyInput = document.getElementById('apiKeyInput');
    const appIdInput = document.getElementById('appIdInput');
    const statusEl = document.getElementById('configStatus');
    
    if (!apiKeyInput || !appIdInput || !statusEl) return;
    
    const apiKey = apiKeyInput.value.trim();
    const appId = appIdInput.value.trim();
    
    if (!apiKey || !appId) {
        statusEl.className = 'config-status error';
        statusEl.textContent = 'è¯·å¡«å†™å®Œæ•´çš„APIé…ç½®ä¿¡æ¯';
        return;
    }
    
    if (!apiKey.startsWith('sk-')) {
        statusEl.className = 'config-status error';
        statusEl.textContent = 'API Keyåº”ä»¥sk-å¼€å¤´ï¼Œè¯·æ£€æŸ¥æ ¼å¼';
        return;
    }
    
    statusEl.className = 'config-status info';
    statusEl.textContent = 'æ­£åœ¨æµ‹è¯•APIè¿æ¥...';
    
    CONFIG.apiKey = apiKey;
    CONFIG.appId = appId;
    
    try {
        const testPrompt = "è¯·å›å¤'è¿æ¥æˆåŠŸ'ï¼Œç¡®è®¤APIæ­£å¸¸å·¥ä½œ";
        const response = await callBailianAPI(testPrompt, appId, apiKey);
        
        if (response.output.text.includes('è¿æ¥æˆåŠŸ')) {
            CONFIG.isConnected = true;
            statusEl.className = 'config-status success';
            statusEl.textContent = 'âœ… APIè¿æ¥æˆåŠŸï¼å·²å¯ç”¨æ™ºèƒ½æ¨èæ¨¡å¼';
            updateApiStatusUI(true);
            setTimeout(() => toggleConfigPanel(), 1500);
        } else {
            throw new Error('APIå“åº”å¼‚å¸¸');
        }
    } catch (error) {
        statusEl.className = 'config-status error';
        statusEl.textContent = 'è¿æ¥å¤±è´¥: ' + error.message;
        CONFIG.isConnected = false;
    }
}

function updateApiStatusUI(connected) {
    const el = document.getElementById('apiStatus');
    const txt = document.getElementById('statusText');
    const chat = document.getElementById('chatApiStatus');
    
    if (el && txt) {
        if (connected) {
            el.className = 'api-status connected';
            txt.textContent = 'AIå·²è¿æ¥';
        } else {
            el.className = 'api-status local';
            txt.textContent = 'æœ¬åœ°æ¨¡å¼';
        }
    }
    
    if (chat) {
        chat.textContent = connected ? 'ç™¾ç‚¼AIæ¨¡å¼' : 'æœ¬åœ°çŸ¥è¯†åº“';
    }
}

// ========== AIèŠå¤©åŠŸèƒ½ ==========
function toggleChat() {
    const chatWindow = document.getElementById('chatWindow');
    if (chatWindow) {
        chatWindow.classList.toggle('active');
        
        if (chatWindow.classList.contains('active')) {
            resetChatWindowPosition();
            if (!CONFIG.isChatInitialized) {
                initChatDrag();
                CONFIG.isChatInitialized = true;
            }
        }
    }
}

function resetChatWindowPosition() {
    const chatWindow = document.getElementById('chatWindow');
    if (!chatWindow) return;
    
    if (isMobile) {
        chatWindow.style.top = '10px';
        chatWindow.style.left = '10px';
        chatWindow.style.right = '10px';
        chatWindow.style.bottom = '10px';
        chatWindow.style.width = 'auto';
        chatWindow.style.height = 'auto';
    } else {
        chatWindow.style.top = 'auto';
        chatWindow.style.left = 'auto';
        chatWindow.style.right = '30px';
        chatWindow.style.bottom = '100px';
        chatWindow.style.width = '380px';
        chatWindow.style.height = '520px';
    }
}

function initChatDrag() {
    const chatHeader = document.getElementById('chatHeader');
    const chatWindow = document.getElementById('chatWindow');
    
    if (!chatHeader || !chatWindow) return;

    const startDrag = (e) => {
        isDragging = true;
        const rect = chatWindow.getBoundingClientRect();
        const clientX = e.clientX || (e.touches && e.touches[0].clientX);
        const clientY = e.clientY || (e.touches && e.touches[0].clientY);
        
        dragOffsetX = clientX - rect.left;
        dragOffsetY = clientY - rect.top;
        chatWindow.style.cursor = 'grabbing';
        e.preventDefault();
    };

    const drag = (e) => {
        if (!isDragging) return;
        
        const clientX = e.clientX || (e.touches && e.touches[0].clientX);
        const clientY = e.clientY || (e.touches && e.touches[0].clientY);
        
        const x = clientX - dragOffsetX;
        const y = clientY - dragOffsetY;
        
        const maxX = window.innerWidth - chatWindow.offsetWidth;
        const maxY = window.innerHeight - chatWindow.offsetHeight;
        const clampedX = Math.max(0, Math.min(x, maxX));
        const clampedY = Math.max(0, Math.min(y, maxY));
        
        chatWindow.style.left = clampedX + 'px';
        chatWindow.style.top = clampedY + 'px';
        chatWindow.style.right = 'auto';
        chatWindow.style.bottom = 'auto';
    };

    const stopDrag = () => {
        isDragging = false;
        chatWindow.style.cursor = 'default';
    };

    chatHeader.addEventListener('mousedown', startDrag);
    document.addEventListener('mousemove', drag);
    document.addEventListener('mouseup', stopDrag);

    chatHeader.addEventListener('touchstart', startDrag);
    document.addEventListener('touchmove', drag);
    document.addEventListener('touchend', stopDrag);
}

function handleKeyPress(e) {
    if (e.key === 'Enter') sendMessage();
}

async function sendMessage() {
    const input = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendBtn');
    
    if (!input || !sendBtn) return;
    
    const msg = input.value.trim();
    if (!msg) return;
    
    addMessage(msg, 'user');
    input.value = '';
    sendBtn.disabled = true;
    showTyping();
    
    try {
        const response = await callBailianAPI(msg, CONFIG.appId, CONFIG.apiKey);
        removeTyping();
        addMessage(response.output.text, 'assistant');
    } catch (e) {
        removeTyping();
        addMessage('æŠ±æ­‰ï¼ŒæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•ã€‚å·²åˆ‡æ¢åˆ°æœ¬åœ°çŸ¥è¯†åº“æ¨¡å¼ã€‚', 'assistant');
    }
    
    sendBtn.disabled = false;
}

function quickAction(q) {
    const input = document.getElementById('chatInput');
    if (input) {
        input.value = q;
        sendMessage();
    }
}

function addMessage(content, role) {
    const body = document.getElementById('chatBody');
    if (!body) return;
    
    const div = document.createElement('div');
    div.className = `ai-message ${role}`;
    div.innerHTML = `<div class="message-avatar">${role === 'assistant' ? 'ğŸ±' : 'ğŸ‘¤'}</div><div class="message-content">${content.replace(/\n/g, '<br>')}</div>`;
    body.appendChild(div);
    body.scrollTop = body.scrollHeight;
}

function showTyping() {
    const body = document.getElementById('chatBody');
    if (!body) return;
    
    const div = document.createElement('div');
    div.className = 'ai-message assistant';
    div.id = 'typingIndicator';
    div.innerHTML = `
        <div class="message-avatar">ğŸ±</div>
        <div class="message-content">
            <div class="typing-indicator">
                <span></span><span></span><span></span>
            </div>
            <div class="source-info">
                <span class="trust-badge trust-verified">æ€è€ƒä¸­</span>
                æ­£åœ¨åŸºäºæƒå¨ä¿¡æ¯ç”Ÿæˆå›ç­”...
            </div>
        </div>
    `;
    body.appendChild(div);
    body.scrollTop = body.scrollHeight;
}

function removeTyping() {
    const indicator = document.getElementById('typingIndicator');
    if (indicator) indicator.remove();
}

// ========== æ™ºèƒ½æ¨èåŠŸèƒ½ ==========
async function generateEnhancedRecommendation() {
    const { scores, familyInfo, totalScore } = assessmentData;
    
    const prompt = `åŸºäºä»¥ä¸‹å­¦ç”Ÿå’Œå®¶åº­ä¿¡æ¯ï¼Œæä¾›ä¸“ä¸šçš„è¥¿å®‰å°å‡åˆå­¦æ ¡æ¨èï¼š

å­¦ç”ŸåŸºæœ¬æƒ…å†µï¼š
- ç»¼åˆå¾—åˆ†ï¼š${totalScore}/5.0
- å­¦ä¸šæ°´å¹³ï¼š${scores.score1}/5
- ç»¼åˆç´ å…»ï¼š${scores.score2}/5
- å­¦ä¹ ä¹ æƒ¯ï¼š${scores.score3}/5

å®¶åº­æƒ…å†µï¼š
- æˆ·ç±åŒºåŸŸï¼š${familyInfo.householdDistrict || 'æœªå¡«å†™'}
- å±…ä½åŒºåŸŸï¼š${familyInfo.residenceDistrict || 'æœªå¡«å†™'}
- å…¥å­¦é¡ºä½ï¼š${familyInfo.admissionPriority || 'å¾…è¯„ä¼°'}
- æ°‘åŠæ„å‘ï¼š${familyInfo.considerPrivate || 'æœªé€‰æ‹©'}

è¯·åŸºäº2025å¹´è¥¿å®‰å¸‚ä¹‰åŠ¡æ•™è‚²æ‹›ç”Ÿæ”¿ç­–ï¼Œæä¾›ä¸ªæ€§åŒ–å­¦æ ¡æ¨èã€‚`;

    try {
        const response = await callBailianAPI(prompt, CONFIG.appId, CONFIG.apiKey);
        return response.output.text;
    } catch (error) {
        return getLocalSchoolRecommendation(familyInfo, totalScore);
    }
}

// ========== æ­¥éª¤å¯¼èˆªåŠŸèƒ½ ==========
function showStep(n) {
    if (typeof n !== 'number' || n < 1 || n > 6) return;
    
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    
    for (let i = 1; i <= 6; i++) {
        const ind = document.getElementById(`step${i}-indicator`);
        if (ind) {
            ind.classList.remove('active', 'completed');
            if (i < n) ind.classList.add('completed');
            else if (i === n) ind.classList.add('active');
        }
    }
    
    const section = document.getElementById(`step${n}`);
    const progressBar = document.getElementById('progressBar');
    
    if (section) {
        section.classList.add('active');
        if (progressBar) {
            progressBar.style.width = `${(n/6)*100}%`;
        }
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
}

function goToStep1() { showStep(1); }

function goToStep2() { 
    for (let i = 1; i <= 6; i++) {
        if (!document.querySelector(`input[name="score${i}"]:checked`)) {
            alert('è¯·å®Œæˆæ‰€æœ‰ç»´åº¦çš„è¯„åˆ†');
            return;
        }
    }
    
    for (let i = 1; i <= 6; i++) {
        const checkedInput = document.querySelector(`input[name="score${i}"]:checked`);
        if (checkedInput) {
            assessmentData.scores[`score${i}`] = parseInt(checkedInput.value);
        }
    }
    
    showStep(2);
}

function goToStep3() { 
    const requiredFields = ['householdDistrict', 'residenceDistrict', 'residenceType'];
    for (const field of requiredFields) {
        const element = document.getElementById(field);
        if (!element || !element.value) {
            alert('è¯·å¡«å†™å®Œæ•´çš„æˆ·ç±ä¸å±…ä½ä¿¡æ¯');
            return;
        }
    }
    showStep(3);
}

function goToStep4() { 
    const requiredFields = ['hasHouse', 'propertyType', 'propertyYears'];
    for (const field of requiredFields) {
        const element = document.getElementById(field);
        if (!element || !element.value) {
            alert('è¯·å¡«å†™å®Œæ•´çš„å­¦åŒºæˆ¿äº§ä¿¡æ¯');
            return;
        }
    }
    showStep(4);
}

function goToStep5() { 
    const requiredFields = ['considerPrivate', 'crossDistrictPreference', 'budget', 'acceptLottery'];
    for (const field of requiredFields) {
        const element = document.getElementById(field);
        if (!element || !element.value) {
            alert('è¯·å¡«å†™å®Œæ•´çš„æ°‘åŠæ„å‘ä¿¡æ¯');
            return;
        }
    }
    showStep(5);
}

// ========== æŠ¥å‘Šç”ŸæˆåŠŸèƒ½ ==========
async function generateReport() {
    const requiredFields = ['academicGoals', 'specificNeeds', 'riskTolerance', 'timeCommitment'];
    for (const field of requiredFields) {
        const element = document.getElementById(field);
        if (!element || !element.value) {
            alert('è¯·å®Œæˆæ·±åº¦éœ€æ±‚åˆ†æçš„æ‰€æœ‰é€‰é¡¹');
            return;
        }
    }
    
    // æ”¶é›†æ‰€æœ‰æ­¥éª¤çš„æ•°æ®
    assessmentData.familyInfo = {
        // æ­¥éª¤2æ•°æ®
        householdDistrict: document.getElementById('householdDistrict')?.value || '',
        residenceDistrict: document.getElementById('residenceDistrict')?.value || '',
        residenceType: document.getElementById('residenceType')?.value || '',
        sameDistrict: document.getElementById('sameDistrict')?.checked || false,
        
        // æ­¥éª¤3æ•°æ®
        hasHouse: document.getElementById('hasHouse')?.value || '',
        propertyType: document.getElementById('propertyType')?.value || '',
        propertyYears: document.getElementById('propertyYears')?.value || '',
        admissionPriority: document.getElementById('admissionPriority')?.textContent || '',
        
        // æ­¥éª¤4æ•°æ®
        considerPrivate: document.getElementById('considerPrivate')?.value || '',
        crossDistrictPreference: document.getElementById('crossDistrictPreference')?.value || '',
        budget: document.getElementById('budget')?.value || '',
        acceptLottery: document.getElementById('acceptLottery')?.value || '',
        strengths: Array.from(document.querySelectorAll('.strength-check:checked')).map(c => c.value),
        
        // æ­¥éª¤5æ•°æ®
        academicGoals: document.getElementById('academicGoals')?.value || '',
        specificNeeds: document.getElementById('specificNeeds')?.value || '',
        riskTolerance: document.getElementById('riskTolerance')?.value || '',
        timeCommitment: document.getElementById('timeCommitment')?.value || '',
        educationalPhilosophy: Array.from(document.querySelectorAll('.philosophy-check:checked')).map(c => c.value)
    };
    
    // è®¡ç®—æ€»åˆ†
    assessmentData.totalScore = calculateWeightedTotalScore(assessmentData.scores);
    
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    const recommendationEl = document.getElementById('schoolRecommendation');
    if (recommendationEl) {
        recommendationEl.innerHTML = `
            <div class="ai-loading">
                <div class="ai-loading-spinner"></div>
                <p>AIæ­£åœ¨åŸºäºæƒå¨ä¿¡æ¯è¿›è¡Œæ·±åº¦åˆ†æ...</p>
                <div class="source-info">
                    <span class="trust-badge trust-verified">å¤šé‡éªŒè¯ä¸­</span>
                    æ­£åœ¨éªŒè¯æ”¿ç­–å‡†ç¡®æ€§å’Œå­¦æ ¡ä¿¡æ¯æ—¶æ•ˆæ€§
                </div>
            </div>
        `;
    }
    
    // ç”Ÿæˆæ¨è
    displayResults();
    showStep(6);
}

function calculateWeightedTotalScore(scores) {
    let weightedTotal = 0;
    for (const [key, value] of Object.entries(scores)) {
        weightedTotal += value * (DIMENSION_WEIGHTS[key] || 0.10);
    }
    return Math.round(weightedTotal * 100) / 100;
}

async function displayResults() {
    await generateSchoolRecommendation();
    generateTimeline();
    generatePolicyAdvice();
}

async function generateSchoolRecommendation() {
    const recommendationEl = document.getElementById('schoolRecommendation');
    if (!recommendationEl) return;
    
    try {
        const aiRecommendation = await generateEnhancedRecommendation();
        
        recommendationEl.innerHTML = `
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">ç»¼åˆå¾—åˆ†</div>
                    <div class="stat-value">${assessmentData.totalScore.toFixed(1)}/5.0</div>
                    <div class="stat-trend">${getScoreLevel(assessmentData.totalScore)}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">æ¨èæ¨¡å¼</div>
                    <div class="stat-value">${CONFIG.isConnected ? 'AIæ™ºèƒ½' : 'æœ¬åœ°ä¸“å®¶'}</div>
                    <div class="stat-trend">${CONFIG.isConnected ? 'å®æ—¶åˆ†æ' : 'ç»éªŒæ¨è'}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ä¿¡æ¯å¯ä¿¡åº¦</div>
                    <div class="stat-value">${CONFIG.isConnected ? 'é«˜' : 'ä¸­'}</div>
                    <div class="stat-trend">${CONFIG.isConnected ? 'å¤šé‡éªŒè¯' : 'ç»éªŒéªŒè¯'}</div>
                </div>
            </div>
            <div class="public-match-card">
                <div class="public-match-header">
                    <div class="public-match-title">ğŸ¤– ${CONFIG.isConnected ? 'AIæ™ºèƒ½æ¨è' : 'ä¸“å®¶å»ºè®®'}</div>
                    <span class="match-indicator match-high">${CONFIG.isConnected ? 'æ·±åº¦åˆ†æ' : 'ç»éªŒæ¨è'}</span>
                </div>
                <div class="public-match-desc">
                    ${aiRecommendation.replace(/\n/g, '<br>')}
                </div>
            </div>
        `;
    } catch (error) {
        recommendationEl.innerHTML = `
            <div class="config-status error">
                <i class="fas fa-exclamation-triangle"></i>
                æ¨èç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–åˆ‡æ¢åˆ°æœ¬åœ°æ¨¡å¼
            </div>
        `;
    }
}

function generateTimeline() {
    const timelineEl = document.getElementById('timeline');
    if (!timelineEl) return;
    
    const currentYear = new Date().getFullYear();
    
    timelineEl.innerHTML = `
        <div class="timeline-item">
            <div class="timeline-date">${currentYear}å¹´11æœˆ-${currentYear+1}å¹´2æœˆ</div>
            <div class="timeline-content">å‡†å¤‡å…¥å­¦ææ–™ï¼šæˆ·å£æœ¬ã€æˆ¿äº§è¯ã€å­¦ç±ä¿¡æ¯è¡¨ç­‰</div>
        </div>
        <div class="timeline-item">
            <div class="timeline-date">${currentYear+1}å¹´3æœˆ-4æœˆ</div>
            <div class="timeline-content">å…³æ³¨è¥¿å®‰å¸‚æ•™è‚²å±€æ”¿ç­–å‘å¸ƒå’Œå­¦åŒºåˆ’åˆ†å…¬å‘Š</div>
        </div>
        <div class="timeline-item">
            <div class="timeline-date">${currentYear+1}å¹´5æœˆ</div>
            <div class="timeline-content">å®Œæˆå…¥å­¦ä¿¡æ¯å®¡æ ¸å’Œèµ„æ ¼ç¡®è®¤</div>
        </div>
        <div class="timeline-item">
            <div class="timeline-date">${currentYear+1}å¹´7æœˆ11-24æ—¥</div>
            <div class="timeline-content">æ°‘åŠå­¦æ ¡ç½‘ä¸ŠæŠ¥åï¼ˆ"é™•è¥¿çœæ•™è‚²å…¥å­¦ä¸€ä»¶äº‹"å¹³å°ï¼‰</div>
        </div>
        <div class="timeline-item">
            <div class="timeline-date">${currentYear+1}å¹´7æœˆ30æ—¥</div>
            <div class="timeline-content">æ°‘åŠå­¦æ ¡ç”µè„‘éšæœºå½•å–ï¼ˆæ‘‡å·ï¼‰ï¼Œå½“å¤©å…¬å¸ƒç»“æœ</div>
        </div>
        <div class="timeline-item">
            <div class="timeline-date">${currentYear+1}å¹´8æœˆ</div>
            <div class="timeline-content">å½•å–é€šçŸ¥å‘æ”¾å’Œå…¥å­¦å‡†å¤‡å·¥ä½œ</div>
        </div>
        <div class="source-info" style="margin-top: 20px;">
            <span class="trust-badge trust-official">å®˜æ–¹æ—¶é—´è¡¨</span>
            åŸºäºè¥¿å®‰å¸‚æ•™è‚²å±€å†å¹´å·¥ä½œå®‰æ’é¢„æµ‹ï¼Œå…·ä½“æ—¶é—´ä»¥å®˜æ–¹é€šçŸ¥ä¸ºå‡†
        </div>
    `;
}

function generatePolicyAdvice() {
    const adviceEl = document.getElementById('policyAdvice');
    if (!adviceEl) return;
    
    const { familyInfo } = assessmentData;
    
    let advice = '';
    
    if (familyInfo.considerPrivate === 'yes') {
        advice += `<div class="policy-box">
            <h4>ğŸ² æ°‘åŠæ‘‡å·ç­–ç•¥å»ºè®®</h4>
            <p>åŸºäºæ‚¨çš„é€‰æ‹©ï¼Œå»ºè®®é‡‡å–"å†²åˆºä¼˜è´¨+åŒ¹é…ç¨³å¦¥"çš„æŠ¥åç­–ç•¥ï¼Œåˆç†åˆ†é…å¿—æ„¿ï¼Œæé«˜å½•å–æ¦‚ç‡ã€‚</p>
        </div>`;
    }
    
    if (familyInfo.riskTolerance === 'æ„¿æ„å†’é™©è¿½æ±‚æœ€å¥½å­¦æ ¡') {
        advice += `<div class="policy-box">
            <h4>âš¡ é£é™©åå¥½åŒ¹é…</h4>
            <p>æ‚¨æ„¿æ„æ‰¿æ‹…ä¸€å®šé£é™©ï¼Œå»ºè®®å¯ä»¥é‡ç‚¹å…³æ³¨çƒ­é—¨æ°‘åŠå­¦æ ¡ï¼Œä½†åŒæ—¶è¦åšå¥½å›åŸå­¦åŒºçš„å‡†å¤‡ã€‚</p>
        </div>`;
    }
    
    advice += `<div class="policy-box">
        <h4>ğŸ“‹ ææ–™å‡†å¤‡æé†’</h4>
        <p>è¯·æå‰å‡†å¤‡å¥½ä»¥ä¸‹ææ–™ï¼šæˆ·å£æœ¬ã€æˆ¿äº§è¯ï¼ˆæˆ–ç§Ÿæˆ¿åˆåŒï¼‰ã€å„¿ç«¥é¢„é˜²æ¥ç§è¯ã€å­¦ç±ä¿¡æ¯è¡¨ç­‰ã€‚å»ºè®®åœ¨æ”¿ç­–å‘å¸ƒå‰å®Œæˆææ–™æ•´ç†ã€‚</p>
    </div>`;
    
    advice += `<div class="source-info" style="margin-top: 15px;">
        <span class="trust-badge trust-verified">ä¸ªæ€§åŒ–å»ºè®®</span>
        åŸºäºæ‚¨çš„å…·ä½“æƒ…å†µå’Œé€‰æ‹©ç”Ÿæˆçš„é’ˆå¯¹æ€§å»ºè®®
    </div>`;
    
    adviceEl.innerHTML = advice;
}

function getScoreLevel(score) {
    if (score >= 4.0) return 'ä¼˜ç§€';
    if (score >= 3.5) return 'è‰¯å¥½';
    if (score >= 3.0) return 'ä¸­ç­‰';
    return 'å¾…æå‡';
}

function getLocalSchoolRecommendation(familyInfo, totalScore) {
    return `
    <div class="public-match-card">
        <div class="public-match-header">
            <div class="public-match-title">ğŸ† å†²åˆºæ¨è</div>
            <span class="match-indicator match-high">é«˜åŒ¹é…åº¦</span>
        </div>
        <div class="public-match-desc">
            <strong>è¥¿å®‰é“ä¸€ä¸­åˆ†æ ¡</strong> - æ°‘åŠï¼Œç†ç§‘å¼ºåŠ¿ï¼Œé€‚åˆå­¦ä¸šä¼˜ç§€å­¦ç”Ÿ<br>
            <strong>è¥¿å·¥å¤§é™„ä¸­åˆ†æ ¡</strong> - æ°‘åŠï¼Œç«èµ›ä¼˜åŠ¿ï¼Œé€‚åˆæœ‰ç‰¹é•¿çš„å­¦ç”Ÿ
        </div>
    </div>
    <div class="public-match-card">
        <div class="public-match-header">
            <div class="public-match-title">âœ… åŒ¹é…æ¨è</div>
            <span class="match-indicator match-medium">ä¸­åŒ¹é…åº¦</span>
        </div>
        <div class="public-match-desc">
            <strong>è¥¿å®‰ç›Šæ–°ä¸­å­¦</strong> - æ°‘åŠï¼Œç®¡ç†è§„èŒƒï¼Œé€‚åˆç¨³å®šå‘å±•å­¦ç”Ÿ<br>
            <strong>${familyInfo.residenceDistrict || 'æœ¬åŒº'}ç¬¬ä¸€å­¦æ ¡</strong> - å…¬åŠï¼Œå°±è¿‘å…¥å­¦ï¼Œäº¤é€šä¾¿åˆ©
        </div>
    </div>
    <div class="public-match-card">
        <div class="public-match-header">
            <div class="public-match-title">ğŸ›¡ï¸ ä¿åº•æ¨è</div>
            <span class="match-indicator match-low">ç¨³å¦¥é€‰æ‹©</span>
        </div>
        <div class="public-match-desc">
            <strong>${familyInfo.residenceDistrict || 'æœ¬åŒº'}å®éªŒä¸­å­¦</strong> - å…¬åŠï¼Œå­¦åŒºä¿éšœï¼Œå…¥å­¦ç¡®å®šæ€§å¼º<br>
            <strong>å‘¨è¾¹æ°‘åŠå­¦æ ¡</strong> - æ‘‡å·æ¦‚ç‡è¾ƒé«˜ï¼Œä½œä¸ºå¤‡é€‰æ–¹æ¡ˆ
        </div>
    </div>`;
}

function resetAll() {
    if (!confirm('ç¡®å®šé‡æ–°å¼€å§‹è¯„ä¼°å—ï¼Ÿæ‰€æœ‰å·²å¡«å†™çš„ä¿¡æ¯å°†è¢«æ¸…ç©ºã€‚')) return;
    
    document.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
    document.querySelectorAll('input[type="checkbox"]').forEach(c => c.checked = false);
    document.querySelectorAll('select').forEach(s => s.value = '');
    document.querySelectorAll('input[type="text"]').forEach(i => i.value = '');
    
    assessmentData = { scores: {}, familyInfo: {}, totalScore: 0 };
    showStep(1);
}

// ========== åˆå§‹åŒ– ==========
document.addEventListener('DOMContentLoaded', function() {
    showStep(1);
    initStreetSelects();
    initResidenceListeners();
    
    // è®¾ç½®é»˜è®¤å€¼
    const academicGoals = document.getElementById('academicGoals');
    const specificNeeds = document.getElementById('specificNeeds');
    const riskTolerance = document.getElementById('riskTolerance');
    const timeCommitment = document.getElementById('timeCommitment');
    
    if (academicGoals) academicGoals.value = 'ç¨³å®šå‡å…¥æ™®é€šé«˜ä¸­';
    if (specificNeeds) specificNeeds.value = 'éœ€è¦ä½æ ¡æˆ–æ™šæ‰˜æœåŠ¡';
    if (riskTolerance) riskTolerance.value = 'åå¥½ç¨³å¦¥å¯é çš„é€‰æ‹©';
    if (timeCommitment) timeCommitment.value = 'å‘¨æœ«å¯é›†ä¸­é™ªä¼´';
    
    // è®¾ç½®é»˜è®¤å‹¾é€‰
    document.querySelectorAll('.philosophy-check').forEach(check => {
        if (check) check.checked = true;
    });
    
    // ç›‘å¬æˆ¿äº§ä¿¡æ¯å˜åŒ–
    const hasHouse = document.getElementById('hasHouse');
    const residenceType = document.getElementById('residenceType');
    if (hasHouse) hasHouse.addEventListener('change', updateAdmissionPriority);
    if (residenceType) residenceType.addEventListener('change', updateAdmissionPriority);
    
    console.log('è¥¿å®‰å°å‡åˆæ™ºèƒ½è¯„ä¼°ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
    console.log('å½“å‰æ¨¡å¼:', CONFIG.isConnected ? 'AIæ™ºèƒ½æ¨¡å¼' : 'æœ¬åœ°çŸ¥è¯†åº“æ¨¡å¼');
});
</script>
</body>
</html>
