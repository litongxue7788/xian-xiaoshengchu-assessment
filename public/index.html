<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¥¿å®‰å°å‡åˆæ™ºèƒ½è¯„ä¼°ç³»ç»Ÿ 2025ç‰ˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft YaHei", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; padding: 20px; font-size: 15px; line-height: 1.6;
        }
        .container {
            max-width: 1200px; margin: 0 auto; background: white;
            border-radius: 24px; padding: 40px; box-shadow: 0 20px 80px rgba(0,0,0,0.3);
            position: relative;
        }
        .api-status {
            position: fixed; top: 20px; right: 20px; padding: 10px 15px;
            border-radius: 8px; font-size: 14px; font-weight: 600; z-index: 1001;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1); cursor: pointer;
            transition: all 0.3s ease;
        }
        .api-status.local { background: #ed8936; color: white; }
        .api-status.connected { background: #48bb78; color: white; }
        .api-status.error { background: #e53e3e; color: white; }
        .api-status:hover { transform: translateY(-2px); }
        .config-panel {
            position: fixed; top: 80px; right: 20px; background: white;
            border-radius: 12px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 1000; max-width: 400px; border: 2px solid #667eea; display: none;
        }
        .config-panel.show { display: block; }
        .config-title {
            font-size: 16px; font-weight: 600; color: #2d3748; margin-bottom: 15px;
            display: flex; align-items: center; gap: 8px;
        }
        .config-input {
            width: 100%; padding: 10px; border: 2px solid #e2e8f0;
            border-radius: 8px; margin-bottom: 10px; font-size: 14px;
        }
        .config-input:focus { border-color: #667eea; outline: none; }
        .config-btn {
            width: 100%; padding: 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white; border: none; border-radius: 8px; cursor: pointer;
            font-size: 14px; font-weight: 600; margin-bottom: 10px; transition: all 0.3s;
        }
        .config-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
        .config-btn.secondary { background: #6c757d; }
        .config-help { font-size: 12px; color: #718096; margin-top: 10px; line-height: 1.5; }
        .config-help a { color: #667eea; }
        .config-status { padding: 10px; border-radius: 8px; margin-bottom: 10px; font-size: 13px; }
        .config-status.success { background: #c6f6d5; color: #276749; }
        .config-status.error { background: #fed7d7; color: #c53030; }
        .config-status.info { background: #bee3f8; color: #2b6cb0; }
        .progress-bar {
            position: absolute; top: 0; left: 0; height: 6px;
            background: linear-gradient(90deg, #667eea, #764ba2); border-radius: 24px 24px 0 0;
            transition: width 0.5s ease; width: 25%;
        }
        .ai-assistant { position: fixed; bottom: 30px; right: 30px; z-index: 1000; }
        .ai-assistant-btn {
            width: 60px; height: 60px; background: linear-gradient(135deg, #ff6a00, #ff3d00);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: white; font-size: 32px; cursor: pointer; box-shadow: 0 8px 25px rgba(255, 106, 0, 0.4);
            transition: all 0.3s ease; border: none;
        }
        .ai-assistant-btn:hover { transform: scale(1.1); box-shadow: 0 12px 35px rgba(255, 106, 0, 0.6); }
        .ai-chat-window {
            position: absolute; bottom: 80px; right: 0; width: 380px; height: 520px;
            background: white; border-radius: 20px; box-shadow: 0 15px 50px rgba(0,0,0,0.2);
            display: none; flex-direction: column; overflow: hidden; border: 2px solid #e2e8f0;
        }
        .ai-chat-header {
            background: linear-gradient(135deg, #ff6a00 0%, #ff3d00 100%); color: white;
            padding: 20px; display: flex; align-items: center; gap: 12px;
        }
        .ai-chat-body { flex: 1; padding: 20px; overflow-y: auto; background: #fff9f5; }
        .ai-message { margin-bottom: 15px; display: flex; gap: 10px; }
        .ai-message.assistant { flex-direction: row; }
        .ai-message.user { flex-direction: row-reverse; }
        .message-avatar {
            width: 40px; height: 40px; border-radius: 50%; display: flex;
            align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0;
        }
        .ai-message.assistant .message-avatar {
            background: linear-gradient(135deg, #ff6a00 0%, #ff3d00 100%); color: white;
        }
        .ai-message.user .message-avatar { background: #e2e8f0; color: #4a5568; }
        .message-content {
            max-width: 70%; padding: 12px 16px; border-radius: 18px; font-size: 14px; line-height: 1.5;
        }
        .ai-message.assistant .message-content {
            background: white; border: 1px solid #e2e8f0; border-bottom-left-radius: 4px;
        }
        .ai-message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;
            border-bottom-right-radius: 4px;
        }
        .ai-chat-input { padding: 15px; border-top: 1px solid #e2e8f0; background: white; }
        .chat-input-group { display: flex; gap: 10px; }
        .chat-input {
            flex: 1; padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 25px;
            outline: none; font-size: 14px;
        }
        .chat-input:focus { border-color: #667eea; }
        .send-btn {
            width: 40px; height: 40px; border: none; border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        .send-btn:disabled { background: #ccc; cursor: not-allowed; }
        .quick-actions { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .quick-action-btn {
            padding: 6px 12px; background: #f7fafc; border: 1px solid #e2e8f0;
            border-radius: 15px; font-size: 12px; cursor: pointer; transition: all 0.2s;
        }
        .quick-action-btn:hover { background: #667eea; color: white; border-color: #667eea; }
        .typing-indicator { display: flex; gap: 4px; padding: 8px 0; }
        .typing-indicator span {
            width: 8px; height: 8px; background: #667eea; border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out;
        }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        h1 {
            text-align: center; font-size: 36px; margin-bottom: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text; font-weight: 700;
        }
        .subtitle { text-align: center; color: #718096; margin-bottom: 40px; font-size: 16px; font-weight: 500; }
        .ai-badge {
            display: inline-block; background: linear-gradient(135deg, #ff6a00, #ff3d00);
            color: white; padding: 6px 16px; border-radius: 20px; font-size: 14px;
            font-weight: 600; margin-left: 10px; animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .important-notice {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); color: white;
            padding: 25px; border-radius: 15px; margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
        }
        .important-notice h3 { color: white; margin-bottom: 15px; font-size: 20px; display: flex; align-items: center; gap: 10px; }
        .important-notice ul { list-style: none; padding-left: 0; line-height: 1.8; }
        .important-notice li { display: flex; align-items: flex-start; margin-bottom: 8px; }
        .important-notice li::before { content: "âš ï¸"; margin-right: 12px; font-size: 16px; flex-shrink: 0; margin-top: 2px; }
        .step-indicator {
            display: flex; justify-content: space-between; margin-bottom: 40px; position: relative;
            max-width: 800px; margin-left: auto; margin-right: auto;
        }
        .step-indicator::before {
            content: ''; position: absolute; top: 25px; left: 60px; right: 60px; height: 4px;
            background: #e2e8f0; z-index: 0;
        }
        .step {
            display: flex; flex-direction: column; align-items: center; position: relative;
            z-index: 1; flex: 1; cursor: pointer;
        }
        .step-number {
            width: 50px; height: 50px; border-radius: 50%; background: #e2e8f0; color: #a0aec0;
            display: flex; align-items: center; justify-content: center; font-weight: 700;
            font-size: 20px; margin-bottom: 12px; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .step.active .step-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;
            transform: scale(1.15); box-shadow: 0 4px 16px rgba(102, 126, 234, 0.4);
        }
        .step.completed .step-number { background: #48bb78; color: white; }
        .step-label { font-size: 15px; color: #718096; text-align: center; font-weight: 500; }
        .step.active .step-label { color: #667eea; font-weight: 600; }
        .section { display: none; animation: fadeInUp 0.6s ease; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .section.active { display: block; }
        .dimension-card {
            background: #f7fafc; border-radius: 16px; padding: 30px; margin-bottom: 24px;
            border: 2px solid #e2e8f0; transition: all 0.3s;
        }
        .dimension-card:hover { border-color: #667eea; box-shadow: 0 8px 30px rgba(102, 126, 234, 0.15); transform: translateY(-2px); }
        .dimension-title { font-size: 22px; color: #2d3748; margin-bottom: 16px; display: flex; align-items: center; gap: 12px; font-weight: 600; }
        .dimension-desc { color: #718096; margin-bottom: 24px; font-size: 15px; line-height: 1.7; }
        .score-options { display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; }
        .score-option input[type="radio"] { display: none; }
        .score-label {
            display: block; padding: 20px 12px; text-align: center; border: 2px solid #e2e8f0;
            border-radius: 12px; cursor: pointer; transition: all 0.3s; background: white;
            min-height: 120px; display: flex; flex-direction: column; justify-content: center;
        }
        .score-label:hover { border-color: #667eea; transform: translateY(-4px); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.2); }
        .score-option input[type="radio"]:checked + .score-label {
            border-color: #667eea; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; font-weight: 600; box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3); transform: translateY(-2px);
        }
        .score-number { font-size: 32px; font-weight: 700; display: block; margin-bottom: 8px; }
        .score-desc { font-size: 13px; display: block; line-height: 1.5; }
        .info-section { background: #f7fafc; border-radius: 16px; padding: 30px; margin-bottom: 24px; border: 2px solid #e2e8f0; }
        .info-section h3 { font-size: 22px; font-weight: 600; margin-bottom: 20px; color: #2d3748; }
        .info-group { margin-bottom: 20px; }
        .info-label { display: block; font-weight: 600; color: #2d3748; margin-bottom: 10px; font-size: 15px; }
        .info-select {
            width: 100%; padding: 14px 16px; border: 2px solid #e2e8f0; border-radius: 10px;
            font-size: 15px; transition: all 0.3s; background: white;
        }
        .info-select:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        .checkbox-group { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 12px; }
        .checkbox-label { display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 12px; border-radius: 8px; transition: all 0.2s; }
        .checkbox-label:hover { background: #edf2f7; }
        .checkbox-label input[type="checkbox"] { width: 20px; height: 20px; cursor: pointer; }
        .button-group { display: flex; gap: 16px; justify-content: center; margin-top: 40px; }
        .btn {
            padding: 16px 40px; border: none; border-radius: 12px; font-size: 16px;
            font-weight: 600; cursor: pointer; transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 8px;
        }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4); }
        .btn-secondary { background: #e2e8f0; color: #4a5568; }
        .btn-secondary:hover { background: #cbd5e0; transform: translateY(-2px); }
        .result-card { background: white; border-radius: 16px; padding: 30px; margin-bottom: 24px; border: 2px solid #e2e8f0; }
        .result-title { font-size: 24px; color: #2d3748; margin-bottom: 24px; padding-left: 18px; border-left: 5px solid #667eea; font-weight: 600; }
        .chart-container { position: relative; height: 320px; max-height: 320px; margin: 20px auto; max-width: 500px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin: 20px 0; }
        .stat-card {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%); padding: 25px;
            border-radius: 14px; border-left: 5px solid #667eea; transition: all 0.3s;
        }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 12px 35px rgba(0,0,0,0.12); }
        .stat-label { font-size: 14px; color: #718096; margin-bottom: 10px; font-weight: 500; }
        .stat-value { font-size: 36px; font-weight: 700; color: #667eea; margin-bottom: 8px; line-height: 1; }
        .stat-trend { font-size: 13px; color: #48bb78; font-weight: 500; }
        .ai-loading {
            text-align: center; padding: 40px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px; margin: 20px 0; border: 2px dashed #667eea;
        }
        .ai-loading-spinner {
            display: inline-block; width: 50px; height: 50px; border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .success-box { background: #f0fff4; padding: 20px; border-radius: 12px; border-left: 4px solid #48bb78; margin-bottom: 15px; }
        .success-box h4 { color: #276749; margin-bottom: 15px; }
        .success-box ul { margin-left: 20px; line-height: 1.8; }
        @media (max-width: 768px) {
            .container { padding: 20px; } h1 { font-size: 28px; }
            .score-options { grid-template-columns: 1fr; } .stats-grid { grid-template-columns: 1fr; }
            .button-group { flex-direction: column; } .btn { width: 100%; justify-content: center; }
            .ai-chat-window { width: 300px; height: 400px; right: -20px; }
            .ai-assistant { bottom: 20px; right: 20px; }
            .config-panel { max-width: 300px; right: 10px; left: 10px; }
        }
    </style>
</head>
<body>
    <div class="api-status local" id="apiStatus" onclick="toggleConfigPanel()">
        <i class="fas fa-laptop"></i> <span id="statusText">æœ¬åœ°æ¨¡å¼ (ç‚¹å‡»é…ç½®API)</span>
    </div>

    <div class="config-panel" id="configPanel">
        <div class="config-title"><i class="fas fa-key"></i> é˜¿é‡Œäº‘ç™¾ç‚¼APIé…ç½®</div>
        <div class="config-status info" id="configStatus">è¯·è¾“å…¥APIé…ç½®ä¿¡æ¯ä»¥å¯ç”¨AIæ™ºèƒ½æœåŠ¡</div>
        <input type="password" class="config-input" id="apiKeyInput" placeholder="API Key (sk-å¼€å¤´)">
        <input type="text" class="config-input" id="appIdInput" placeholder="APP ID (åº”ç”¨ID)">
        <button class="config-btn" onclick="saveAndTestConfig()"><i class="fas fa-plug"></i> ä¿å­˜å¹¶æµ‹è¯•è¿æ¥</button>
        <button class="config-btn secondary" onclick="useLocalMode()"><i class="fas fa-laptop"></i> ä½¿ç”¨æœ¬åœ°æ¨¡å¼</button>
        <button class="config-btn secondary" onclick="clearConfig()"><i class="fas fa-trash"></i> æ¸…é™¤é…ç½®</button>
        <div class="config-help">
            <strong>è·å–æ­¥éª¤ï¼š</strong><br>
            1. ç™»å½•<a href="https://bailian.console.aliyun.com" target="_blank">é˜¿é‡Œäº‘ç™¾ç‚¼æ§åˆ¶å°</a><br>
            2. åœ¨"åº”ç”¨ç®¡ç†"ä¸­åˆ›å»º/æŸ¥çœ‹åº”ç”¨ï¼Œå¤åˆ¶APP ID<br>
            3. åœ¨"å¯†é’¥ç®¡ç†"ä¸­åˆ›å»ºAPI Key<br>
            <strong>æ³¨æ„ï¼š</strong>API Keyä»¥"sk-"å¼€å¤´
        </div>
    </div>

    <div class="container">
        <div class="progress-bar" id="progressBar"></div>
        <h1>ğŸ“ è¥¿å®‰å°å‡åˆæ™ºèƒ½è¯„ä¼°ç³»ç»Ÿ <span class="ai-badge">AIåŠ©æ‰‹</span></h1>
        <p class="subtitle">ä¸ªæ€§åŒ–è¯„ä¼° Â· æ™ºèƒ½è§„åˆ’ Â· å…¨ç¨‹AIæŒ‡å¯¼</p>

        <div class="ai-assistant">
            <button class="ai-assistant-btn" onclick="toggleChat()">ğŸ±</button>
            <div class="ai-chat-window" id="chatWindow">
                <div class="ai-chat-header">
                    <div style="font-size: 32px;">ğŸ±</div>
                    <div>
                        <div style="font-weight: 600;">å°å–µå‡å­¦åŠ©æ‰‹</div>
                        <div style="font-size: 12px; opacity: 0.8;" id="chatApiStatus">æœ¬åœ°æ¨¡å¼</div>
                    </div>
                </div>
                <div class="ai-chat-body" id="chatBody">
                    <div class="ai-message assistant">
                        <div class="message-avatar">ğŸ±</div>
                        <div class="message-content">
                            å–µ~æ‚¨å¥½ï¼æˆ‘æ˜¯å°å‡åˆåŠ©æ‰‹å°å–µï¼<br>
                            ğŸ“ è§£ç­”æ‹©æ ¡ç–‘é—®<br>
                            ğŸ« åˆ†æå­¦æ ¡ç‰¹ç‚¹<br>
                            ğŸ“š åˆ¶å®šå­¦ä¹ è®¡åˆ’<br>
                            ğŸ“‹ æä¾›æ”¿ç­–è§£è¯»<br>
                            <small>ğŸ’¡ ç‚¹å‡»å³ä¸Šè§’çŠ¶æ€æ é…ç½®ç™¾ç‚¼APIè·å¾—æ›´æ™ºèƒ½çš„æœåŠ¡ï¼</small>
                        </div>
                    </div>
                </div>
                <div class="ai-chat-input">
                    <div class="chat-input-group">
                        <input type="text" class="chat-input" id="chatInput" placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜..." onkeypress="handleKeyPress(event)">
                        <button class="send-btn" id="sendBtn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
                    </div>
                    <div class="quick-actions">
                        <button class="quick-action-btn" onclick="quickAction('æ¨èé€‚åˆæˆ‘å­©å­çš„å­¦æ ¡')">æ¨èå­¦æ ¡</button>
                        <button class="quick-action-btn" onclick="quickAction('å¦‚ä½•å‡†å¤‡å°å‡åˆé¢è¯•')">é¢è¯•å‡†å¤‡</button>
                        <button class="quick-action-btn" onclick="quickAction('2025å¹´è¥¿å®‰å°å‡åˆæ”¿ç­–è§£è¯»')">æ”¿ç­–è§£è¯»</button>
                        <button class="quick-action-btn" onclick="quickAction('åˆ¶å®šå­¦ä¹ è®¡åˆ’')">å­¦ä¹ è®¡åˆ’</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="important-notice">
            <h3><i class="fas fa-exclamation-triangle"></i> 2025å¹´é‡å¤§æ”¿ç­–å˜åŒ–!</h3>
            <ul>
                <li><strong>ä»2025å¹´èµ·,è¥¿å’¸æ–°åŒºä¸­è€ƒæ­£å¼çº³å…¥è¥¿å®‰ä½“ç³»!</strong></li>
                <li>åŸå’¸é˜³åˆ’åŒº(ç§¦æ±‰ã€æ³¾æ²³ã€ç©ºæ¸¯)çš„å­¦ç”Ÿä¸å†å‚åŠ å’¸é˜³ä¸­è€ƒ</li>
                <li>è¥¿å’¸æ–°åŒºå½¢æˆç‹¬ç«‹æ‹›ç”Ÿå•å…ƒ,æ‹¥æœ‰æ›´å¤šä¼˜è´¨é«˜ä¸­é€‰æ‹©</li>
                <li>çƒ­é—¨å­¦æ ¡ä¸­ç­¾ç‡æ™®éæå‡10-15ä¸ªç™¾åˆ†ç‚¹</li>
            </ul>
        </div>

        <div class="step-indicator">
            <div class="step active" id="step1-indicator" onclick="showStep(1)"><div class="step-number">1</div><div class="step-label">èƒ½åŠ›è¯„ä¼°</div></div>
            <div class="step" id="step2-indicator" onclick="showStep(2)"><div class="step-number">2</div><div class="step-label">å®¶åº­ä¿¡æ¯</div></div>
            <div class="step" id="step3-indicator" onclick="showStep(3)"><div class="step-number">3</div><div class="step-label">èƒ½åŠ›åˆ†æ</div></div>
            <div class="step" id="step4-indicator" onclick="showStep(4)"><div class="step-number">4</div><div class="step-label">AIæ¨è</div></div>
        </div>

        <div id="step1" class="section active">
            <div class="dimension-card">
                <div class="dimension-title">ğŸ“š ç»´åº¦ä¸€:å­¦ä¸šæˆç»©</div>
                <div class="dimension-desc">è¯„ä¼°å­©å­åœ¨ç­çº§/å¹´çº§çš„å­¦ä¸šæˆç»©æ’åæƒ…å†µ</div>
                <div class="score-options">
                    <div class="score-option"><input type="radio" name="score1" id="score1-5" value="5"><label for="score1-5" class="score-label"><span class="score-number">5</span><span class="score-desc">å¹´çº§å‰5%<br>éå¸¸ä¼˜ç§€</span></label></div>
                    <div class="score-option"><input type="radio" name="score1" id="score1-4" value="4"><label for="score1-4" class="score-label"><span class="score-number">4</span><span class="score-desc">å¹´çº§å‰15%<br>ä¼˜ç§€</span></label></div>
                    <div class="score-option"><input type="radio" name="score1" id="score1-3" value="3"><label for="score1-3" class="score-label"><span class="score-number">3</span><span class="score-desc">å¹´çº§å‰30%<br>è‰¯å¥½</span></label></div>
                    <div class="score-option"><input type="radio" name="score1" id="score1-2" value="2"><label for="score1-2" class="score-label"><span class="score-number">2</span><span class="score-desc">å¹´çº§å‰50%<br>ä¸€èˆ¬</span></label></div>
                    <div class="score-option"><input type="radio" name="score1" id="score1-1" value="1"><label for="score1-1" class="score-label"><span class="score-number">1</span><span class="score-desc">å¹´çº§50%å<br>éœ€åŠªåŠ›</span></label></div>
                </div>
            </div>

            <div class="dimension-card">
                <div class="dimension-title">ğŸ¨ ç»´åº¦äºŒ:ç»¼åˆç´ å…»</div>
                <div class="dimension-desc">è¯„ä¼°å­©å­çš„ç‰¹é•¿ã€è·å¥–æƒ…å†µå’Œç»¼åˆå‘å±•æ°´å¹³</div>
                <div class="score-options">
                    <div class="score-option"><input type="radio" name="score2" id="score2-5" value="5"><label for="score2-5" class="score-label"><span class="score-number">5</span><span class="score-desc">ç‰¹é•¿çªå‡º<br>çœçº§è·å¥–</span></label></div>
                    <div class="score-option"><input type="radio" name="score2" id="score2-4" value="4"><label for="score2-4" class="score-label"><span class="score-number">4</span><span class="score-desc">å¤šæ–¹å‘å±•<br>å¸‚çº§è¯ä¹¦</span></label></div>
                    <div class="score-option"><input type="radio" name="score2" id="score2-3" value="3"><label for="score2-3" class="score-label"><span class="score-number">3</span><span class="score-desc">æœ‰ç‰¹é•¿<br>æ ¡çº§è·å¥–</span></label></div>
                    <div class="score-option"><input type="radio" name="score2" id="score2-2" value="2"><label for="score2-2" class="score-label"><span class="score-number">2</span><span class="score-desc">ç´ å…»ä¸€èˆ¬<br>å‚ä¸æ´»åŠ¨</span></label></div>
                    <div class="score-option"><input type="radio" name="score2" id="score2-1" value="1"><label for="score2-1" class="score-label"><span class="score-number">1</span><span class="score-desc">éœ€è¦åŸ¹å…»<br>è¾ƒå°‘å‚ä¸</span></label></div>
                </div>
            </div>

            <div class="dimension-card">
                <div class="dimension-title">ğŸ“– ç»´åº¦ä¸‰:å­¦ä¹ ä¹ æƒ¯</div>
                <div class="dimension-desc">è¯„ä¼°å­©å­çš„è‡ªå¾‹æ€§å’Œå­¦ä¹ ä¸»åŠ¨æ€§</div>
                <div class="score-options">
                    <div class="score-option"><input type="radio" name="score3" id="score3-5" value="5"><label for="score3-5" class="score-label"><span class="score-number">5</span><span class="score-desc">éå¸¸è‡ªå¾‹<br>ä¸»åŠ¨å­¦ä¹ </span></label></div>
                    <div class="score-option"><input type="radio" name="score3" id="score3-4" value="4"><label for="score3-4" class="score-label"><span class="score-number">4</span><span class="score-desc">è¾ƒä¸ºè‡ªå¾‹<br>å°‘ç›‘ç£</span></label></div>
                    <div class="score-option"><input type="radio" name="score3" id="score3-3" value="3"><label for="score3-3" class="score-label"><span class="score-number">3</span><span class="score-desc">éœ€è¦ç›‘ç£</span></label></div>
                    <div class="score-option"><input type="radio" name="score3" id="score3-2" value="2"><label for="score3-2" class="score-label"><span class="score-number">2</span><span class="score-desc">ä¹ æƒ¯ä¸€èˆ¬<br>å¤šç£ä¿ƒ</span></label></div>
                    <div class="score-option"><input type="radio" name="score3" id="score3-1" value="1"><label for="score3-1" class="score-label"><span class="score-number">1</span><span class="score-desc">ä¹ æƒ¯è¾ƒå·®<br>éœ€åŸ¹å…»</span></label></div>
                </div>
            </div>

            <div class="dimension-card">
                <div class="dimension-title">ğŸ’ª ç»´åº¦å››:å¿ƒç†ç´ è´¨</div>
                <div class="dimension-desc">è¯„ä¼°å­©å­çš„æŠ—å‹èƒ½åŠ›å’Œå¿ƒç†æ‰¿å—èƒ½åŠ›</div>
                <div class="score-options">
                    <div class="score-option"><input type="radio" name="score4" id="score4-5" value="5"><label for="score4-5" class="score-label"><span class="score-number">5</span><span class="score-desc">æŠ—å‹å¼º<br>å¿ƒæ€å¥½</span></label></div>
                    <div class="score-option"><input type="radio" name="score4" id="score4-4" value="4"><label for="score4-4" class="score-label"><span class="score-number">4</span><span class="score-desc">é€‚åº”æ€§å¥½<br>è¾ƒç¨³å®š</span></label></div>
                    <div class="score-option"><input type="radio" name="score4" id="score4-3" value="3"><label for="score4-3" class="score-label"><span class="score-number">3</span><span class="score-desc">ä¸€èˆ¬æ°´å¹³</span></label></div>
                    <div class="score-option"><input type="radio" name="score4" id="score4-2" value="2"><label for="score4-2" class="score-label"><span class="score-number">2</span><span class="score-desc">å®¹æ˜“ç„¦è™‘<br>å‹åŠ›å¤§</span></label></div>
                    <div class="score-option"><input type="radio" name="score4" id="score4-1" value="1"><label for="score4-1" class="score-label"><span class="score-number">1</span><span class="score-desc">éœ€è¦å…³æ³¨<br>å¿ƒç†è„†å¼±</span></label></div>
                </div>
            </div>

            <div class="dimension-card">
                <div class="dimension-title">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ç»´åº¦äº”:å®¶åº­æ”¯æŒ</div>
                <div class="dimension-desc">è¯„ä¼°å®¶åº­åœ¨æ—¶é—´ã€ç»æµã€ç²¾åŠ›æ–¹é¢çš„æ”¯æŒèƒ½åŠ›</div>
                <div class="score-options">
                    <div class="score-option"><input type="radio" name="score5" id="score5-5" value="5"><label for="score5-5" class="score-label"><span class="score-number">5</span><span class="score-desc">æ—¶é—´å……è¶³<br>å…¨åŠ›æ”¯æŒ</span></label></div>
                    <div class="score-option"><input type="radio" name="score5" id="score5-4" value="4"><label for="score5-4" class="score-label"><span class="score-number">4</span><span class="score-desc">ç§¯ææ”¯æŒ<br>æ¡ä»¶è¾ƒå¥½</span></label></div>
                    <div class="score-option"><input type="radio" name="score5" id="score5-3" value="3"><label for="score5-3" class="score-label"><span class="score-number">3</span><span class="score-desc">ä¸€èˆ¬æ”¯æŒ<br>æ¡ä»¶ä¸€èˆ¬</span></label></div>
                    <div class="score-option"><input type="radio" name="score5" id="score5-2" value="2"><label for="score5-2" class="score-label"><span class="score-number">2</span><span class="score-desc">æœ‰é™æ”¯æŒ<br>æ¡ä»¶æœ‰é™</span></label></div>
                    <div class="score-option"><input type="radio" name="score5" id="score5-1" value="1"><label for="score5-1" class="score-label"><span class="score-number">1</span><span class="score-desc">æ”¯æŒä¸è¶³<br>æ¡ä»¶è¾ƒå·®</span></label></div>
                </div>
            </div>
            <div class="button-group"><button class="btn btn-primary" onclick="goToStep2()">ä¸‹ä¸€æ­¥:å¡«å†™å®¶åº­ä¿¡æ¯ â†’</button></div>
        </div>

        <div id="step2" class="section">
            <div class="info-section">
                <h3>ğŸ“‹ å®¶åº­åŸºæœ¬ä¿¡æ¯</h3>
                <div class="info-group">
                    <label class="info-label">å­©å­å½“å‰å¹´çº§</label>
                    <select class="info-select" id="grade"><option value="">è¯·é€‰æ‹©</option><option value="4">å››å¹´çº§</option><option value="5">äº”å¹´çº§</option><option value="6">å…­å¹´çº§</option></select>
                </div>
                <div class="info-group">
                    <label class="info-label">æˆ·ç±æ‰€åœ¨åŒº</label>
                    <select class="info-select" id="district"><option value="">è¯·é€‰æ‹©</option><option value="é«˜æ–°åŒº">é«˜æ–°åŒº</option><option value="é›å¡”åŒº">é›å¡”åŒº</option><option value="ç¢‘æ—åŒº">ç¢‘æ—åŒº</option><option value="æ–°åŸåŒº">æ–°åŸåŒº</option><option value="è²æ¹–åŒº">è²æ¹–åŒº</option><option value="æœªå¤®åŒº">æœªå¤®åŒº</option><option value="çæ¡¥åŒº">çæ¡¥åŒº</option><option value="é•¿å®‰åŒº">é•¿å®‰åŒº</option><option value="æ›²æ±Ÿæ–°åŒº">æ›²æ±Ÿæ–°åŒº</option><option value="è¥¿å’¸æ–°åŒº">è¥¿å’¸æ–°åŒº</option><option value="èˆªå¤©åŸºåœ°">èˆªå¤©åŸºåœ°</option><option value="å¤–åœ°">å¤–åœ°æˆ·ç±</option></select>
                </div>
                <div class="info-group">
                    <label class="info-label">æ˜¯å¦æœ‰å­¦åŒºæˆ¿</label>
                    <select class="info-select" id="hasHouse"><option value="">è¯·é€‰æ‹©</option><option value="yes-good">æœ‰,å¯¹å£å­¦æ ¡è¾ƒå¥½</option><option value="yes-normal">æœ‰,å¯¹å£å­¦æ ¡ä¸€èˆ¬</option><option value="no">æš‚æ— ,è€ƒè™‘è´­ä¹°</option><option value="rent">ç§Ÿæˆ¿å±…ä½</option></select>
                </div>
                <div class="info-group">
                    <label class="info-label">å®¶åº­æ•™è‚²é¢„ç®—(ä¸‰å¹´æ€»è®¡)</label>
                    <select class="info-select" id="budget"><option value="">è¯·é€‰æ‹©</option><option value="low">4ä¸‡ä»¥å†…(åªèƒ½é€‰å…¬åŠ)</option><option value="medium">4-8ä¸‡(å¯è€ƒè™‘éƒ¨åˆ†æ°‘åŠ)</option><option value="high">8ä¸‡ä»¥ä¸Š(æ°‘åŠæ— å‹åŠ›)</option></select>
                </div>
                <div class="info-group">
                    <label class="info-label">å­©å­çš„ç‰¹é•¿ä¼˜åŠ¿(å¯å¤šé€‰)</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label"><input type="checkbox" value="æ•°å­¦" class="strength-check"> æ•°å­¦çªå‡º</label>
                        <label class="checkbox-label"><input type="checkbox" value="è¯­æ–‡" class="strength-check"> è¯­æ–‡çªå‡º</label>
                        <label class="checkbox-label"><input type="checkbox" value="è‹±è¯­" class="strength-check"> è‹±è¯­çªå‡º</label>
                        <label class="checkbox-label"><input type="checkbox" value="è‰ºæœ¯" class="strength-check"> è‰ºæœ¯ç‰¹é•¿</label>
                        <label class="checkbox-label"><input type="checkbox" value="ä½“è‚²" class="strength-check"> ä½“è‚²ç‰¹é•¿</label>
                        <label class="checkbox-label"><input type="checkbox" value="ç§‘æŠ€" class="strength-check"> ç§‘æŠ€åˆ›æ–°</label>
                        <label class="checkbox-label"><input type="checkbox" value="ç¼–ç¨‹" class="strength-check"> ç¼–ç¨‹èƒ½åŠ›</label>
                        <label class="checkbox-label"><input type="checkbox" value="ä¹¦æ³•" class="strength-check"> ä¹¦æ³•</label>
                    </div>
                </div>
                <div class="info-group">
                    <label class="info-label">å­©å­çš„å­¦ä¹ æ„æ„¿</label>
                    <select class="info-select" id="motivation"><option value="">è¯·é€‰æ‹©</option><option value="high">éå¸¸ä¸»åŠ¨,æœ‰å¼ºçƒˆå­¦ä¹ æ„æ„¿</option><option value="medium">æ¯”è¾ƒé…åˆ,éœ€è¦é€‚å½“å¼•å¯¼</option><option value="low">å­¦ä¹ æ„æ„¿ä¸€èˆ¬,éœ€è¦ç£ä¿ƒ</option></select>
                </div>
                <div class="info-group">
                    <label class="info-label">æ˜¯å¦æ¥å—æ‘‡å·ä¸ç¡®å®šæ€§</label>
                    <select class="info-select" id="acceptLottery"><option value="">è¯·é€‰æ‹©</option><option value="yes">å¯ä»¥æ¥å—,æ„¿æ„å†²åˆºåæ ¡</option><option value="cautious">è°¨æ…æ€åº¦,å¸Œæœ›ç¨³å¦¥ä¸ºä¸»</option><option value="no">ä¸æ¥å—,å¿…é¡»ç¡®ä¿æœ‰å­¦ä¸Š</option></select>
                </div>
            </div>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="goToStep1()">â† ä¸Šä¸€æ­¥</button>
                <button class="btn btn-primary" onclick="generateReport()">ç”Ÿæˆå¯è§†åŒ–æŠ¥å‘Š â†’</button>
            </div>
        </div>

        <div id="step3" class="section">
            <div class="result-card">
                <div class="result-title">ğŸ“Š ç»¼åˆèƒ½åŠ›é›·è¾¾å›¾</div>
                <div class="chart-container"><canvas id="radarChart"></canvas></div>
            </div>
            <div class="result-card">
                <div class="result-title">ğŸ¯ ç«äº‰åŠ›è¯„ä¼°</div>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-label">ç»¼åˆå¾—åˆ†</div><div class="stat-value" id="totalScore">0</div><div class="stat-trend" id="scoreTrend">è¶…è¿‡å…¨å¸‚60%çš„å­¦ç”Ÿ</div></div>
                    <div class="stat-card"><div class="stat-label">ç«äº‰åŠ›ç­‰çº§</div><div class="stat-value" id="competitiveLevel" style="font-size: 28px;">B+</div><div class="stat-trend">å…·å¤‡å†²åˆºä¼˜è´¨å­¦æ ¡æ½œåŠ›</div></div>
                    <div class="stat-card"><div class="stat-label">æœ€å¼ºç»´åº¦</div><div class="stat-value" id="strongestDim" style="font-size: 24px;">--</div><div class="stat-trend">ä¿æŒå¹¶å‘æŒ¥ä¼˜åŠ¿</div></div>
                    <div class="stat-card"><div class="stat-label">æå‡é‡ç‚¹</div><div class="stat-value" id="weakestDim" style="font-size: 24px;">--</div><div class="stat-trend">çŸ­æœŸé‡ç‚¹æ”¹è¿›æ–¹å‘</div></div>
                </div>
            </div>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="goToStep2()">â† è¿”å›ä¿®æ”¹</button>
                <button class="btn btn-primary" onclick="goToStep4()">æŸ¥çœ‹AIæ‹©æ ¡æ–¹æ¡ˆ â†’</button>
            </div>
        </div>

        <div id="step4" class="section">
            <div class="result-card">
                <div class="result-title">ğŸ« AIæ™ºèƒ½å­¦æ ¡æ¨è</div>
                <div id="schoolRecommendation"><div class="ai-loading"><div class="ai-loading-spinner"></div><h4>ğŸ¤– AIæ­£åœ¨ç”Ÿæˆä¸ªæ€§åŒ–æ‹©æ ¡æ–¹æ¡ˆ...</h4></div></div>
            </div>
            <div class="result-card">
                <div class="result-title">ğŸ’¡ AIå†³ç­–å»ºè®®</div>
                <div id="decisionAdvice"></div>
            </div>
            <div class="result-card">
                <div class="result-title">â° ä¸ªæ€§åŒ–æ—¶é—´è§„åˆ’</div>
                <div id="timeline"></div>
            </div>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="goToStep3()">â† è¿”å›åˆ†æ</button>
                <button class="btn btn-primary" onclick="window.print()">ğŸ–¨ï¸ æ‰“å°å®Œæ•´æŠ¥å‘Š</button>
                <button class="btn btn-secondary" onclick="resetAssessment()">ğŸ”„ é‡æ–°è¯„ä¼°</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== å…¨å±€é…ç½® ====================
        const CONFIG = { apiKey: '', appId: '', isConnected: false, useLocalMode: true };
        let assessmentData = { scores: {}, familyInfo: {}, totalScore: 0 };
        let radarChart = null;
        let chatHistory = [];

        // ==================== APIé…ç½®åŠŸèƒ½ ====================
        function toggleConfigPanel() {
            document.getElementById('configPanel').classList.toggle('show');
        }

        async function saveAndTestConfig() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            const appId = document.getElementById('appIdInput').value.trim();
            const statusEl = document.getElementById('configStatus');
            
            if (!apiKey || !appId) {
                statusEl.className = 'config-status error';
                statusEl.textContent = 'âŒ è¯·å¡«å†™å®Œæ•´çš„API Keyå’ŒAPP ID';
                return;
            }
            if (!apiKey.startsWith('sk-')) {
                statusEl.className = 'config-status error';
                statusEl.textContent = 'âŒ API Keyæ ¼å¼é”™è¯¯ï¼Œåº”ä»¥"sk-"å¼€å¤´';
                return;
            }
            
            statusEl.className = 'config-status info';
            statusEl.textContent = 'ğŸ”„ æ­£åœ¨æµ‹è¯•è¿æ¥...';
            
            CONFIG.apiKey = apiKey;
            CONFIG.appId = appId;
            
            try {
                const testResult = await callBailianAPI('ä½ å¥½ï¼Œè¯·ç®€å•å›å¤"è¿æ¥æˆåŠŸ"');
                if (testResult) {
                    CONFIG.isConnected = true;
                    CONFIG.useLocalMode = false;
                    statusEl.className = 'config-status success';
                    statusEl.textContent = 'âœ… è¿æ¥æˆåŠŸï¼AIæœåŠ¡å·²å¯ç”¨';
                    updateApiStatusUI(true);
                    setTimeout(() => toggleConfigPanel(), 1500);
                }
            } catch (error) {
                statusEl.className = 'config-status error';
                statusEl.textContent = 'âŒ è¿æ¥å¤±è´¥: ' + error.message;
                CONFIG.isConnected = false;
            }
        }

        function useLocalMode() {
            CONFIG.useLocalMode = true;
            CONFIG.isConnected = false;
            updateApiStatusUI(false);
            document.getElementById('configStatus').className = 'config-status info';
            document.getElementById('configStatus').textContent = 'å·²åˆ‡æ¢åˆ°æœ¬åœ°æ¨¡å¼';
            toggleConfigPanel();
        }

        function clearConfig() {
            CONFIG.apiKey = '';
            CONFIG.appId = '';
            CONFIG.isConnected = false;
            CONFIG.useLocalMode = true;
            document.getElementById('apiKeyInput').value = '';
            document.getElementById('appIdInput').value = '';
            updateApiStatusUI(false);
            document.getElementById('configStatus').className = 'config-status info';
            document.getElementById('configStatus').textContent = 'é…ç½®å·²æ¸…é™¤';
        }

        function updateApiStatusUI(connected) {
            const statusEl = document.getElementById('apiStatus');
            const textEl = document.getElementById('statusText');
            const chatStatus = document.getElementById('chatApiStatus');
            
            if (connected) {
                statusEl.className = 'api-status connected';
                textEl.innerHTML = '<i class="fas fa-check-circle"></i> AIå·²è¿æ¥';
                chatStatus.textContent = 'ç™¾ç‚¼AIå·²è¿æ¥';
            } else {
                statusEl.className = 'api-status local';
                textEl.innerHTML = '<i class="fas fa-laptop"></i> æœ¬åœ°æ¨¡å¼ (ç‚¹å‡»é…ç½®)';
                chatStatus.textContent = 'æœ¬åœ°æ¨¡å¼';
            }
        }

        // ==================== ç™¾ç‚¼APIè°ƒç”¨ ====================
        async function callBailianAPI(prompt, context = '') {
            if (!CONFIG.apiKey || !CONFIG.appId) throw new Error('APIæœªé…ç½®');
            
            const systemPrompt = `ä½ æ˜¯è¥¿å®‰å°å‡åˆå‡å­¦é¡¾é—®"å°å–µ"ï¼Œä¸“ä¸šã€å‹å¥½ã€ç®€æ´ã€‚
ä¸»è¦èŒè´£ï¼šè§£ç­”è¥¿å®‰å°å‡åˆæ”¿ç­–ã€å­¦æ ¡æ¨èã€å­¦ä¹ è§„åˆ’ã€‚
2025å¹´é‡è¦æ”¿ç­–ï¼šè¥¿å’¸æ–°åŒºçº³å…¥è¥¿å®‰ä¸­è€ƒä½“ç³»ï¼Œæ°‘åŠæ‘‡å·å½•å–ï¼Œå…¬åŠå­¦åŒºå…¥å­¦ã€‚
å›ç­”è¦æ±‚ï¼šç®€æ´å®ç”¨ï¼Œ200å­—ä»¥å†…ï¼Œé‡ç‚¹çªå‡ºã€‚${context ? '\nå­¦ç”Ÿæƒ…å†µï¼š' + context : ''}`;

            const response = await fetch('https://dashscope.aliyuncs.com/api/v1/apps/' + CONFIG.appId + '/completion', {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + CONFIG.apiKey,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    input: { prompt: prompt },
                    parameters: { 
                        incremental_output: false,
                        has_thoughts: false
                    },
                    debug: {}
                })
            });

            if (!response.ok) {
                const err = await response.json().catch(() => ({}));
                throw new Error(err.message || 'è¯·æ±‚å¤±è´¥: ' + response.status);
            }

            const data = await response.json();
            if (data.output && data.output.text) return data.output.text;
            throw new Error('å“åº”æ ¼å¼å¼‚å¸¸');
        }

        // ==================== èŠå¤©åŠŸèƒ½ ====================
        function toggleChat() {
            const win = document.getElementById('chatWindow');
            win.style.display = win.style.display === 'flex' ? 'none' : 'flex';
        }

        function handleKeyPress(e) { if (e.key === 'Enter') sendMessage(); }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const msg = input.value.trim();
            if (!msg) return;
            
            addMessage(msg, 'user');
            input.value = '';
            document.getElementById('sendBtn').disabled = true;
            
            showTyping();
            
            try {
                let response;
                if (CONFIG.isConnected && !CONFIG.useLocalMode) {
                    const ctx = assessmentData.totalScore > 0 ? 
                        `ç»¼åˆå¾—åˆ†${assessmentData.totalScore}åˆ†,${assessmentData.familyInfo.district || ''}æˆ·ç±` : '';
                    response = await callBailianAPI(msg, ctx);
                } else {
                    response = getLocalResponse(msg);
                }
                removeTyping();
                addMessage(response, 'assistant');
            } catch (error) {
                removeTyping();
                addMessage('æŠ±æ­‰ï¼ŒAIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼š' + error.message, 'assistant');
            }
            
            document.getElementById('sendBtn').disabled = false;
        }

        function quickAction(action) {
            document.getElementById('chatInput').value = action;
            sendMessage();
        }

        function addMessage(content, role) {
            const body = document.getElementById('chatBody');
            const div = document.createElement('div');
            div.className = `ai-message ${role}`;
            div.innerHTML = `
                <div class="message-avatar">${role === 'assistant' ? 'ğŸ±' : 'ğŸ‘¤'}</div>
                <div class="message-content">${content.replace(/\n/g, '<br>')}</div>
            `;
            body.appendChild(div);
            body.scrollTop = body.scrollHeight;
        }

        function showTyping() {
            const body = document.getElementById('chatBody');
            const div = document.createElement('div');
            div.className = 'ai-message assistant';
            div.id = 'typing-indicator';
            div.innerHTML = `<div class="message-avatar">ğŸ±</div><div class="message-content"><div class="typing-indicator"><span></span><span></span><span></span></div></div>`;
            body.appendChild(div);
            body.scrollTop = body.scrollHeight;
        }

        function removeTyping() {
            const el = document.getElementById('typing-indicator');
            if (el) el.remove();
        }

        function getLocalResponse(msg) {
            const responses = {
                'å­¦æ ¡': 'ğŸ« è¥¿å®‰çƒ­é—¨åˆä¸­ï¼šé“ä¸€ä¸­ã€è¥¿å·¥å¤§é™„ä¸­ã€ç¿±ç¿”ä¸­å­¦ã€æ±‡çŸ¥ä¸­å­¦ç­‰ã€‚å»ºè®®æ ¹æ®å­©å­æˆç»©å’Œæˆ·ç±é€‰æ‹©å†²åˆºã€åŒ¹é…ã€ä¿åº•ä¸‰æ¡£å­¦æ ¡ã€‚',
                'é¢è¯•': 'ğŸ¯ é¢è¯•å‡†å¤‡ï¼š1.å‡†å¤‡2åˆ†é’Ÿè‡ªæˆ‘ä»‹ç» 2.å¤ä¹ è¯­æ•°è‹±åŸºç¡€ 3.æ•´ç†è·å¥–è¯ä¹¦ 4.ç»ƒä¹ ä¸´åœºåº”å˜èƒ½åŠ›ã€‚',
                'æ”¿ç­–': 'ğŸ“‹ 2025æ”¿ç­–è¦ç‚¹ï¼šå…¬åŠæŒ‰å­¦åŒºå…¥å­¦ï¼Œæ°‘åŠæ‘‡å·å½•å–ï¼Œè¥¿å’¸æ–°åŒºçº³å…¥è¥¿å®‰ä¸­è€ƒä½“ç³»ã€‚æŠ¥åæ—¶é—´é€šå¸¸åœ¨4-5æœˆã€‚',
                'è®¡åˆ’': 'ğŸ“… å­¦ä¹ è®¡åˆ’å»ºè®®ï¼šæ¯æ—¥è¯­æ–‡40åˆ†é’Ÿï¼ˆé˜…è¯»+å†™ä½œï¼‰ï¼Œæ•°å­¦50åˆ†é’Ÿï¼ˆåŸºç¡€+æ€ç»´ï¼‰ï¼Œè‹±è¯­30åˆ†é’Ÿï¼Œä¿è¯ä¼‘æ¯å’Œè¿åŠ¨ã€‚'
            };
            for (const [key, val] of Object.entries(responses)) {
                if (msg.includes(key)) return val;
            }
            return 'å–µ~æ„Ÿè°¢æ‚¨çš„æé—®ï¼å»ºè®®æ‚¨ç‚¹å‡»å³ä¸Šè§’é…ç½®ç™¾ç‚¼APIï¼Œè·å¾—æ›´ä¸“ä¸šçš„AIå›ç­”ã€‚æˆ–è€…æ‚¨å¯ä»¥é—®æˆ‘å…³äºå­¦æ ¡æ¨èã€é¢è¯•å‡†å¤‡ã€æ”¿ç­–è§£è¯»ç­‰é—®é¢˜ã€‚';
        }

        // ==================== è¯„ä¼°ç³»ç»Ÿ ====================
        function showStep(n) {
            document.getElementById('progressBar').style.width = `${(n/4)*100}%`;
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            for (let i = 1; i <= 4; i++) {
                const ind = document.getElementById(`step${i}-indicator`);
                ind.classList.remove('active', 'completed');
                if (i < n) ind.classList.add('completed');
                else if (i === n) ind.classList.add('active');
            }
            document.getElementById(`step${n}`).classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function goToStep1() { showStep(1); }
        
        function goToStep2() {
            for (let i = 1; i <= 5; i++) {
                if (!document.querySelector(`input[name="score${i}"]:checked`)) {
                    alert('è¯·å®Œæˆæ‰€æœ‰äº”ä¸ªç»´åº¦çš„è¯„åˆ†ï¼');
                    return;
                }
            }
            for (let i = 1; i <= 5; i++) {
                assessmentData.scores[`score${i}`] = parseInt(document.querySelector(`input[name="score${i}"]:checked`).value);
            }
            showStep(2);
        }

        function generateReport() {
            const fields = ['grade', 'district', 'hasHouse', 'budget', 'motivation', 'acceptLottery'];
            for (const f of fields) {
                if (!document.getElementById(f).value) {
                    alert('è¯·å¡«å†™å®Œæ•´çš„å®¶åº­ä¿¡æ¯ï¼');
                    return;
                }
            }
            assessmentData.familyInfo = {
                grade: document.getElementById('grade').value,
                district: document.getElementById('district').value,
                hasHouse: document.getElementById('hasHouse').value,
                budget: document.getElementById('budget').value,
                motivation: document.getElementById('motivation').value,
                acceptLottery: document.getElementById('acceptLottery').value,
                strengths: Array.from(document.querySelectorAll('.strength-check:checked')).map(cb => cb.value)
            };
            assessmentData.totalScore = Object.values(assessmentData.scores).reduce((a, b) => a + b, 0);
            displayResults();
            showStep(3);
        }

        function displayResults() {
            const s = assessmentData.scores, total = assessmentData.totalScore;
            document.getElementById('totalScore').textContent = total;
            const pct = total >= 23 ? 90 : total >= 20 ? 75 : total >= 17 ? 60 : total >= 14 ? 40 : 25;
            document.getElementById('scoreTrend').textContent = `è¶…è¿‡å…¨å¸‚${pct}%çš„å­¦ç”Ÿ`;
            document.getElementById('competitiveLevel').textContent = total >= 23 ? 'A' : total >= 20 ? 'B+' : total >= 17 ? 'B' : total >= 14 ? 'C+' : 'C';
            
            const dims = { score1: 'å­¦ä¸šæˆç»©', score2: 'ç»¼åˆç´ å…»', score3: 'å­¦ä¹ ä¹ æƒ¯', score4: 'å¿ƒç†ç´ è´¨', score5: 'å®¶åº­æ”¯æŒ' };
            const vals = Object.values(s);
            const maxK = Object.keys(s).find(k => s[k] === Math.max(...vals));
            const minK = Object.keys(s).find(k => s[k] === Math.min(...vals));
            document.getElementById('strongestDim').textContent = dims[maxK];
            document.getElementById('weakestDim').textContent = dims[minK];
            
            createRadarChart();
        }

        function createRadarChart() {
            const ctx = document.getElementById('radarChart').getContext('2d');
            if (radarChart) radarChart.destroy();
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['å­¦ä¸šæˆç»©', 'ç»¼åˆç´ å…»', 'å­¦ä¹ ä¹ æƒ¯', 'å¿ƒç†ç´ è´¨', 'å®¶åº­æ”¯æŒ'],
                    datasets: [{
                        label: 'æ‚¨çš„å­©å­',
                        data: [assessmentData.scores.score1, assessmentData.scores.score2, assessmentData.scores.score3, assessmentData.scores.score4, assessmentData.scores.score5],
                        fill: true, backgroundColor: 'rgba(102,126,234,0.2)', borderColor: '#667eea', pointBackgroundColor: '#667eea', pointRadius: 5
                    }]
                },
                options: { scales: { r: { beginAtZero: true, max: 5 } } }
            });
        }

        function goToStep3() { showStep(3); }

        async function goToStep4() {
            showStep(4);
            document.getElementById('schoolRecommendation').innerHTML = '<div class="ai-loading"><div class="ai-loading-spinner"></div><h4>ğŸ¤– AIæ­£åœ¨ç”Ÿæˆä¸ªæ€§åŒ–æ‹©æ ¡æ–¹æ¡ˆ...</h4></div>';
            
            if (CONFIG.isConnected && !CONFIG.useLocalMode) {
                try {
                    const ctx = `ç»¼åˆå¾—åˆ†${assessmentData.totalScore}/25,æˆ·ç±${assessmentData.familyInfo.district},é¢„ç®—${assessmentData.familyInfo.budget},æ‘‡å·æ€åº¦${assessmentData.familyInfo.acceptLottery}`;
                    const aiRec = await callBailianAPI('æ ¹æ®å­¦ç”Ÿæƒ…å†µæ¨è3-5æ‰€è¥¿å®‰åˆä¸­å­¦æ ¡ï¼Œåˆ†å†²åˆºã€åŒ¹é…ã€ä¿åº•ä¸‰æ¡£ï¼Œè¯´æ˜æ¨èç†ç”±', ctx);
                    document.getElementById('schoolRecommendation').innerHTML = `<div class="success-box"><h4>ğŸ¤– AIæ™ºèƒ½æ¨è</h4><p>${aiRec.replace(/\n/g, '<br>')}</p></div>`;
                    
                    const aiAdvice = await callBailianAPI('ç»™å‡ºæ‹©æ ¡å†³ç­–å»ºè®®å’Œæ³¨æ„äº‹é¡¹', ctx);
                    document.getElementById('decisionAdvice').innerHTML = `<div class="success-box"><h4>ğŸ’¡ AIå†³ç­–å»ºè®®</h4><p>${aiAdvice.replace(/\n/g, '<br>')}</p></div>`;
                } catch (e) {
                    generateLocalRecommendation();
                }
            } else {
                generateLocalRecommendation();
            }
            renderTimeline();
        }

        function generateLocalRecommendation() {
            const total = assessmentData.totalScore;
            const info = assessmentData.familyInfo;
            let html = '<div class="success-box"><h4>ğŸ¯ åŸºäºæ™ºèƒ½åˆ†æçš„å­¦æ ¡æ¨è</h4>';
            
            if (total >= 20) {
                html += `<p><strong>ç­–ç•¥ï¼šå†²åˆºå‹</strong></p>
                <ul><li><strong>ğŸ« å†²åˆºï¼š</strong>è¥¿å®‰é“ä¸€ä¸­ã€è¥¿å·¥å¤§é™„ä¸­</li>
                <li><strong>ğŸ¯ åŒ¹é…ï¼š</strong>ç¿±ç¿”ä¸­å­¦ã€è¾…è½®ä¸­å­¦</li>
                <li><strong>âœ… ä¿åº•ï¼š</strong>å­¦åŒºå¯¹å£å…¬åŠå­¦æ ¡</li></ul>`;
            } else if (total >= 15) {
                html += `<p><strong>ç­–ç•¥ï¼šç¨³å¦¥å‹</strong></p>
                <ul><li><strong>ğŸ¯ ä¸»æ”»ï¼š</strong>æ±‡çŸ¥ä¸­å­¦ã€è¡ŒçŸ¥ä¸­å­¦</li>
                <li><strong>âœ… ç¨³å¦¥ï¼š</strong>åŒºåŸŸå†…ä¼˜è´¨å…¬åŠ</li></ul>`;
            } else {
                html += `<p><strong>ç­–ç•¥ï¼šä¿å®ˆå‹</strong></p>
                <ul><li><strong>âœ… ä¼˜å…ˆï¼š</strong>å¯¹å£å…¬åŠå­¦æ ¡</li>
                <li><strong>ğŸ’¡ å¤‡é€‰ï¼š</strong>å…³æ³¨è¡¥å½•æœºä¼š</li></ul>`;
            }
            html += '</div>';
            document.getElementById('schoolRecommendation').innerHTML = html;
            
            let advice = '<div class="success-box"><h4>ğŸ¯ å†³ç­–å»ºè®®</h4>';
            if (total >= 20) advice += '<p>å¯å°è¯•1-2æ‰€çƒ­é—¨å­¦æ ¡ï¼ŒåŒæ—¶å‡†å¤‡ä¿åº•é€‰æ‹©ã€‚å»ºè®®æå‰äº†è§£ç›®æ ‡å­¦æ ¡å¾€å¹´å½•å–æƒ…å†µã€‚</p>';
            else if (total >= 15) advice += '<p>é‡ç‚¹é€‰æ‹©ä¸­ç­¾ç‡è¾ƒé«˜çš„å­¦æ ¡ï¼Œç¡®ä¿æœ‰å­¦å¯ä¸Šã€‚å¯é€‚å½“å†²åˆº1æ‰€å¿ƒä»ªå­¦æ ¡ã€‚</p>';
            else advice += '<p>ä¼˜å…ˆè€ƒè™‘å…¬åŠå­¦æ ¡ï¼Œç¡®ä¿å…¥å­¦ç¨³å®šæ€§ã€‚åˆ©ç”¨è¿™æ®µæ—¶é—´æå‡æˆç»©ã€‚</p>';
            advice += '</div>';
            document.getElementById('decisionAdvice').innerHTML = advice;
        }

        function renderTimeline() {
            const grade = assessmentData.familyInfo.grade;
            const year = new Date().getFullYear();
            let html = '<div class="success-box"><h4>â° å…³é”®æ—¶é—´è§„åˆ’</h4><ul>';
            
            if (grade === '6') {
                html += `<li><strong>${year}å¹´3æœˆï¼š</strong>å…³æ³¨æ”¿ç­–å‘å¸ƒï¼Œå‡†å¤‡ææ–™</li>
                <li><strong>${year}å¹´4-5æœˆï¼š</strong>æ°‘åŠå­¦æ ¡æŠ¥åï¼Œä¸“é¡¹å¤ä¹ </li>
                <li><strong>${year}å¹´6æœˆï¼š</strong>æ‘‡å·å½•å–ï¼Œé¢è¯•å‡†å¤‡</li>
                <li><strong>${year}å¹´7æœˆï¼š</strong>è¡¥å½•æœºä¼šï¼Œç¡®å®šå­¦æ ¡</li>`;
            } else if (grade === '5') {
                html += `<li><strong>${year}å¹´9-12æœˆï¼š</strong>ç³»ç»Ÿå¤ä¹ ï¼ŒæŸ¥æ¼è¡¥ç¼º</li>
                <li><strong>${year+1}å¹´1-3æœˆï¼š</strong>ä¸“é¡¹è®­ç»ƒï¼Œå»ºç«‹é”™é¢˜æœ¬</li>
                <li><strong>${year+1}å¹´4-6æœˆï¼š</strong>æ¨¡æ‹Ÿæµ‹è¯•ï¼ŒåŸ¹å…»ä¹ æƒ¯</li>`;
            } else {
                html += `<li><strong>${year}å¹´9æœˆ-${year+1}å¹´2æœˆï¼š</strong>åŸ¹å…»å­¦ä¹ ä¹ æƒ¯ï¼Œæ‰“å¥½åŸºç¡€</li>
                <li><strong>${year+1}å¹´3-6æœˆï¼š</strong>å¹¿æ³›é˜…è¯»ï¼Œå‘å±•å…´è¶£</li>`;
            }
            html += '</ul></div>';
            document.getElementById('timeline').innerHTML = html;
        }

        function resetAssessment() {
            if (!confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹è¯„ä¼°å—ï¼Ÿå½“å‰ç»“æœå°†ä¸¢å¤±ã€‚')) return;
            document.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
            document.querySelectorAll('input[type="checkbox"]').forEach(c => c.checked = false);
            document.querySelectorAll('select').forEach(s => s.value = '');
            if (radarChart) radarChart.destroy();
            assessmentData = { scores: {}, familyInfo: {}, totalScore: 0 };
            showStep(1);
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ“ è¥¿å®‰å°å‡åˆæ™ºèƒ½è¯„ä¼°ç³»ç»Ÿå·²åŠ è½½');
            showStep(1);
        });
    </script>
</body>
</html>
